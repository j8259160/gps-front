(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-9c46e35e"],{3963:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form full posi-records"},[e("div",{staticClass:"report-form-inner"},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{type:"primary",loading:t.exportLoading1},on:{click:t.exportData}},[t._v(t._s(t.$t("common.export")))])],1),e("div",{staticClass:"f_center"}),e("div",{staticClass:"f_right"},[e("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(e){t.importDialog=!0}}},[t._v(t._s(t.$t("common.importQuery")))])],1),e("div",{staticClass:"f_right"},[e("el-button",{attrs:{type:"info",size:"mini",loading:t.addressLoading},on:{click:t.queryAllAddress}},[t._v(t._s(t.$t("common.oneClickQueryAddress")))])],1)]),e("div",{staticClass:"report-form-inner-tabs"},[e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:t.$t("bgManage.deviceList")+"(".concat(t.totalList.length,")"),name:"tabTotal"}}),e("el-tab-pane",{attrs:{label:"",name:"details"}})],1),e("div",{directives:[{name:"show",rawName:"v-show",value:"details"==t.activeName,expression:"activeName == 'details'"}],staticClass:"tableTitle"},[e("b",{domProps:{textContent:t._s(t.tableTitle)}}),t._v("("+t._s(t.detailsList.length)+")")]),e("div",{staticClass:"table-btns"})],1),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"80px",bottom:"0px"}},[e("div",{style:t.statisticsStyle},[e("vxe-table",{staticClass:"mytable-scrollbar",attrs:{border:"","menu-config":t.tableMenu,resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:t.totalList,"sort-config":t.sortConfig},on:{"menu-click":t.handleClickTableMenu}},[e("vxe-table-column",{attrs:{title:t.$t("reportForm.action"),width:"70"},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleClickRow(i.row)}}},[t._v(t._s(t.$t("reportForm.detailed")))])]}}])}),e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index")}}),e("vxe-table-column",{attrs:{field:"devicename",title:t.$t("alarm.devName"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"deviceid",title:t.$t("alarm.devNum"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"creater",title:t.$t("reportForm.creater"),width:"100",sortable:""},scopedSlots:t._u([{key:"default",fn:function(i){return[e("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[e("div",{staticClass:"parents-wrapper"},t._l(t.parentsList,(function(i){return e("div",{key:i.username},[t._v(t._s(i.username)+"("+t._s(i.usertypeStr)+")")])})),0),e("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(e){return t.queryParents(i.row.creater)}},slot:"reference"},[t._v(t._s(i.row.creater))])],1)]}}])}),e("vxe-table-column",{attrs:{field:"groupname",title:t.$t("reportForm.groupName"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"offlineDuration",title:t.$t("alarm.onlineStatus"),width:"90",sortable:""}}),e("vxe-table-column",{attrs:{field:"speed",align:"right",formatter:t.numberToFixed2,title:t.$t("reportForm.speed")+t.speedUnit,width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"isEffective",title:t.$t("common.positioning"),width:"80",sortable:""}}),e("vxe-table-column",{attrs:{field:"parkdurationStr",align:"right",title:t.$t("reportForm.parkingDuration"),width:"130",sortable:""}}),e("vxe-table-column",{attrs:{field:"updatetimeStr",title:t.$t("monitor.lastUpdate"),width:"156",sortable:""}}),e("vxe-table-column",{attrs:{field:"validpoistiontimeStr",title:t.$t("monitor.validpoistionTime"),width:"156",sortable:""}}),e("vxe-table-column",{attrs:{field:"strstatus",title:t.$t("reportForm.status"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"positype",title:t.$t("reportForm.posiType"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"address",title:t.$t("reportForm.address"),width:"200"}}),e("vxe-table-column",{attrs:{field:"callon",title:t.$t("reportForm.callon"),width:"100"}}),e("vxe-table-column",{attrs:{field:"callat",title:t.$t("reportForm.callat"),width:"100"}}),e("vxe-table-column",{attrs:{field:"direction",title:t.$t("reportForm.direction"),width:"100"}})],1)],1),e("div",{style:t.detailsStyle},[e("vxe-table",{staticClass:"mytable-scrollbar",attrs:{border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:t.detailsList}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index")}}),e("vxe-table-column",{attrs:{field:"updatetimeStr",title:t.$t("reportForm.time"),width:"140",sortable:""}}),e("vxe-table-column",{attrs:{field:"address",title:t.$t("reportForm.address")},scopedSlots:t._u([{key:"default",fn:function(i){return[e("span",{staticStyle:{"text-decoration":"underline",cursor:"pointer",color:"#388cfe"},domProps:{textContent:t._s(i.row.address)},on:{click:function(e){return t.seeMap(i.row)}}})]}}])}),e("vxe-table-column",{attrs:{field:"positype",title:t.$t("reportForm.posiType"),sortable:""}}),e("vxe-table-column",{attrs:{field:"callon",title:t.$t("reportForm.callon"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"callat",title:t.$t("reportForm.callat"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"direction",title:t.$t("reportForm.direction"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"speed",align:"right",formatter:t.numberToFixed2,title:t.$t("reportForm.speed")+t.speedUnit,width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"strstatus",title:t.$t("reportForm.status"),sortable:""}})],1)],1)]),e("vxe-modal",{attrs:{title:t.$t("reportForm.seeMap"),className:"modal-padding0",value:t.dialogMap,width:"500"},on:{hide:function(e){t.dialogMap=!1},close:function(e){t.dialogMap=!1}}},[e("div",{staticStyle:{width:"100%",height:"400px"}},[e("ReportMap",{ref:"mapIns"})],1)]),e("ImportDeviceidsDialog",{on:{"on-import":t.onImportDevice},model:{value:t.importDialog,callback:function(e){t.importDialog=e},expression:"importDialog"}})],1)])},r=[],o=i("5530"),s=(i("caad"),i("c975"),i("14d9"),i("4e82"),i("d3b7"),i("159b"),i("4795"),i("6e52")),n=i("e561"),l=i("80f4"),c=i("5101"),d=i("5bca"),u=i("1c31"),p=i("7cf8"),m=i("c276"),h=i("2f62"),v=i("a05b"),f=i("0c87"),b={name:"posiReport",data:function(){return{loading:!1,exportLoading1:!1,exportLoading2:!1,qeuryAddressLoading:!1,importDialog:!1,activeName:"tabTotal",tableTitle:"",addressLoading:!1,dialogMap:!1,dateRange:[new Date,new Date],totalList:[],detailsList:[],tableHeight:$(window).height()-120,sortConfig:{sortMethod:function(t){var e=t.data,i=t.sortList,a=i[0],r=a.property,o=a.order,s=Date.now(),n=[];return n="desc"===o?"offlineDuration"==r?e.sort((function(t,e){return s-e.updatetime-(s-t.updatetime)})):"parkdurationStr"==r?e.sort((function(t,e){return e.parkduration-t.parkduration})):e.sort((function(t,e){var i=e[r]+"";return i.localeCompare(t[r])})):"asc"===o?"offlineDuration"==r?e.sort((function(t,e){return s-t.updatetime-(s-e.updatetime)})):"parkdurationStr"==r?e.sort((function(t,e){return t.parkduration-e.parkduration})):e.sort((function(t,e){var i=t[r]+"";return i.localeCompare(e[r])})):e.sort(),n}}}},components:{MultiChoiceVehicle:n["a"],ReportMap:l["a"],ImportDeviceidsDialog:d["a"]},mixins:[v["a"],f["a"]],methods:{numberToFixed2:m["qb"],getPosiType:function(t){var e=Object(m["C"])(t),i=t.gotsrc,a=0===t.rxlevel?"":"/"+this.$t("monitor.signal")+t.rxlevel+"%";if("gps"==i&&t.gpsvalidnum>0&&(e+=" "+String(t.gpsvalidnum)+this.$t("monitor.n")),t.radius>0&&-1!=this.$store.state.permissionList.indexOf("monitor-showaccuracyrange")){var r=(""!==e?"/":"")+this.$t("monitor.around")+t.radius+this.$t("common.metre");e+=r}var o="";"gps"==t.gotsrc&&0!=t.altitude&&(o="/"+this.$t("reportForm.altitude")+t.altitude+this.$t("reportForm.altitudeunit"),e+=o),e+=a;var s=t.status,n=1==this.$store.state.userSetting.mapshownotreallocation;return n&&4!=(4&s)&&"gps"===t.gotsrc&&(e+=" "+this.$t("monitor.notRealtime")),e},onSelectDevice:function(t){this.deviceids=t},onImportDevice:function(t){var e=this,i=this.isZh,a=s["a"].deviceInfos,r=[],n=Object(m["t"])(a),l=n.simMap,d=n.iccidMap;t.forEach((function(t,n){var u=Object(m["ob"])(a,l,d,t),p=s["a"].lastPositions[u.deviceid];if(u)if(p){var h=Date.now();p.index=n+1,p.devicename=u.devicename,p.creater=s["a"].getShowName(u.creater),p.groupname=u.groupname,p.updatetimeStr=c["a"].longToLocalDateTimeStr(p.updatetime),p.validpoistiontimeStr=c["a"].longToLocalDateTimeStrUnderLine(p.validpoistiontime),p.isEffective=4==(4&p.status)?e.$t("header.yes"):e.$t("header.no"),p.callon=Object(m["Vb"])(p.callon),p.callat=Object(m["Vb"])(p.callat);var v=Object(m["I"])(p);p.address=v||"",p.disabled=!!v,p.positype=e.getPosiType(p),p.direction=Object(m["p"])(p.course);var f=Object(m["E"])(p,h);0==f?p.offlineDuration=Object(m["T"])(p)+" "+Object(m["Pb"])(h-p.updatetime):1==f?p.offlineDuration=e.$t("monitor.online",!0):2==f&&(p.offlineDuration=e.$t("monitor.sleep")),p.speed=Object(m["e"])(p.speed),p.parkdurationStr=Object(m["Pb"])(p.parkduration,!0),i||(p.strstatus=Object(m["y"])(p.strstatusen)),p.data={deviceid:t,begintime:c["a"].longToLocalDateTimeStr(p.updatetime-216e5),endtime:p.updatetimeStr,interval:300,timezone:c["a"].getOffset()},null==v&&points.push({lat:p.callat,lon:p.callon}),r.push(Object(o["a"])({},p))}else r.push({index:++n,deviceid:u.deviceid,devicename:u.devicename,creater:u.creater,groupname:u.groupname,data:null,address:"-",isEffective:"-",validpoistiontimeStr:"-",updatetimeStr:"-",offlineDuration:e.$t("common.notReported"),parkdurationStr:"-",speed:"-",positype:"-",direction:"-",callon:"-",callat:"-",strstatus:"-"})})),this.totalList=r,this.activeName="tabTotal"},handleQuery:function(){var t=this,e=this.deviceids;if(e.length>0){"tabTotal"!==this.activeName&&(this.activeName="tabTotal");var i=this.isZh;this.loading=!0,this.queryDetailDateRange=null,Object(u["l"])(e).then((function(a){var r=a.status,o=a.records;t.loading=!1;var n=[],l=[];if(0==r&&o){var d=[];o.forEach((function(e,a){if(e){var r=Date.now(),o=e.deviceid,u=s["a"].deviceInfos[o];d.push(o),e.index=a+1,e.devicename=u.devicename,e.creater=s["a"].getShowName(u.creater),e.groupname=u.groupname,e.updatetimeStr=c["a"].longToLocalDateTimeStr(e.updatetime),e.validpoistiontimeStr=c["a"].longToLocalDateTimeStrUnderLine(e.validpoistiontime),e.isEffective=4==(4&e.status)?t.$t("header.yes"):t.$t("header.no"),e.callon=Object(m["Vb"])(e.callon),e.callat=Object(m["Vb"])(e.callat);var p=Object(m["I"])(e);e.address=p||"",e.disabled=!!p,e.positype=t.getPosiType(e),e.direction=Object(m["p"])(e.course);var h=Object(m["E"])(e,r);0==h?e.offlineDuration=Object(m["T"])(e)+" "+Object(m["Pb"])(r-e.updatetime):1==h?e.offlineDuration=t.$t("monitor.online"):2==h&&(e.offlineDuration=t.$t("monitor.sleep")),e.speed=Object(m["e"])(e.speed),e.parkdurationStr=Object(m["Pb"])(e.parkduration,!0),i||(e.strstatus=Object(m["y"])(e.strstatusen)),e.data={deviceid:o,begintime:c["a"].longToLocalDateTimeStr(e.updatetime-216e5),endtime:e.updatetimeStr,interval:300,timezone:c["a"].getOffset()},null==p&&l.push({lat:e.callat,lon:e.callon}),n.push(e)}}));var u=n.length;e.forEach((function(e){if(0==d.includes(e)){var i=s["a"].deviceInfos[e];n.push({index:++u,deviceid:e,devicename:i.devicename,creater:i.creater,groupname:i.groupname,data:null,address:"-",isEffective:"-",validpoistiontimeStr:"-",updatetimeStr:"-",offlineDuration:t.$t("common.notReported"),parkdurationStr:"-",speed:"-",positype:"-",direction:"-",callon:"-",callat:"-",strstatus:"-"})}})),l.length>0&&Object(p["v"])(l).then((function(t){var e=t.points;e.forEach((function(t){var e=t.lat,i=t.lon,a=t.address;n.forEach((function(t){a&&t.callon==i&&t.callat==e&&(Object(m["rb"])(t,a),t.address=a)}))}))}))}t.totalList=n}))}else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})},queryAllAddress:function(){var t=this,e=[];if("details"==this.activeName){var i=this.detailsList;i.forEach((function(t){var i=t.callon,a=t.callat,r=t.address;""==r&&e.push({lat:a,lon:i})})),this.addressLoading=!0,Object(p["v"])(e).then((function(e){var a=e.points;t.addressLoading=!1,a&&(a.forEach((function(t){if(t&&""!=t.address&&null!=t.address){var e=t.address,i=t.lat,a=t.lon;Object(m["rb"])({callat:i,callon:a},e)}})),i.forEach((function(t){t.address||(t.address=Object(m["I"])(t))})))})).catch((function(e){t.addressLoading=!1}))}else{var a=this.totalList;a.forEach((function(t){var i=t.callon,a=t.callat,r=t.address;""==r&&e.push({lat:a,lon:i})})),this.addressLoading=!0,Object(p["v"])(e).then((function(e){var i=e.points;t.addressLoading=!1,i&&(i.forEach((function(t){if(t&&""!=t.address&&null!=t.address){var e=t.address,i=t.lat,a=t.lon;Object(m["rb"])({callat:i,callon:a},e)}})),a.forEach((function(t){t.address||(t.address=Object(m["I"])(t))})))})).catch((function(e){t.addressLoading=!1}))}},handleClickRow:function(t){var e=this,i=t.data;if(null!=i){this.queryDetailDateRange=i.begintime+" "+i.endtime,this.activeName="details";var a=this.isZh,r=i.deviceid,o=s["a"].deviceInfos[r].devicename;this.tableTitle=o+"-"+r,Object(p["Z"])(i).then((function(t){var i=t.records,s=[];null!=i&&i.length>0&&i.forEach((function(t,i){t.deviceid=r,t.index=i+1,t.devicename=o,t.updatetimeStr=c["a"].longToLocalDateTimeStr(t.updatetime),t.callon=Object(m["Vb"])(t.callon),t.callat=Object(m["Vb"])(t.callat);var n=Object(m["I"])(t);t.address=n||"",t.disabled=!!n,a||(t.strstatus=Object(m["y"])(t.strstatusen)),t.positype=e.getPosiType(t),t.direction=Object(m["p"])(t.course),t.speed=Object(m["e"])(t.speed),s.push(t)})),e.detailsList=s}))}},seeMap:function(t){var e=this;this.dialogMap=!0,setTimeout((function(){e.$refs.mapIns.singleMarkerToMap(t)}),300)},exportData:function(){if("details"!=this.activeName){var t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.offlineDuration"),this.$t("reportForm.speed")+this.speedUnit,this.$t("common.positioning"),this.$t("reportForm.parkingDuration"),this.$t("monitor.lastUpdate"),this.$t("monitor.validpoistionTime"),this.$t("reportForm.status"),this.$t("reportForm.posiType"),this.$t("reportForm.address"),this.$t("reportForm.callon"),this.$t("reportForm.callat"),this.$t("reportForm.direction")]];if(0!=this.totalList.length){this.totalList.forEach((function(e,i){var a=[];a.push(i+1),a.push(e.devicename),a.push(e.deviceid),a.push(e.creater),a.push(e.groupname),a.push(e.offlineDuration),a.push(Object(m["qb"])(e.speed)),a.push(e.isEffective),a.push(e.parkdurationStr),a.push(e.updatetimeStr),a.push(e.validpoistiontimeStr),a.push(e.strstatus),a.push(e.positype),a.push(e.address),a.push(e.callon),a.push(e.callat),a.push(e.direction),t.push(a)}));var e={title:this.$t("reportForm.posiReport"),data:t,dateRange:null};this.exportLoading1=!0,new ExcelCls(e).exportExcel(this)}}else this.exportDetailsData()},exportDetailsData:function(){var t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.callon"),this.$t("reportForm.callat"),this.$t("reportForm.direction"),this.$t("reportForm.speed")+this.speedUnit,this.$t("reportForm.time"),this.$t("reportForm.status"),this.$t("reportForm.posiType"),this.$t("reportForm.address")]];if(0!=this.detailsList.length){var e="";this.detailsList.forEach((function(i,a){e=i.devicename;var r=[];r.push(a+1),r.push(i.devicename),r.push(i.deviceid),r.push(i.callon),r.push(i.callat),r.push(i.direction),r.push(i.speed),r.push(i.updatetimeStr),r.push(i.strstatus),r.push(i.positype),r.push(i.address),t.push(r)}));var i={title:this.$t("reportForm.posiReport")+" - "+e,data:t,dateRange:null};this.exportLoading1=!0,new ExcelCls(i).exportExcel(this)}}},computed:Object(o["a"])(Object(o["a"])({},Object(h["d"])(["isZh"])),{},{statisticsStyle:function(){return{zIndex:"tabTotal"==this.activeName?999:0}},detailsStyle:function(){return{zIndex:"details"==this.activeName?999:0}},speedUnit:function(){return"("+this.$store.state.userSetting.unit_speed+")"}}),mounted:function(){this.deviceids=[]}},g=b,x=(i("85ba"),i("2877")),D=Object(x["a"])(g,a,r,!1,null,null,null),y=D.exports;e["default"]=y},"3b13":function(t,e,i){},7031:function(t,e,i){"use strict";i("3b13")},"80f4":function(t,e,i){"use strict";var a=i("32eb");e["a"]=a["a"]},"85ba":function(t,e,i){"use strict";i("bb19")},bb19:function(t,e,i){},e561:function(t,e,i){"use strict";var a=i("ea22");e["a"]=a["a"]},ea22:function(t,e,i){"use strict";var a=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-choice multi-choice-vehicle"},[e("div",{staticClass:"multi-choice-input"},[e("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:t.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:t.isQueryInitData,selectDeviceIds:t.multipleDeviceids},on:{onTreeCheck:t.onTreeCheck}})],1)])},r=[],o=i("5530"),s=(i("4795"),i("2f62")),n=i("2df7"),l={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(o["a"])({},Object(s["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:n["a"]},methods:Object(o["a"])(Object(o["a"])({},Object(s["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(t){this.$emit("onSelectDevice",t),this.setMultipleDeviceids(t)},clearText:function(){var t=this;setTimeout((function(){t.$refs.ztreeDevice.clearText()}),300)}})},c=l,d=(i("7031"),i("2877")),u=Object(d["a"])(c,a,r,!1,null,null,null);e["a"]=u.exports}}]);