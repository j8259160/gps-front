(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b33324f2"],{"39b4":function(e,t,a){"use strict";a("3f6c")},"3f6c":function(e,t,a){},"469a":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"query-device full"},[t("div",{staticClass:"query-device-header"},[t("div",{staticClass:"f_left",staticStyle:{width:"210px"}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.queryDevice"),showLabel:!1}},[t("ZtreeDeviceDropdown",{attrs:{placeholder:this.$t("tips.selectSingleDevice"),isQueryInitData:e.isQueryInitData,isClickAll:!0},model:{value:e.queryText,callback:function(t){e.queryText=t},expression:"queryText"}})],1)],1),t("div",{staticClass:"f_left"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleClickQuery}},[e._v(e._s(e.$t("common.query")))])],1),t("div",{staticClass:"f_right",staticStyle:{"padding-top":"3px"}},[t("el-button",{staticStyle:{position:"relative",top:"-1px"},attrs:{type:"info",size:"mini",loading:e.exportLoading},on:{click:e.exportDataAll}},[e._v(e._s(e.$t("device.exportAllDevice")))])],1),t("div",{staticClass:"f_right",staticStyle:{"padding-top":"3px"}},[t("el-button",{staticStyle:{position:"relative",top:"-1px"},attrs:{type:"info",size:"mini",loading:e.exportLoading1},on:{click:e.exportData}},[e._v(e._s(e.$t("device.exportCurrentDevice")))])],1),t("div",{staticClass:"f_right",staticStyle:{width:"auto"}},[t("el-radio",{attrs:{label:"365"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("bgManage.stock12yue")))])],1),t("div",{staticClass:"f_right"},[t("el-radio",{attrs:{label:"180"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("bgManage.stock6yue")))])],1),t("div",{staticClass:"f_right"},[t("el-radio",{attrs:{label:"60"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("bgManage.stock2yue")))])],1),t("div",{staticClass:"f_right"},[t("el-radio",{attrs:{label:"30"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("bgManage.stock1yue")))])],1),t("div",{staticClass:"f_right"},[t("el-radio",{attrs:{label:"0"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("bgManage.allStockDev")))])],1)]),t("div",{staticClass:"query-device-content",staticStyle:{top:"39px"}},[t("vxe-table",{attrs:{border:"","auto-resize":"","sort-config":e.sortConfig,resizable:"","show-overflow":"","highlight-current-row":"",size:"mini",height:"auto",data:e.tableList},on:{"current-change":e.currentChangeEvent}},[t("vxe-table-column",{attrs:{type:"seq",width:"60",title:e.$t("reportForm.index")}}),t("vxe-table-column",{attrs:{field:"devicename",title:e.$t("alarm.devName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"deviceid",title:e.$t("alarm.devNum"),sortable:""}}),t("vxe-table-column",{attrs:{field:"deviceType",title:e.$t("reportForm.deviceType"),width:"200",sortable:""}}),t("vxe-table-column",{attrs:{field:"creater",title:e.$t("reportForm.creater"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(a){return t("div",{key:a.username},[e._v(e._s(a.username)+"("+e._s(a.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(a.row.creater)}},slot:"reference"},[e._v(e._s(a.row.creater))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"groupName",title:e.$t("reportForm.groupName"),width:"120",sortable:""}}),t("vxe-table-column",{attrs:{field:"addTime",title:e.$t("reportForm.addTime"),width:"120",sortable:""}}),t("vxe-table-column",{attrs:{title:e.$t("reportForm.action"),width:"60"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("div",{staticStyle:{"padding-top":"7px"}},[t("el-popconfirm",{attrs:{placement:"top",icon:"el-icon-info","icon-color":"red","confirm-button-text":e.$t("common.confirm"),"cancel-button-text":e.$t("common.cancel"),title:e.$t("tips.confirmDelete")},on:{confirm:function(t){return e.handleDelete(a)}}},[t("span",{attrs:{slot:"reference"},slot:"reference"},[t("img",{staticStyle:{width:"16px",cursor:"pointer"},attrs:{src:e.deleteIcon}})])])],1)]}}])})],1)],1),t("div",{staticStyle:{position:"absolute",left:"0px",right:"10px",bottom:"0px"}},[t("el-pagination",{attrs:{currentPage:e.currentPage,"current-page":e.currentChangePage,"page-sizes":[20,40,60,80],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalcount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},r=[],o=a("5530"),s=(a("14d9"),a("a9e3"),a("d3b7"),a("159b"),a("0139")),n=a("e285"),c=a("2f62"),l=a("5101"),u=a("6e52"),d=a("2df7"),p=a("4c3c"),y=a("0c87"),h=a("61fc"),v=a("e173"),m=a("7b49"),g={name:"QueryDevice",data:function(){return{editIcon:h,deleteIcon:v,moreIcon:m,loading:!1,queryText:"",queryType:"0",tableList:[],totalcount:0,deviceid:"",deviceName:"",currentRow:{},pageSize:20,currentPage:1,exportLoading:!1,exportLoading1:!1}},mixins:[p["a"],y["a"]],components:{LabelWrap:s["a"],ZtreeDeviceDropdown:d["a"]},computed:Object(o["a"])({},Object(c["b"])(["isZh","deviceTypes","isQueryInitData","userType"])),watch:{isQueryInitData:function(e){if(e){var t={count:20,keyword:"",offset:0,all:!1,expiredays:0};this.queryDevices(t)}},queryType:function(){this.totalcount=0;var e={count:this.pageSize,keyword:this.queryText,offset:0,all:!1,expiredays:Number(this.queryType)};this.queryDevices(e)}},destroyed:function(){this.tableList=null},methods:Object(o["a"])(Object(o["a"])({},Object(c["c"])(["setIsReloadRootuser","setReportTagList"])),{},{exportData:function(){var e=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.deviceType"),this.$t("reportForm.addTime"),this.$t("reportForm.creater"),this.$t("reportForm.groupName")]];this.tableList.forEach((function(t,a){var i=[];i.push(++a),i.push(t.devicename),i.push(t.deviceid),i.push(t.deviceType),i.push(t.addTime),i.push(t.creater),i.push(t.groupName),e.push(i)}));var t={title:this.$t("bgManage.deviceList"),data:e,dateRange:null,exportMaxLength:1e5};this.exportLoading1=!0,new ExcelCls(t).exportExcel(this)},exportDataAll:function(){var e=this,t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.deviceType"),this.$t("reportForm.addTime"),this.$t("reportForm.creater"),this.$t("reportForm.groupName")]],a=this.deviceTypes,i=u["a"].deviceInfos;this.exportLoading=!0;var r={offset:0,count:1e4,all:!1,expiredays:0,keyword:""};Object(n["Pb"])(r).then((function(r){var o=r.devices;if(e.exportLoading=!1,o){o.forEach((function(r,o){var s=[],n="",c=i[r.deviceid];c&&(n=0==c.groupid?e.$t("common.defaultGroup"):c.groupname);var u=l["a"].format(new Date(r.createtime),"yyyy-MM-dd"),d=a[r.devicetype].typename;l["a"].format(new Date(r.expirenotifytime),"yyyy-MM-dd");s.push(++o),s.push(r.devicename),s.push(r.deviceid),s.push(d),s.push(u),s.push(r.creater),s.push(n),t.push(s)}));var s={title:e.$t("bgManage.stockDevice"),data:t,dateRange:null,exportMaxLength:1e5};new ExcelCls(s).exportExcel(e)}})).catch((function(t){console.log(t),e.exportLoading=!1}))},currentChangeEvent:function(e){var t=e.row;this.currentRow=t,this.deviceid=t.deviceid,this.deviceName=t.devicename},handleClickQuery:function(){var e={count:this.pageSize,keyword:this.queryText,offset:0,all:!1,expiredays:Number(this.queryType)};this.queryDevices(e)},handleDelete:function(e){var t=this,a=e.row,i=e.rowIndex,r=a.deviceid,o=a.groupid,s=a.creater,c=u["a"].deviceInfos;Object(n["C"])({deviceid:r}).then((function(e){var a=e.status;0==a?(t.$delete(t.tableList,i),t.totalcount--,delete c[r],delete u["a"].lastPositions[r],u["a"].removeDevice(s,o,r),t.setReportTagList([]),t.setIsReloadRootuser(!0),t.$XModal.message({message:t.$t("tips.deleteSucc"),status:"success",zIndex:9999})):t.$XModal.message({message:t.$t("tips.deleteFail"),status:"error",zIndex:9999})}))},getAlarmActionStr:function(e){var t=this.$t("bgManage.platform");return 1==(1&e)&&(t+="+"+this.$t("bgManage.voice")),2==(2&e)&&(t+="+"+this.$t("bgManage.pop_up")),4==(4&e)&&(t+="+"+this.$t("common.weChat")),8==(8&e)&&(t+="+"+this.$t("bgManage.relieve")),t},queryDevices:function(e){var t=this;this.loading=!0;var a=this.isZh,i=this.deviceTypes,r=u["a"].deviceInfos;Object(n["Pb"])(e).then((function(e){var o=e.devices,s=e.totalcount;t.totalcount=s,o.forEach((function(e){var o=e.deviceid,s=i[e.devicetype],n=s.typename+"-"+(a?s.remark:s.remarken);e.addTime=l["a"].format(new Date(e.createtime),"yyyy-MM-dd"),e.expireTime=l["a"].format(new Date(e.expirenotifytime),"yyyy-MM-dd"),e.deviceType=n,e.alarmactionStr=t.getAlarmActionStr(e.alarmaction);var c=r[o];c&&(0==c.groupid?e.groupName=t.$t("common.defaultGroup"):e.groupName=c.groupname)})),t.tableList=o,t.loading=!1})).catch((function(e){t.loading=!1}))},currentChangePage:function(e){var t={count:this.pageSize,keyword:this.queryText,offset:e-1,all:!1,expiredays:0};this.queryDevices(t)},handleSizeChange:function(e){this.pageSize=e,this.currentChangePage(this.currentPage)},handleCurrentChange:function(e){this.currentChangePage(e)}}),mounted:function(){if(this.isQueryInitData){var e={count:this.pageSize,keyword:this.queryText,offset:0,all:!1,expiredays:Number(this.queryType)};this.queryDevices(e)}}},f=g,b=(a("39b4"),a("2877")),x=Object(b["a"])(f,i,r,!1,null,null,null),$=x.exports;t["default"]=$}}]);