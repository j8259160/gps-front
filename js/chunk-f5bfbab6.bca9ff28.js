(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f5bfbab6"],{"001b":function(t,e,a){},"0155":function(t,e,a){"use strict";a("c6d4")},"04a9":function(t,e,a){"use strict";a("e68e")},"0505":function(t,e,a){},"0595":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"quick-time-range"},[e("div",{staticClass:"quick-time-range-wrapper"},t._l(t.list,(function(a){return e("div",{key:a.type,style:{color:a.type==t.type?"#409EFF":""},on:{click:function(e){return t.selectDate(a.type)}}},[t._v(t._s(a.label))])})),0),e("div",{staticClass:"quick-time-range-space"}),e("div",{staticClass:"quick-time-range-btn",on:{click:function(e){t.isCollapse=!t.isCollapse}}},[t.isCollapse?e("i",{staticClass:"el-icon-arrow-right"}):e("i",{staticClass:"el-icon-arrow-left"})])])},r=[],s=a("5101"),l={name:"QuickTimeRange",props:{value:{type:Array,default:function(){return[]}},dateType:{type:String,default:"date"}},watch:{isCollapse:function(){this.setList()}},data:function(){return{isCollapse:!0,type:0,list:[]}},methods:{setList:function(){this.isCollapse?this.list=[{label:this.$t("reportForm.toDay"),type:0},{label:this.$t("reportForm.yesterDay"),type:1},{label:this.$t("reportForm.recent3Days"),type:3}]:this.list=[{label:this.$t("reportForm.recent7Days"),type:7},{label:this.$t("reportForm.recent10Days"),type:10},{label:this.$t("reportForm.recent30Days"),type:30}]},selectDate:function(t){var e="datetimerange"==this.dateType,a=[],i=new Date,r=new Date;switch(e&&(i=new Date(s["a"].format(new Date,"yyyy-MM-dd")+" 00:00:00"),r=new Date(s["a"].format(new Date,"yyyy-MM-dd")+" 23:59:59")),t){case 0:a=[new Date(s["a"].format(i,"yyyy-MM-dd")+" 00:00:00"),new Date(s["a"].format(r,"yyyy-MM-dd")+" 23:59:59")];break;case 1:i.setTime(i.getTime()-864e5),r.setTime(r.getTime()-864e5),a=[i,r];break;case 3:i.setTime(i.getTime()-2592e5),a=[i,r];break;case 7:i.setTime(i.getTime()-6048e5),a=[i,r];break;case 10:i.setTime(i.getTime()-864e6),a=[i,r];break;case 30:i.setTime(i.getTime()-2592e6),a=[i,r];break}this.type=t,this.$emit("input",a)}},mounted:function(){var t=this;this.$nextTick((function(){t.setList()}))}},o=l,n=(a("8d09"),a("2877")),c=Object(n["a"])(o,i,r,!1,null,null,null);e["a"]=c.exports},1767:function(t,e,a){"use strict";a("001b")},"2dae":function(t,e,a){"use strict";a.r(e);a("caad"),a("c975"),a("2532");var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form safety-day-report noselect full"},[e("div",{staticClass:"report-form-inner"},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left"},[e("SelectDate",{model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),e("div",{staticClass:"f_left"},[e("QuickTimeRange",{model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("el-popover",{attrs:{placement:"bottom",width:"236",trigger:"click"}},[e("div",[e("el-button",{staticStyle:{width:"100px"},attrs:{slot:"reference",type:"primary",plain:"",loading:t.exportLoading1},on:{click:t.exportData},slot:"reference"},[t._v(t._s(t.$t("common.summary")))]),e("el-button",{staticStyle:{width:"100px"},attrs:{slot:"reference",type:"primary",loading:t.exportLoading2,plain:""},on:{click:t.exportDetailData},slot:"reference"},[t._v(t._s(t.$t("reportForm.detailed")))])],1),e("el-button",{attrs:{slot:"reference",type:"primary"},slot:"reference"},[t._v(t._s(t.$t("common.export")))])],1)],1)]),e("div",{staticClass:"safety-day-report-tab"},[e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:t.$t("bgManage.chart"),name:"echart"}}),e("el-tab-pane",{attrs:{label:t.$t("reportForm.detailed"),name:"details"}})],1)],1),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"79px"}},[e("div",{style:{zIndex:"echart"==t.activeName?10:1}},[e("SafetyEchart",{ref:"echart",on:{selectDevice:t.onClickDevice,"on-click-pie":t.onClickDevice}})],1),e("div",{style:{zIndex:"details"==t.activeName?10:1}},[e("vxe-table",{ref:"xTab",staticClass:"mytable-scrollbar",attrs:{"sort-config":t.sortConfig,"menu-config":t.tableMenu,"auto-resize":"",border:"",resizable:"","show-overflow":"","highlight-hover-row":"","highlight-current-row":"",size:"mini",height:"auto",data:t.tableData},on:{"menu-click":t.handleClickTableMenu,"cell-click":t.cellClick,"cell-dblclick":t.cellDblclick}},[e("vxe-table-column",{attrs:{field:"index",width:"60",title:t.$t("reportForm.index")}}),e("vxe-table-column",{attrs:{type:"expand",width:"36"},scopedSlots:t._u([{key:"content",fn:function(a){var i=a.row,r=a.rowIndex;return[[e("div",{staticStyle:{"padding-left":"60px"}},[e("vxe-table",{ref:"vTab"+r,staticClass:"mytable-scrollbar",attrs:{"sort-config":t.sortConfig,"menu-config":t.tableMenu,border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"","highlight-current-row":"",size:"mini",height:i.tableHeight,data:i.deviceRecords},on:{"menu-click":t.handleClickTableMenu,"cell-click":t.cellClickEvent}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index"),sortable:""}}),e("vxe-table-column",{attrs:{field:"alarmClass",filters:[{label:t.$t("activeSafety.forwardAlarm"),value:1},{label:t.$t("activeSafety.abnormalDriving"),value:2},{label:t.$t("activeSafety.blindZoneAlarm"),value:3}],"filter-method":t.filterClassTypeMethod,title:t.$t("alarm.alarmClass"),width:"120",sortable:""}}),e("vxe-table-column",{attrs:{sortable:"",field:"event",width:"110",title:t.$t("activeSafety.alarmEvent")}}),0==t.defaultActive.includes("bsd")?e("vxe-table-column",{attrs:{sortable:"",field:"alarmlevel",width:"70",title:t.$t("activeSafety.alarmLevel")}}):t._e(),e("vxe-table-column",{attrs:{sortable:"",field:"dateStr",width:"158",title:t.$t("reportForm.time")}}),e("vxe-table-column",{attrs:{sortable:"",field:"address",title:t.$t("reportForm.address")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{staticStyle:{"text-decoration":"underline",cursor:"pointer",color:"#388cfe"},domProps:{textContent:t._s(a.row.address)}})]}}],null,!0)}),t.permissionList.indexOf("report-safetyreports-deletesafetyrecord")>-1?e("vxe-table-column",{attrs:{title:t.$t("reportForm.action"),width:"80"},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{on:{click:function(t){t.stopPropagation()}}},[e("el-popconfirm",{attrs:{placement:"top",icon:"el-icon-info","icon-color":"red","confirm-button-text":t.$t("common.confirm"),"cancel-button-text":t.$t("common.cancel"),title:t.$t("tips.confirmDelete")},on:{confirm:function(e){return t.handleDelete(a)}}},[e("el-button",{attrs:{slot:"reference",type:"text",size:"mini"},slot:"reference"},[t._v(t._s(t.$t("common.delete")))])],1)],1)]}}],null,!0)}):t._e()],1)],1)]]}}])}),e("vxe-table-column",{attrs:{field:"devicename",title:t.$t("alarm.devName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"deviceid",title:t.$t("alarm.devNum"),sortable:""}}),e("vxe-table-column",{attrs:{field:"creater",title:t.$t("reportForm.creater"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[e("div",{staticClass:"parents-wrapper"},t._l(t.parentsList,(function(a){return e("div",{key:a.username},[t._v(t._s(a.username)+"("+t._s(a.usertypeStr)+")")])})),0),e("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(e){return t.queryParents(a.row.creater)}},slot:"reference"},[t._v(t._s(a.row.creater))])],1)]}}])}),e("vxe-table-column",{attrs:{field:"groupname",title:t.$t("reportForm.groupName"),sortable:""}}),e("vxe-table-column",{attrs:{sortable:"",field:"forwardAlarmCount",title:t.$t("activeSafety.forwardAlarm")}}),e("vxe-table-column",{attrs:{sortable:"",field:"abnormalDrivingCount",title:t.$t("activeSafety.abnormalDriving")}}),e("vxe-table-column",{attrs:{sortable:"",field:"blindZoneAlarmCount",title:t.$t("activeSafety.blindZoneAlarm")}}),e("vxe-table-column",{attrs:{sortable:"",field:"alarmCount",title:t.$t("alarm.allAlarms")}})],1)],1)]),e("SafetyDetailReport",{ref:"safetyDetail",model:{value:t.drawer,callback:function(e){t.drawer=e},expression:"drawer"}}),e("vxe-modal",{attrs:{title:t.$t("reportForm.seeMap"),className:"modal-padding0",value:t.dialogMap,width:"500"},on:{hide:function(e){t.dialogMap=!1},close:function(e){t.dialogMap=!1}}},[e("div",{staticStyle:{width:"100%",height:"400px"}},[e("ReportMap",{ref:"mapIns"})],1)])],1)])},r=[],s=a("5530"),l=(a("99af"),a("14d9"),a("4e82"),a("a434"),a("d3b7"),a("159b"),a("4795"),a("32eb")),o=a("d91c"),n=a("e561"),c=a("2ddc"),d=function(){var t=this,e=t._self._c;return e("div",{staticClass:"class-item",on:{click:t.handleClick}},[e("div",{staticClass:"class-item-left"},[e("div",{staticClass:"class-item-left-icon"},[e("div",[e("div",{class:[t.active?"active":"no_active"]})])]),e("div",{staticClass:"class-item-left-vertical"},[e("div",{directives:[{name:"show",rawName:"v-show",value:!t.data.isLast,expression:"!data.isLast"}]})])]),e("div",{staticClass:"class-item-right"},[e("div",{staticClass:"class-item-right-time"},[t._v(t._s(t.data.startTime)+" - "+t._s(t.data.endTime))]),e("div",{staticClass:"class-item-right-type"},[t._v(t._s(t.data.type)+t._s(t.data.alarmcount)+"次")])])])},u=[],m={name:"ClassItem",props:{data:{type:Object,default:function(){}},active:{type:Boolean,default:!1}},data:function(){return{}},methods:{handleClick:function(t){t.stopPropagation(),t.preventDefault(),this.$emit("select",this.data.key)}}},p=m,h=(a("b384"),a("2877")),v=Object(h["a"])(p,d,u,!1,null,null,null),f=v.exports,g=(a("b0c0"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"safety-pie full"},[e("div",{staticClass:"safety-pie-left"},[e("el-card",{staticClass:"box-card",staticStyle:{width:"200px",height:"100%"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",{domProps:{textContent:t._s(t.$t("reportForm.safetyAlarmMax"))}})]),e("div",{staticClass:"safety-pie-left-content"},[e("el-scrollbar",{staticStyle:{height:"100%"}},t._l(t.maxLoginLists,(function(a,i){return e("div",{key:i,staticClass:"safety-pie-left-content-row",on:{click:function(e){return t.handleClick(a)}}},[e("el-row",[e("el-col",{staticClass:"ellipsis",staticStyle:{"padding-left":"15px","border-right":"1px solid #dcdfe6"},attrs:{span:16}},[t._v(" "+t._s(a.name)+" ")]),e("el-col",{staticStyle:{"padding-right":"10px","text-align":"center"},attrs:{span:8}},[t._v(" "+t._s(a.value)+" ")])],1)],1)})),0)],1)])],1),e("div",{staticClass:"safety-pie-right"},[e("el-card",{staticClass:"box-card",staticStyle:{width:"200px",height:"100%"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",{domProps:{textContent:t._s(t.$t("reportForm.safetyAlarmMin"))}})]),e("div",{staticClass:"safety-pie-left-content"},[e("el-scrollbar",{staticStyle:{height:"100%"}},t._l(t.minLoginLists,(function(a,i){return e("div",{key:i,staticClass:"safety-pie-left-content-row",on:{click:function(e){return t.handleClick(a)}}},[e("el-row",[e("el-col",{staticClass:"ellipsis",staticStyle:{"padding-left":"15px","border-right":"1px solid #dcdfe6"},attrs:{span:16}},[t._v(" "+t._s(a.name)+" ")]),e("el-col",{staticStyle:{"padding-right":"10px","text-align":"center"},attrs:{span:8}},[t._v(" "+t._s(a.value)+" ")])],1)],1)})),0)],1)])],1),e("div",{staticClass:"full",attrs:{id:t.chartId}})])}),y=[],b=(a("fb6a"),a("43c8")),C=a.n(b),A={name:"PieEchart",computed:{chartId:function(){return"chart_".concat(this._uid)}},data:function(){return{maxLoginLists:[],minLoginLists:[]}},methods:{handleClick:function(t){this.$emit("selectDevice",t)},initChart:function(){var t=this;this.chartsIns=C.a.init(document.getElementById(this.chartId));var e={legendData:[],seriesData:[]};this.chartsIns.setOption(this.getChartsOption(e),!0),this.chartsIns.on("click","series.pie",(function(e){var a=e.data;t.$emit("on-click-pie",a)}))},resize:function(){this.chartsIns.resize()},updateChartsOption:function(t){var e={legendData:[],seriesData:[]};t.forEach((function(t){var a=t.devicename,i=t.deviceid;e.legendData.push(a),e.seriesData.push({name:a,deviceid:i,value:t.alarmCount})})),e.seriesData.sort((function(t,e){return e.value-t.value})),this.maxLoginLists=e.seriesData.slice(0,10),this.minLoginLists=e.seriesData.slice(e.seriesData.length-10,e.seriesData.length),this.chartsIns.setOption(this.getChartsOption(e),!0)},getChartsOption:function(t){return{tooltip:{trigger:"item",formatter:"{b} : {c} "},legend:{type:"scroll",orient:"vertical",right:60,top:20,bottom:20,data:t.legendData},series:[{name:"主动安全报警次数",type:"pie",radius:"80%",center:["50%","50%"],data:t.seriesData,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}},mounted:function(){var t=this;this.$nextTick((function(){t.initChart()}))}},w=A,x=(a("04a9"),Object(h["a"])(w,g,y,!1,null,null,null)),D=x.exports,S=a("57c9"),T=a("1c31"),k=a("7cf8"),M=a("5101"),R=a("c276"),$=a("6e52"),O=a("2f62"),I=a("a05b"),E=a("0c87"),L=a("d590"),_=a("6f8c"),F=a("e079"),z={name:"safetyDayReport",data:function(){return{activeName:"echart",icon1:L,icon2:_,icon3:F,loading:!1,dialogMap:!1,exportLoading1:!1,exportLoading2:!1,dateRange:[new Date,new Date],forwardAlarmList:[],abnormalDrivingList:[],bsdList:[],forwardAlarmTable:[],abnormalDrivingTable:[],tableData:[],drawer:!1,carouselIndex:0,defaultActive:"",sortConfig:{sortMethod:function(t){var e=t.data,a=t.sortList,i=a[0],r=i.property,s=i.order,l=[];return l="desc"===s?"forwardAlarmCount"==r?e.sort((function(t,e){return e.forwardAlarmCount-t.forwardAlarmCount})):"dateStr"==r?e.sort((function(t,e){return e.updatetime-t.updatetime})):"abnormalDrivingCount"==r?e.sort((function(t,e){return e.abnormalDrivingCount-t.abnormalDrivingCount})):"blindZoneAlarmCount"==r?e.sort((function(t,e){return e.blindZoneAlarmCount-t.blindZoneAlarmCount})):"alarmCount"==r?e.sort((function(t,e){return e.alarmCount-t.alarmCount})):e.sort((function(t,e){var a=e[r]+"";return a.localeCompare(t[r])})):"asc"===s?"forwardAlarmCount"==r?e.sort((function(t,e){return t.forwardAlarmCount-e.forwardAlarmCount})):"dateStr"==r?e.sort((function(t,e){return t.updatetime-e.updatetime})):"abnormalDrivingCount"==r?e.sort((function(t,e){return t.abnormalDrivingCount-e.abnormalDrivingCount})):"blindZoneAlarmCount"==r?e.sort((function(t,e){return t.blindZoneAlarmCount-e.blindZoneAlarmCount})):"alarmCount"==r?e.sort((function(t,e){return t.alarmCount-e.alarmCount})):e.sort((function(t,e){var a=t[r]+"";return a.localeCompare(e[r])})):e.sort(),l}}}},mixins:[I["a"],E["a"]],components:{MultiChoiceVehicle:n["a"],SelectDate:c["a"],ReportMap:l["a"],SafetyDetailReport:o["a"],ClassItem:f,QuickTimeRange:S["a"],SafetyEchart:D},computed:Object(s["a"])({},Object(O["b"])(["isZh","permissionList"])),methods:Object(s["a"])(Object(s["a"])({},Object(O["c"])(["setSingleDeviceid"])),{},{onClickDevice:function(t){var e=this;this.activeName="details";var a=t.deviceid,i=null;this.tableData.forEach((function(t){t.deviceid==a&&(i=t)})),i&&(this.$refs.xTab.setRowExpand(i,!0),this.$refs.xTab.setCurrentRow(i),setTimeout((function(){e.$refs.xTab.scrollToRow(i)}),300))},resize:function(){this.$refs.echart.resize()},filterClassTypeMethod:function(t){var e=t.value,a=t.row;t.column;return a.alarmClassType==e},cellClick:function(t){var e=t.rowIndex,a=this.$refs["vTab"+e];if(a){var i=a.getColumnByField("alarmClass"),r=null,s=t.column.property;"forwardAlarmCount"==s?(a.clearFilter(),r=i.filters[0]):"abnormalDrivingCount"==s?(a.clearFilter(),r=i.filters[1]):"blindZoneAlarmCount"==s?(a.clearFilter(),r=i.filters[2]):"alarmCount"==s&&a.clearFilter(),r&&a&&(r.checked=!0,a.updateData())}},cellDblclick:function(t){var e=t.row,a=this.$refs.xTab.isRowExpandByRow(e);this.$refs.xTab.setRowExpand(e,!a)},handleDelete:function(t){var e=this,a=t.row,i=t.rowIndex,r={deviceid:a.deviceid,activesafetys:[{updatetime:a.updatetime,activesafetyid:a.activesafetyid}]};Object(T["c"])(r).then((function(t){var a=t.status;if(0==a){var s=null;e.tableData.forEach((function(t){t.deviceid==r.deviceid&&(s=t)})),null!=s&&s.deviceRecords.splice(i,1),e.$XModal.message({message:e.$t("tips.deleteSucc"),status:"error",zIndex:9999})}else e.$XModal.message({message:e.$t("tips.deleteFail"),status:"error",zIndex:9999})}))},onSelectDevice:function(t){this.deviceids=t},exportData:function(){var t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("activeSafety.forwardAlarm"),this.$t("activeSafety.abnormalDriving"),this.$t("activeSafety.blindZoneAlarm"),this.$t("alarm.allAlarms")]];if(0!=this.tableData.length){this.tableData.forEach((function(e,a){var i=[];i.push(a+1),i.push(e.devicename),i.push(e.deviceid),i.push(e.creater),i.push(e.groupname),i.push(e.forwardAlarmCount),i.push(e.abnormalDrivingCount),i.push(e.blindZoneAlarmCount),i.push(e.alarmCount),t.push(i)}));var e={title:this.$t("reportForm.safetyDayReport")+this.$t("common.summary"),data:t,dateRange:this.queryDateRange};this.exportLoading1=!0,new ExcelCls(e).exportExcel(this)}},exportDetailData:function(){var t=this,e=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("alarm.alarmClass"),this.$t("activeSafety.alarmEvent"),this.$t("activeSafety.alarmLevel"),this.$t("reportForm.time"),this.$t("reportForm.address"),this.$t("monitor.coordinate")]],a="",i=this.tableData.length;if(this.tableData.forEach((function(r){r.deviceRecords.forEach((function(t,s){1==i&&(a=r.devicename);var l=[];l.push(s+1),l.push(r.devicename),l.push(r.deviceid),l.push(r.creater),l.push(r.groupname),l.push(t.alarmClass),l.push(t.event),l.push(t.alarmlevel),l.push(t.dateStr),l.push(t.address),l.push(t.lon+","+t.lat),e.push(l)}));var s=[];s.push(r.deviceRecords.length+1),s.push(r.devicename),s.push(r.deviceid),s.push(""),s.push(""),s.push(""),s.push(t.$t("activeSafety.forwardAlarm")+":"+r.forwardAlarmCount),s.push(t.$t("activeSafety.abnormalDriving")+":"+r.abnormalDrivingCount),s.push(t.$t("activeSafety.blindZoneAlarm")+":"+r.blindZoneAlarmCount),s.push(t.$t("alarm.allAlarms")+":"+r.alarmCount),s.push(""),e.push(s),s=[],s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),e.push(s)})),1!=e.length){var r={title:this.$t("reportForm.safetyDayReport")+this.$t("reportForm.detailed")+(a?" - "+a:""),data:e,dateRange:this.queryDateRange};this.exportLoading2=!0,new ExcelCls(r).exportExcel(this)}},cellClickEvent:function(t){var e=this;if("address"==t.column.property)this.dialogMap=!0,t.row.callon=t.row.lon,t.row.callat=t.row.lat,setTimeout((function(){e.$refs.mapIns.singleMarkerToMap(t.row)}),300);else{var a=t.row,i=Date.now();if(i-a.updatetime<3e5){var r={deviceid:a.deviceid,updatetime:a.updatetime,activesafetyid:a.activesafetyid};Object(k["B"])(r).then((function(t){var i=t.record,r=t.playrootpath;i._localPlayRootPath=r;var s=i.alarmtype;100==s?i.event=Object(R["A"])(i):101==s?i.event=Object(R["m"])(i):103==s&&(i.event=Object(R["o"])(i)),i.dateStr=M["a"].longToLocalDateTimeStr(i.updatetime),e.$refs.safetyDetail.setRecordInfo(i),e.drawer=!0,Object.assign(a,i),console.log("QeuryActiveSafety:",i)}))}else a._localPlayRootPath=a.playrootpath,this.$refs.safetyDetail.setRecordInfo(a),this.drawer=!0,console.log("ActiveSafety:",a)}},handleQuery:function(){var t=this,e=this.deviceids,a=this.dateRange;if(e.length>0){var i=M["a"].format(a[0],"yyyy-MM-dd"),r=M["a"].format(a[1],"yyyy-MM-dd"),s={deviceids:e,begintime:i+" 00:00:00",endtime:r+" 23:59:59",timezone:M["a"].getOffset(),needaddress:1};this.queryDateRange="".concat(i," - ").concat(r),this.loading=!0,this.forwardAlarmTable=[],this.forwardAlarmList=[],this.abnormalDrivingList=[],this.abnormalDrivingTable=[],this.imageAndVideoList=[{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""}],Object(T["m"])(s).then((function(e){var a=e.records,i=e.addressmap;t.loading=!1,t.addressmap=i,t._localPlayRootPath="";var r=[];a&&a.forEach((function(e,a){var i=e.deviceid,s=e.playrootpath,l=e.records,o=t.handleAlarmTypeClassify(l||[],i,s),n=o.deviceRecords,c=o.forwardAlarmCount,d=o.abnormalDrivingCount,u=o.blindZoneAlarmCount,m=$["a"].deviceInfos[i],p=$["a"].getShowName(m.creater),h=$["a"].getDeviceNameByDeviceId(i),v=m.groupname;r.push({index:a+1,deviceid:i,devicename:h,creater:p,groupname:v,playrootpath:s,deviceRecords:n,forwardAlarmCount:c,abnormalDrivingCount:d,blindZoneAlarmCount:u,alarmCount:n.length,tableHeight:0==n.length?72:36+36*(n.length>30?30:n.length)})})),t.tableData=r,t.$refs.echart.updateChartsOption(r),1==r.length&&setTimeout((function(){t.$refs.xTab.setRowExpand(r[0],!0)}),500)}))}else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})},handleAlarmTypeClassify:function(t,e,a){var i=this;return i.recordsObj={},t.forEach((function(t){var a=i.recordsObj[t.alarmtype+""];void 0===a&&(a={},i.recordsObj[t.alarmtype]=a),t.deviceid=e,i.handleAlarmEventClassify(a,e,t)})),this.getEventList(i.recordsObj,a)},handleAlarmEventClassify:function(t,e,a){var i=a.alarmevent,r=t[i];void 0===r&&(r={},r.records=[],r.deviceid=e,r.startalarmtime=0,r.endalarmtime=0,r.startspeed=0,r.endspeed=0,r.alarmcount=0,r.startlon=0,r.startlat=0,r.endlat=0,r.endlon=0,r.alarmevent=i,r.alarmlevel=a.alarmlevel,t[i]=r),r.alarmcount++,0==r.startalarmtime&&(r.startalarmtime=a.updatetime,r.startspeed=a.speed,r.startlat=a.lat,r.startlon=a.lon),0==r.endalarmtime&&(r.endalarmtime=a.updatetime,r.endspeed=a.speed,r.endlat=a.lat,r.endlon=a.lon),r.startalarmtime>a.updatetime&&(r.startalarmtime=a.updatetime,r.startspeed=a.speed,r.startlat=a.lat,r.startlon=a.lon),r.endalarmtime<a.updatetime&&(r.endalarmtime=a.updatetime,r.endspeed=a.speed,r.endlat=a.lat,r.endlon=a.lon),r.records.push(a)},getEventList:function(t,e){var a=this.addressmap,i=[],r=0,s=0,l=0;for(var o in t)if(100==o){var n=t[o];for(var c in n){var d=n[c];d.alarmClassType=1,d.alarmClass=this.$t("activeSafety.forwardAlarm"),d.type=Object(R["A"])(d),d.startTime=M["a"].longToLocalDateTimeStr(d.startalarmtime).split(" ")[1],d.endTime=M["a"].longToLocalDateTimeStr(d.endalarmtime).split(" ")[1],d.records.forEach((function(t){t.alarmClassType=d.alarmClassType,t.alarmClass=d.alarmClass,t.event=d.type,t.playrootpath=e,t.dateStr=M["a"].longToLocalDateTimeStr(t.updatetime),t.address=Object(R["L"])(a,t.lat,t.lon),i.push(t),r++}))}}else if(101==o){var u=t[o];for(var c in u){d=u[c];d.alarmClassType=2,d.alarmClass=this.$t("activeSafety.abnormalDriving"),d.startTime=M["a"].longToLocalDateTimeStr(d.startalarmtime).split(" ")[1],d.endTime=M["a"].longToLocalDateTimeStr(d.endalarmtime).split(" ")[1],d.type=Object(R["m"])(d),d.records.forEach((function(t){t.alarmClassType=d.alarmClassType,t.alarmClass=d.alarmClass,t.event=d.type,t.playrootpath=e,t.dateStr=M["a"].longToLocalDateTimeStr(t.updatetime),t.address=Object(R["L"])(a,t.lat,t.lon),i.push(t),s++}))}}else if(103==o){var m=t[o];for(var c in m){d=m[c];d.alarmClassType=3,d.alarmClass=this.$t("activeSafety.blindZoneAlarm"),d.type=Object(R["o"])(d),d.startTime=M["a"].longToLocalDateTimeStr(d.startalarmtime).split(" ")[1],d.endTime=M["a"].longToLocalDateTimeStr(d.endalarmtime).split(" ")[1],d.records.forEach((function(t){t.alarmClassType=d.alarmClassType,t.alarmClass=d.alarmClass,t.event=d.type,t.playrootpath=e,t.dateStr=M["a"].longToLocalDateTimeStr(t.updatetime),t.address=Object(R["L"])(a,t.lat,t.lon),i.push(t),l++}))}}return i.sort((function(t,e){return e.updatetime-t.updatetime})),{deviceRecords:i,forwardAlarmCount:r,abnormalDrivingCount:s,blindZoneAlarmCount:l}}}),mounted:function(){this.addressmap={},this._localPlayRootPath="",this.deviceids=[]}},N=z,j=(a("1767"),Object(h["a"])(N,i,r,!1,null,null,null)),J=j.exports;e["default"]=J},"3b13":function(t,e,a){},"57c9":function(t,e,a){"use strict";var i=a("0595");e["a"]=i["a"]},"6f8c":function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAMCAYAAABvEu28AAAAAXNSR0IArs4c6QAAAcJJREFUOE+Nkz1oVEEUhb8zySbRxJ/CvBVREEEEQRQMdqZIYa1NCivBTgRRCfvTbFziZtVChFT2FjbaCmIhoo2ghRYGrCN5kkLNqhvdOTLPCCl0zTRzmXvv4Zxz74gNJ6u77MidIBQhYpTiVBKNVVwEmZJF5WNb7/+0a8+sty7N6mt6yGp+JPjkSEs9PgyMsbpk1lJu72dKMTDaG2a3zQXMkbytkym3v+ERlWt+6VRsZhAX87bObmT5rzir+G4M3AvmEnBYWdUHMAcRC4imh3i41qXUDyyYWBJTwE2Jq70ei4X+cs33baaBFWB0M4yAVWAX4nE+r1MqVz1leLLJ5r+WGaaV1XxNZiKahSAqNkcRO/8D/AV4Y3Fd5lxSkjxqAFfytnYUMiuuR3Ea81yBDBdSkwUdm2WJE5gX+Q3NFJOuOkc8SFM7bzNP2g94a5iwuC3zTGaLxWDBTvSIfLM4JqgLXhsOIYYwreTRZZtJxD7g+LqkTh/Tk6xtv7F5Z1jEvNJ4xZMST9enIJu5EFjBZAnMMFI0iS6RjpMfgWGbJmBgO+KMxhseU5emxKDNAIFm3tJyP7PTb/j5nVsSvZh26gdzvwDZObp7jwp+4AAAAABJRU5ErkJggg=="},7031:function(t,e,a){"use strict";a("3b13")},"8d09":function(t,e,a){"use strict";a("a818")},a818:function(t,e,a){},b384:function(t,e,a){"use strict";a("0505")},c6d4:function(t,e,a){},d590:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA8AAAAPCAYAAAA71pVKAAAAAXNSR0IArs4c6QAAAbZJREFUOE+NkztoFFEYhb8ziyYi0YDZCWKChSCkkdhY+WJVRLQSbFJZ+ShULFxn1yIImp10PipTCKJga5NGmxgULDQEUVArrSSzSwgaEIyZIwOuTDYTyC3vPd9/Dof/iqJzxqVwF1NAD/AjmecIE1rqlKqIDas+RsBzifs2lyzONht6tC64HPmO4EpO/DSJNbIuOIy8CGwGPgKzQCWZZ2dn9FWx+697xOJhKva0GvqSuYWRP1hMNBu6l3dfDUeeMnxOYp1vC8PIDzD7knHtXRMeuOpNv7t4D1yU6HbKAQVUbIYyKImz9uX2gBXO/1qeBH4BWzoLSsXhVkMvC+H+yHcNl3PQN8w7Ap5hTgAHk1gDxc6RvxveIl5YvGqNaaYt3HbDO0p/OEXAnMXX5phm/8cOI18AbiWx+jrj9o66d+GmFso135apZ+82tTz8WmJ6rqFaX9U9KjEsOIqpAD/JEkE9DRgsLXPI4rHCmk87ZbfEaCawWZLYD2zIJXgjM2lxLYm1tVz3sFJmFEZOgHLhB8ldWpyUOQccB7qzvdf2qoeWAwaBdK0BFhtJWWyOazqMHBs+Nbt48heUSaTJuD+TCAAAAABJRU5ErkJggg=="},d91c:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("transition",{attrs:{name:"moveX"}},[e("div",{directives:[{name:"show",rawName:"v-show",value:t.value,expression:"value"}],staticClass:"safety-day-report-drawer"},[e("div",{staticClass:"safety-day-report-drawer-title",staticStyle:{height:"24px"}},[e("span",{domProps:{textContent:t._s(t.recordTitle)}}),e("div",{staticStyle:{float:"right",cursor:"pointer"},on:{click:t.handleClose}},[e("i",{staticClass:"el-icon-close",staticStyle:{"font-size":"16px"}})])]),e("div",{staticClass:"safety-day-report-drawer-title"},[e("span",{domProps:{textContent:t._s(t.recordTime)}})]),e("div",{staticClass:"safety-day-report-drawer-video"},[e("div",{staticStyle:{border:"1px solid #e8eaec"}},[e("el-carousel",{ref:"carousel",attrs:{trigger:"click",height:"280px",autoplay:!1}},t._l(t.imageAndVideoList,(function(a,i){return e("el-carousel-item",{key:i,attrs:{name:"carousel"+i}},[a.image&&""!=a.url?e("div",{staticClass:"full"},[e("img",{staticStyle:{width:"100%",height:"100%"},attrs:{src:a.url}})]):t._e(),a.image?t._e():e("div",{staticClass:"full"},[e("video",{staticStyle:{width:"100%",height:"100%"},attrs:{src:a.url,autoplay:"",controls:"",loop:""}})]),e("div",{directives:[{name:"show",rawName:"v-show",value:a.image&&""==a.url,expression:"item.image && item.url == ''"}],staticClass:"full default-images"})])})),1)],1),e("div",{staticClass:"safety-day-report-drawer-video-ctrl"},[e("el-row",{staticStyle:{height:"100%"},attrs:{gutter:4}},t._l(t.imageAndVideoList,(function(a,i){return e("el-col",{key:i,staticStyle:{height:"100%"},attrs:{span:6}},[a.image&&""!=a.url?e("div",{staticClass:"full",on:{click:function(e){return t.$refs.carousel.setActiveItem("carousel"+i)}}},[e("img",{staticStyle:{width:"100%",height:"100%",cursor:"pointer"},attrs:{src:a.url}})]):t._e(),a.image?t._e():e("div",{staticClass:"safety-video full",on:{click:function(e){return t.$refs.carousel.setActiveItem("carousel"+i)}}},[e("video",{staticStyle:{width:"100%",height:"100%",cursor:"pointer"},attrs:{src:a.url}}),e("div",{staticClass:"video-play-icon"},[e("i",{staticClass:"el-icon-video-play"})])]),e("div",{directives:[{name:"show",rawName:"v-show",value:a.image&&""==a.url,expression:"item.image && item.url == ''"}],staticClass:"full default-images",staticStyle:{cursor:"pointer"},on:{click:function(e){return t.$refs.carousel.setActiveItem("carousel"+i)}}})])})),1)],1)]),e("div",{staticClass:"safety-day-report-drawer-switch",on:{click:function(e){t.showMap=!t.showMap}}},[t.showMap?e("div",{staticClass:"common_icon_move_down"}):e("div",{staticClass:"common_icon_move_up"})]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.showMap,expression:"showMap"}],staticClass:"safety-day-report-drawer-map"},[e("ReportMap",{ref:"mapIns"})],1)])])},r=[],s=(a("a630"),a("14d9"),a("d3b7"),a("3ca3"),a("159b"),a("32eb")),l=a("6e52"),o={name:"SafetyDetailReport",props:{value:{type:Boolean,default:!1}},data:function(){return{showMap:!1,recordTitle:"",recordTime:"",imageAndVideoList:[{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""}]}},watch:{showMap:function(t){t&&this.row&&this.$refs.mapIns.singleMarkerToMap({callon:this.row.lon,callat:this.row.lat})}},components:{ReportMap:s["a"]},methods:{handleClose:function(){this.imageAndVideoList=[{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""},{image:!0,url:"",videoUrl:""}],this.$emit("input",!1)},setRecordInfo:function(t){var e=this;this.row=t,this.$refs.carousel.setActiveItem("carousel0"),this.recordTitle=l["a"].getDeviceNameByDeviceId(t.deviceid)+" - "+t.deviceid,this.recordTime=t.event+" - "+t.dateStr,this._localPlayRootPath=t._localPlayRootPath,this.imageAndVideoList=this.getImageAndVideoList(t),this.$nextTick((function(){var a=document.getElementsByClassName("default-images");a&&a.length>0&&Array.from(a).forEach((function(t){t.style.backgroundImage="url('./custom/tvdefault.jpg')"})),1==e.showMap&&e.$refs.mapIns.singleMarkerToMap({callon:t.lon,callat:t.lat})}))},getImageAndVideoList:function(t){var e="",a=[],i=this.getMediaTypeWithIndex(t,2,1),r=this.getMediaTypeWithIndex(t,0,1),s=this.getMediaTypeWithIndex(t,0,2),l=this.getMediaTypeWithIndex(t,0,3);i&&a.push({image:!i,url:i}),r&&a.push({image:!0,url:r}),s&&a.push({image:!0,url:s}),l&&a.push({image:!0,url:l});for(var o=a.length,n=0;n<4-o;n++)a.push({image:!0,url:e});return a},getMediaTypeWithIndex:function(t,e,a){for(var i=null,r=0,s=1;s<6;s++){var l=t["attachfile"+s];if(l&&1===t["attachstatus"+s]&&t["attachfiletype"+s]===e&&(r++,r===a)){i=this._localPlayRootPath+l;break}}return i}}},n=o,c=(a("0155"),a("2877")),d=Object(c["a"])(n,i,r,!1,null,"1e787c6e",null);e["a"]=d.exports},e079:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABwAAAAaCAYAAACkVDyJAAAAAXNSR0IArs4c6QAAA51JREFUSEutll+IVHUUx7/nzri6kZlQL7WJ0+5vFmnvb9ZYvfcOwSr4IGH0VEEqgj0UKyhYFJJRZAU9lFCJvqiBfx6sBylCJKKSaO6sg+7cydzmjspCVg9aasr+wbkn7nV2ub/fzuxcsfMwML97zvnc3znf3/ldKlaq7zHTmyBcQWgMYtB+R/a8Ef1vWHHkQpaNwAWQAmEq9APoSnqq/tTAQO+d2ARG31+6tKDz3/p5gJfG/RnY4EhxJL7mVvzNYOzX8p6zpehLwIpcKPz5aXR0YXoqNQZgcTwwxWSuyPX8okC92i6Ad2ovd9SRYn0SaAQM7ecRf7lh4IwWdHV8YbprdSYzoZS34n/FjGcUKPE2x8x+0g46Awwdm5WMgB8tKVbpiQqeP0bAkvi6AR5cKbOn5oIqwAZ0DxhDWsl2O1Jsj68Vzp5fSqn0xem2NPozmZoKuuYS0SxgBPX8AgC7nYiKleo6Zvr6bkTUFFgq/XHf7Y5bvycRUbHiv82Md+JQAo5YUmxoVtqmwP9FRMCrjhQf69CWwNCxWK5tYuLPtbe/JxHNCWz08zMAW1Qof2rJ7NZ2IgIwYRjpzMq+zF/Tvm2BrUQEwkbbFIfV89lURKO2FMvuCtiA/gpgJjA6BgHWWv3ipAL1qi8zaJ+qcP7Okdk1jaPTbjYApVJp3u35i86BIdTpgtWOKX7QgK8z6EMt65e2FM8lBrqeP3t3xOssM/uN0kfPX0+AUmYQhm1TWIlL6nr+IQDKmSLi9y0zqwzw4RH/icCAMugBXEcnlthC3EgEdMv+EAh7tPKcsKV4Or4WlrzesegyAw8raiZjhWV2l7Rj1byHbtm3QQhHXMzoT8vs7iKiIL7qerVvAY5EMW3MGHJyYq+evfks9f0HMI7LAO5XcIHRa/V3VxVY2f8AhB1a4oO2FJubbaXV8D4NYEBT5AuOKY6pO/OfBXBcTcyeLbO5VtqfBSyUa3uJ+BUlgPGRnROvKfIvj2aYUuH1FLeJwJh8NN/X93ciYItvllO2FIN6gnu+gN3KRQmul7XE14KbCx7J5x8b10oZljEs54wRsN2SYnernU2vRyWN7r/5t8bAeCgeEAR4Mt8vzqqw6lsAvav0F/jCkeL5drDwOUVjq+PBCsC9SgDhJdsUB5S+edUXGaR8OgKo2VIoI28uMBW86k4C7QJwteFIYDps53q2xQOHvd8eZxguA50AJsOXJeCfehAM5vt7wyOUyP4DVl5vKimV29sAAAAASUVORK5CYII="},e561:function(t,e,a){"use strict";var i=a("ea22");e["a"]=i["a"]},e68e:function(t,e,a){},ea22:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-choice multi-choice-vehicle"},[e("div",{staticClass:"multi-choice-input"},[e("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:t.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:t.isQueryInitData,selectDeviceIds:t.multipleDeviceids},on:{onTreeCheck:t.onTreeCheck}})],1)])},r=[],s=a("5530"),l=(a("4795"),a("2f62")),o=a("2df7"),n={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(s["a"])({},Object(l["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:o["a"]},methods:Object(s["a"])(Object(s["a"])({},Object(l["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(t){this.$emit("onSelectDevice",t),this.setMultipleDeviceids(t)},clearText:function(){var t=this;setTimeout((function(){t.$refs.ztreeDevice.clearText()}),300)}})},c=n,d=(a("7031"),a("2877")),u=Object(d["a"])(c,i,r,!1,null,null,null);e["a"]=u.exports}}]);