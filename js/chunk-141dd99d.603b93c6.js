(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-141dd99d"],{"0debe":function(e,t,a){"use strict";var i=a("b4aa");t["a"]=i["a"]},"1d35":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAABaRJREFUaEPFmXuIFVUcx7+/ufeeu5pYEYbpzlxN2ztXl/CVWVJZ+SiLHtLDIkmhksoi0CjCHvSAHpaQFmqQUYJhilH0EEIhTM3HLontzObr3rmbpP4j5OvO3J1fzLIb7nbvnDP3jnZgYeF8f9/f7zPnzDlnziXE2OxGcTVrmEUEnZgNJjKIYTDz3yAqAugAcweAfeWE2NicP/VXvempXgO7MX0bNL6ZgDsYGB3Fj4FvmWhTg5Zcf+XhU0ejxPZoawZo05M3aqQtAHB/LYn7xBSYaHkDlZYPz+NsFL+aAGwj/QnAj0VJpKQl7AXjTdNxv1LSA4gMYBtiXUxPPazGB1QhIgFcoOJ7wJQglAFsI7UUoOdUhzYG3Ukmf0auUN4W5qUE0KaLezTCxghFHQGwh4GWBGh3J/whGrTxDB4PIPhTbdvKZ9wZzcdxslqAFKB1GC7p54stAMYoZWUsMYvu89W0dqbhFrD/BoDrlfxAK0yn9GTNAHZGLAYjSBjaGHy008ddzR3eTpk26Lf09EIiXqKihU+3mx2lHytpQ0dg3yAMSPUTrQyMlMzDg1nHDdVUim8ZjEH9hTgmgyDCl9mC+1BkACuTXkDMy2QJWNOG5/Jn8zJdpX7LSM0n0ApZrK/xdaPy3o6+utARaNfFdiZMCjNn5nm5oveZrICwftsQmwBMl+R5P1f0FikDWMMahpHvHw6fOnw063iD6yk+iG3TU09pRB9J3rLNpuPdqg6gp+YS0WrJ3N+VddyJ9QLYRnIyoG2V+JwwHfdSZYB2Q6xmYK7EdIPpuPfVC7B7PFIDjovTAJKhD0xDLpt37XM1Vd8BSxc7iHCtpLh3Tcd9oV6AIN42xB4A40K9KiynVQFsXbSD0BQ+hWhV1inNjwngTwBDwrw0xsNNRXet0gjYeuoYiAaFrgzgn3KON61egP16ekQn8QGZDzE/nS16HysBWLrwiMLnJIBDpuOOkCWW9bfpYrZG6PVkK8YwFptF9y0lgHZD7JftwIGRRnRnU6H0nazIsH7bEJ8DmKPgMcd03DVKALYhgq8i+QrDcMyim1FIXlFiZdKLiPk9lfgE8birCl6rEoBliNcIeFXFGKCtplO6QU3bW2UbghXjyifL7sUTjiBYbv9tVVehdl3MZpV52W3F4GU5x3tWsRhYQ3EZJURwwpygEsNAa85x/7PMVgdo7DcUWrmFQZerJAg0DBwg0uabhbObq8VsAZJXGOkFAC9V9e3WvWM67ot9Y0IPc7Yh3gYQeaNixkYQ9jLRztOJ0i/9PaET8WSCNobBE0m2YVUgowSPyR72fosEYA1NN1GCWwBcFPFpxS1fZzrug5VMpZ+U7UbqQwY9E3dFUfyIcW+26H5dE8DvmdTYBFMwCv9X22WGnHilIxBUHW1JjZeTiGZmC6UfqrkqAQTBtp7aAqIp8ZYncSO8Yhbc0AsFZQCrMTmFNC24XrlQ7RvTce+WJVMGuMBT6UgZmNbsuG2xAnRNJaNr95whM66n3wc/OsrxggOetEUagcDtj4zI+Yzgpar5ABdWVdQjSWSArqmUEbOIsUH6eKILtg8su1OH9DmwhdnUBBAYtuviJSb0+riIXm+vCE9jf2pTsfxzFJ+aAbrfhy8APBIlYdX1nGlhtlj6IKpXXQD7R2Jgp5v+HuDJUROfqyfwsmyEo3jv2HoyB7+XGmJUEgiuBhtrsWJgfc5xa/6hsK4R6CnY0tPTiTiAiNhq/5LrSRQLQNf7oKfmgejTCAQHzRqu5Pv6xwbQBZERL4PxugLEqTOa2zg2jxMK2lBJrABdy6uRXsngJ8LXbhqRdUqH6i0+iI8doHt5De6JZlYskPkas+jtjqP48wbQDRF8QfU6TXb6PGl0h/drXMWfV4DA3DLSqwj8ePC/xv5NUXdZFdDzMoXOTWxlxNoEaE2914/VYP4BWLreQEwf71wAAAAASUVORK5CYII="},5413:function(e,t,a){"use strict";a("c41d")},6378:function(e,t,a){},b4aa:function(e,t,a){"use strict";a("b0c0"),a("498a");var i=function(){var e=this,t=e._self._c;return t("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.handleClickOutside,expression:"handleClickOutside"}],staticClass:"search-address"},[t("div",{staticClass:"search-address-input"},[t("el-input",{ref:"input",style:e.inputStyle,attrs:{clearable:"",placeholder:e.$t("tips.searchAddress"),"prefix-icon":"el-icon-search"},on:{focus:function(t){e.isFocus=!0},blur:e.onBlur},nativeOn:{click:function(t){e.show=!0}},model:{value:e.textVal,callback:function(t){e.textVal="string"===typeof t?t.trim():t},expression:"textVal"}})],1),e.show&&e.addressList.length>0?t("div",{staticClass:"search-address-list"},[t("el-scrollbar",{staticStyle:{height:"100%"}},e._l(e.addressList,(function(a,i){return t("div",{staticClass:"search-address-list-item",on:{click:function(t){return e.handleClickItem(a)}}},[t("div",{domProps:{textContent:e._s(a.name)}}),t("div",{staticClass:"ellipsis",domProps:{textContent:e._s(a.address)}})])})),0)],1):e._e()])},n=[],s=a("5530"),o=(a("99af"),a("14d9"),a("d3b7"),a("159b"),a("9169")),r=a("c276"),c=a("2ef0"),l=a("2f62"),d=a("7cf8"),p=a("a167"),m=a("1d35"),h={name:"SearchAddress",data:function(){return{show:!1,isFocus:!1,textVal:"",addressList:[]}},watch:{textVal:function(e){this.onSearchAddress(this,e)},isFocus:function(e){e&&0==this.addressList.length&&this.textVal.length>0&&this.queryList(this.textVal)}},computed:Object(s["a"])(Object(s["a"])({},Object(l["b"])(["isZh","mapType"])),{},{inputStyle:function(){return{width:this.isFocus?"230px":"160px",transition:"width 0.3s ease 0s"}}}),directives:{Clickoutside:o["a"]},mounted:function(){this.addressMarker=null},methods:{onBlur:function(){this.isFocus=this.show},handleClickOutside:function(){this.isFocus=!1,this.show=!1,this.$refs.input.blur()},handleClickItem:function(e){var t=this;this.isFocus=!0;var a=this.$parent,i=e.point;e.point=i,null==this.addressMarker?(this.addressMarker=this.createPointMarker(e).on("mousedown",(function(){this.openInfoWindow(this.getCoordinates())})),a.addressLayer.addGeometry(this.addressMarker)):this.addressMarker.hide(),a.setMarkCircularInfo&&a.setMarkCircularInfo(e);var n=this.getInfoOptions(e);a.mapIns.setCenter(i),a.mapIns.setZoom(18),this.addressMarker.setInfoWindow(n),this.addressMarker.openInfoWindow(i),this.addressMarker.setCoordinates(i),this.addressMarker.show();var s=this.addressMarker.getInfoWindow(),o=function e(a){a.target.removeEventListener("hide",e),t.addressMarker.hide()};s.addEventListener("hide",o)},createPointMarker:function(e){var t=e.point,a=[t.x,t.y];return new maptalks.Marker(a,{symbol:{markerFile:m,markerWidth:30,markerHeight:30,markerRotation:-0,markerDy:0,markerDx:0}})},onSearchAddress:Object(c["debounce"])((function(e,t){""==t?(e.show=!1,e.addressList=[]):e.queryList(t)}),1e3),queryList:function(e){var t=this,a="bMap"==this.mapType,i=this.$parent.mapIns,n=i.getCenter(),s=null,o=null;if(a){var c=Object(p["d"])(n.x,n.y);s=c[0],o=c[1]}else{var l=Object(p["h"])(n.x,n.y);s=l[0],o=l[1]}var m={keyword:e,lon:s,lat:o,map:this.mapType};Object(d["ib"])(m).then((function(e){var a=e.places,i=[];a&&a.forEach((function(e){var t=Object(p["i"])(e.lon,e.lat);e.point={y:t[1],x:t[0]},e.lon=Object(r["Vb"])(e.lon),e.lat=Object(r["Vb"])(e.lat),e.address=null==e.address?"-":e.address,e.telephone=null==e.telephone?"-":e.telephone,i.push(e)})),t.show=i.length>0,t.addressList=i}))},getInfoOptions:function(e){var t=this.$t("home.phone"),a=this.$t("monitor.coordinate"),i="".concat(e.name,"-").concat(t,":").concat(e.telephone,"-").concat(a,":").concat(e.lat,",").concat(e.lon,"-").concat(e.address),n={content:'\n                    <div class="search-address-info">\n                        <div class="search-address-info-title">'.concat(e.name,' <i class="el-icon-document-copy" style="font-size:12px;cursor: pointer;" onclick="onClikCopyDevice(\'').concat(i,"')\"></i></div>\n                        ").concat("-"==e.telephone?"":"<div>".concat(t,":").concat(e.telephone,"</div>"),"   \n                        <div>").concat(e.address,' <i class="el-icon-document-copy" style="font-size:12px;cursor: pointer;" onclick="onClikCopyDevice(\'').concat(e.address,"')\"></i></div>\n                        <div>").concat(a,":").concat(e.lon,",").concat(e.lat,' <i class="el-icon-document-copy" style="font-size:12px;cursor: pointer;" onclick="onClikCopyDevice(\'').concat(e.lon,",").concat(e.lat,"')\"></i></div>\n                    </div>\n                "),width:"240",autoOpenOn:null,autoCloseOn:!1,animation:!1,autoPan:!1,animationDuration:0};return n}}},u=h,f=(a("5413"),a("2877")),v=Object(f["a"])(u,i,n,!1,null,null,null);t["a"]=v.exports},c41d:function(e,t,a){},d414:function(e,t,a){"use strict";a("6378")},e2aa:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"batch-manage mark-position full"},[t("div",{staticClass:"batch-manage-left"},[t("div",{staticClass:"batch-manage-inner full"},[t("div",{staticClass:"batch-manage-inner-title"},[t("i",{staticClass:"circle"}),t("b",{domProps:{textContent:e._s(e.$t("common.selectDevice"))}}),t("span",{domProps:{textContent:e._s(e.$t("bgManage.markPosition"))}})]),t("div",{staticClass:"batch-manage-inner-content"},[t("SearchDeviceZtree",{ref:"ztree",on:{onTreeCheck:e.onTreeCheck,onClickDevice:e.onClickDeviceNode}})],1)])]),t("div",{staticClass:"batch-manage-right"},[t("div",{staticClass:"batch-manage-inner-title"},[t("i",{staticClass:"circle"}),t("b",[e._v(e._s(e.$t("common.modifiedDevice")))]),t("b",[e._v(e._s(e.changeCount))]),t("div",{staticClass:"batch-manage-btns"},[t("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"import-mark-file"}}),t("el-button",{staticStyle:{position:"relative",top:"2px"},attrs:{type:"primary",size:"mini"},on:{click:e.downloadTemp}},[e._v(e._s(e.$t("insure.templateDownload")))]),t("el-button",{staticStyle:{position:"relative",top:"2px"},attrs:{type:"primary",size:"mini"},on:{click:e.importMarks}},[e._v(e._s(e.$t("insure.importFile")))]),t("el-button",{staticStyle:{position:"relative",top:"2px"},attrs:{type:"primary",size:"mini"},on:{click:e.saveAll}},[e._v(e._s(e.$t("common.submitAll")))])],1)]),t("div",{staticClass:"batch-manage-inner-content mark-position-right"},[t("MapMark",{ref:"mapIns"})],1),t("vxe-modal",{attrs:{title:e.$t("monitor.coordinateType"),className:"vxe-modal-visible modal-padding0",value:e.showCoordinateType,width:"320px"},on:{hide:function(t){e.showCoordinateType=!1},close:function(t){e.showCoordinateType=!1}}},[t("el-row",{staticClass:"margin_b10"},[t("el-col",{attrs:{span:24}},[t("LabelWrap",{attrs:{label:e.$t("monitor.coordinateType")}},[t("el-select",{staticStyle:{width:"100%"},model:{value:e.coordinateType,callback:function(t){e.coordinateType=t},expression:"coordinateType"}},[t("el-option",{attrs:{label:e.$t("monitor.wgs84"),value:"wgs84"}}),t("el-option",{attrs:{label:e.$t("monitor.gcj02"),value:"gcj02"}}),t("el-option",{attrs:{label:e.$t("monitor.bd09"),value:"bd09"}})],1)],1)],1)],1),t("el-row",{staticClass:"margin_b10"},[t("el-col",{attrs:{span:20,offset:2}},[t("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e.handleDetermineImport}},[e._v(e._s(e.$t("common.determine")))])],1)],1)],1)],1)])},n=[],s=a("5530"),o=(a("c975"),a("baa5"),a("d81d"),a("14d9"),a("fb6a"),a("a9e3"),a("d3b7"),a("498a"),a("159b"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"full",staticStyle:{position:"relative"}},[t("div",{staticClass:"full",attrs:{id:e.mapId}}),t("SwitchMapType",{attrs:{mapType:e.myMapType},on:{"select-map":e.onSelectMap,"switch-traffic":e.onSwitchTraffic}}),t("SearchAddress"),t("vxe-modal",{attrs:{title:e.$t("common.selectTime"),className:"vxe-modal-visible modal-padding0",value:e.dialog,width:"320px"},on:{hide:function(t){e.dialog=!1},close:function(t){e.dialog=!1}}},[t("div",{staticStyle:{padding:"20px 0px"}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-date-picker",{attrs:{type:"datetime","picker-options":e.unicoPickerOptions},model:{value:e.time,callback:function(t){e.time=t},expression:"time"}})],1),t("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[t("el-button",{staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:e.onTimeChange}},[e._v(e._s(e.$t("common.determine")))])],1)])])],1)}),r=[],c=(a("d9e2"),a("99af"),a("ac1f"),a("5319"),a("4795"),a("2f62")),l=a("44ca"),d=a("a167"),p=a("c276"),m=a("532f"),h=a("6e52"),u=a("0debe"),f=a("7cf8"),v=a("5101"),g=a("6fea"),y=a("5867"),b=30,k={name:"MapMark",data:function(){return{dialog:!1,myMapType:"",time:new Date}},computed:Object(s["a"])(Object(s["a"])({},Object(c["b"])(["isZh","mapType","userSetting"])),{},{mapId:function(){return"map".concat(this._uid)}}),mixins:[y["a"]],components:{SwitchMapType:m["a"],SearchAddress:u["a"]},methods:{onTimeChange:function(){this.updatetime=this.time.getTime();var e=v["a"].longToLocalDateTimeStr(this.updatetime);document.getElementById("mark_updatetime").innerHTML=e;var t=this.lastPositions[this.deviceid],a=this.mapIconMarkers[this.deviceid];t._changedtime=!0,t.updatetime=this.updatetime,a.setInfoWindow(this.getInfoWindowContent(t)),a.openInfoWindow(),this.calcChangeCount(),this.dialog=!1},onSelectMap:function(e){this.setMapTypeLayer(e)},onSwitchTraffic:function(e){var t="bMap"==this.mapType;e?t?this.baiduTrafficLayer.show():this.googleTrafficLayer.show():t?this.baiduTrafficLayer.hide():this.googleTrafficLayer.hide()},addTrafficLayer:function(e){null==this.baiduTrafficLayer&&(this.baiduTrafficLayer=new maptalks.TileLayer("baidutraffic",{urlTemplate:function(e,t,a){var i="",n={x:e,y:t,z:a,domain:i,time:Date.now()},s=/\{ *([\w_]+) *\}/g;return l["g"].replace(s,(function(e,t){var a=n[t];if(void 0===a)throw new Error("No value provided for variable "+e);return"function"===typeof a&&(a=a(n)),a}))}}),this.mapIns.addLayer(this.baiduTrafficLayer),this.baiduTrafficLayer.hide()),null==this.googleTrafficLayer&&(this.googleTrafficLayer=new maptalks.TileLayer("googletraffic",{urlTemplate:function(e,t,a){t=Math.pow(2,a)-1-t;var i="",n={x:e,y:t,z:a,domain:i,time:Date.now()},s=/\{ *([\w_]+) *\}/g;return googleTrafficUrlTemplate.replace(s,(function(e,t){var a=n[t];if(void 0===a)throw new Error("No value provided for variable "+e);return"function"===typeof a&&(a=a(n)),a}))}}),this.mapIns.addLayer(this.googleTrafficLayer),this.googleTrafficLayer.hide()),this.onSwitchTraffic(e)},initMap:function(){this.fencePoints=[],this.symbol={lineColor:"#e4393c",lineWidth:2,polygonFill:"rgb(249,239,158)",polygonOpacity:.3},this.lastMapType=this.mapType,this.googleTrafficLayer=null,this.baiduTrafficLayer=null,this.textlayer=null,this.drawTool=null,this.mapIns=new maptalks.Map(this.mapId,{centerCross:!0,center:[window.gdefaultLatLon.lon,window.gdefaultLatLon.lat],zoom:5,minZoom:4,maxZoom:18,scaleControl:!0,dragRotate:!1,dragPitch:!1,zoomAnimation:!1,panAnimation:!1,enableInfoWindow:!0}),this.setMapTypeLayer({mapType:this.mapType,traffic:!1,xiansu:!1,satelliteMap:!1}),this.markLayer=new maptalks.VectorLayer("markLayer").addTo(this.mapIns),this.markLayer.setZIndex(999),this.addressLayer=new maptalks.VectorLayer("addressLayer").addTo(this.mapIns),this.addressLayer.setZIndex(4)},setMapTypeLayer:function(e){var t=this,a=this.lastMapType,i="bMap"==a,n=this.mapIns.getCenter();this.mapIns.removeLayer("baiduText"),this.mapIns.removeLayer("aliText");var s=e.mapType,o=e.satelliteMap,r=e.traffic;if("bMap"==s){t.mapIns.setSpatialReference({projection:"baidu"});var c=new maptalks.TileLayer("base",o?l["e"]:l["d"]);if(t.mapIns.setBaseLayer(c),o){var p=new maptalks.TileLayer("baiduText",l["f"]);t.mapIns.addLayer(p)}if(a!=s){t.mapIns.setMaxZoom(19);var m=Object(d["g"])(n.x,n.y);t.mapIns.setCenter({x:m[0],y:m[1]})}}else if("gMap"==s){c=new maptalks.TileLayer("base",o?l["m"]:l["l"]);if(t.mapIns.setSpatialReference({}),t.mapIns.setBaseLayer(c),t.mapIns.setMaxZoom(19),i){var h=Object(d["c"])(n.x,n.y);t.mapIns.setCenter({x:h[0],y:h[1]})}}else if("aMap"==s){c=new maptalks.TileLayer("base",o?l["b"]:l["a"]);if(t.mapIns.setSpatialReference({}),t.mapIns.setBaseLayer(c),o){p=new maptalks.TileLayer("aliText",l["c"]);t.mapIns.addLayer(p)}if(t.mapIns.setMaxZoom(18),i){var u=Object(d["c"])(n.x,n.y);t.mapIns.setCenter({x:u[0],y:u[1]})}}else if("gChinaMap"==s){if(this.isZh)var f=o?l["k"]:l["i"];else f=o?l["j"]:l["h"];c=new maptalks.TileLayer("base",f);if(t.mapIns.setSpatialReference({}),t.mapIns.setBaseLayer(c),t.mapIns.setMaxZoom(19),i){var v=Object(d["c"])(n.x,n.y);t.mapIns.setCenter({x:v[0],y:v[1]})}}t.addTrafficLayer(r),t.lastMapType=s},fitExtent:function(e){if(e.length>1){var t=new maptalks.Polygon(e);this.mapIns.fitExtent(t.getExtent(),0),t=null}else{var a=e[0];a&&this.mapIns.setCenter(a)}},bringToFront:function(e){var t=e.target.deviceid,a=this.mapIconMarkers[t],i=this.mapTextMarkers[t];a&&(a.bringToFront(),i&&i.bringToFront())},getDummyTrack:function(e){return{address:void 0,altitude:143,maplat:0,maplon:0,callat:0,callon:0,course:0,currentoverspeedstate:2,deviceid:e,exvoltage:-1,gotsrc:"",gpstotalnum:-1,gpsvalidnum:0,humi1:-1,humi2:-1,loadstatus:-1,mileage:23375700,moving:1,online:0,parklat:0,parklon:0,parktime:1684317112815,reportmode:-1,rxlevel:100,speed:61800,srcad0:-1,srcad1:-1,srcad2:-1,srcad3:-1,srcweightad0:-1,status:262151,strstatus:"",strstatusen:"",temp1:536870911,temp2:536870911,temp3:536870911,temp4:536870911,todayMileage:"-",totalacc:void 0,totaldistance:0,updatetime:Date.now(),validpoistiontime:Date.now(),videoalarm:-1,weight:-1,_changedtime:!0,_changedposition:!0}},calcChangeCount:function(){var e=0;for(var t in this.lastPositions){var a=this.lastPositions[t],i=a._changedposition,n=a._changedtime;(i||n)&&e++}this.$parent.changeCount=e},importMarkers:function(e){var t=this;this.markLayer.clear(),this.lastPositions={};var a=this.mapIconMarkers,i=this.mapTextMarkers,n=[];this.$parent.changeCount=e.length,e.forEach((function(e){var s=e.deviceid,o=null,r=null,c=h["a"].lastPositions[s];c||(c=t.getDummyTrack(s)),c.updatetime=e.updatetime,c.callon=e.callon,c.callat=e.callat,c._changedtime=!0,c._changedposition=!0,c.online=Object(p["E"])(c,Date.now());var l="bMap"==t.mapType,m=null;m=l?Object(d["n"])(c.callon,c.callat):Object(d["o"])(c.callon,c.callat),c.maplon=m[0],c.maplat=m[1],t.lastPositions[s]=c,o=t.createIconMarker(c).on("mouseover",t.bringToFront).on("mousedown",t.onClickMarker).on("dragend",t.onMarkerDragend),r=t.createTextMarker(c).on("mouseover",t.bringToFront),n.push(o),n.push(r),a[s]=o,i[s]=r})),this.markLayer.addGeometry(n)},addMarkers:function(e){var t=this;this.markLayer.clear();var a={},i=this.mapIconMarkers,n=this.mapTextMarkers,s=[];e.forEach((function(e){var o=null,r=null,c=t.lastPositions[e];c||(c=h["a"].lastPositions[e],c?(c._changedtime=!1,c._changedposition=!1):c=t.getDummyTrack(e)),a[e]=c,o=t.createIconMarker(c).on("mouseover",t.bringToFront).on("mousedown",t.onClickMarker).on("dragend",t.onMarkerDragend),r=t.createTextMarker(c).on("mouseover",t.bringToFront),s.push(o),s.push(r),i[e]=o,n[e]=r})),this.lastPositions=a,this.markLayer.addGeometry(s),this.calcChangeCount()},setCenter:function(e){var t=this;setTimeout((function(){var a=t.mapIconMarkers,i=a[e];if(i){var n=i.getCoordinates();t.mapIns.setCenter(n)}}),30)},movingToMarker:function(e){var t=this.lastPositions[e],a=this.mapIconMarkers[e];if(a){var i=a.getCoordinates();this.mapIns.setCenter(i),this.time=new Date(t.updatetime),this.updatetime=t.updatetime,a.setInfoWindow(this.getInfoWindowContent(t)),a.openInfoWindow()}},onClickMarker:function(e){var t=e.target,a=t.getInfoWindow();if(!a||0==a.isVisible()){var i=t.deviceid,n=this.lastPositions[i];this.time=new Date(n.updatetime),this.updatetime=n.updatetime,t.setInfoWindow(this.getInfoWindowContent(n)),t.openInfoWindow()}},onMarkerDragend:function(e){var t=e.target,a=t.deviceid,i=this.mapTextMarkers[a];i&&i.setCoordinates(t.getCoordinates());var n=this.lastPositions[a];n._changedposition=!0;var s=t.getCoordinates(),o="bMap"==this.mapType,r=0,c=0;if(o){var l=Object(d["d"])(s.x,s.y);r=l[0],c=l[1]}else{var p=Object(d["h"])(s.x,s.y);r=p[0],c=p[1]}n.callon=r,n.callat=c,t.setInfoWindow(this.getInfoWindowContent(n)),t.openInfoWindow(),this.calcChangeCount()},getInfoWindowContent:function(e){var t=e._changedtime,a=e._changedposition,i=this.isZh,n="",s=Object(p["I"])(e),o=Object(p["Vb"])(e.callat),r=Object(p["Vb"])(e.callon);(null==s||s.length<1)&&(s="-",Object(f["v"])([{lat:o,lon:r}]).then((function(e){if(e.points){var t=e.points[0];if(t&&null!=t.address){Object(p["rb"])({callat:t.lat,callon:t.lon},t.address);try{var a=document.getElementById("marker_track_address");a&&(a.innerHTML=t.address)}catch(i){}}}})));var c=e.deviceid,l=v["a"].longToLocalDateTimeStr(e.updatetime),d=i?e.strstatus:e.strstatusen,m=e.endtime-e.starttime,u=h["a"].getDeviceNameByDeviceId(c);return n+='<div class="ellipsis" style="height:20px;line-height:20px;"><span style="color:#000000;">'.concat(this.$t("alarm.devName"),"</span>: <span>").concat(u,'</span><i class="el-icon-document-copy" style="font-size:12px;cursor: pointer;" onclick="onClikCopyDevice(\'').concat(u,"')\"></i></div>"),n+='<div class="ellipsis" style="height:20px;line-height:20px;"><span style="color:#000000;">'.concat(this.$t("alarm.devNum"),"</span>: <span>").concat(c,'</span><i class="el-icon-document-copy" style="font-size:12px;cursor: pointer;" onclick="onClikCopyDevice(\'').concat(c,"')\"></i></div>"),n+='<div class="ellipsis" style="height:20px;line-height:20px;"><span style="color:#000000;">'.concat(this.$t("reportForm.updatetimeStr"),'</span>: <span id="mark_updatetime" style="color:').concat(t?"red":"#000",'">').concat(l,"</span></div>"),n+='<div class="ellipsis" style="height:20px;line-height:20px;"><span style="color:#000000;">'.concat(this.$t("reportForm.posiType"),"</span>: <span>").concat(Object(p["ab"])(e),"</span></div>"),n+='<div class="ellipsis" style="height:20px;line-height:20px;"><span style="color:#000000;">'.concat(this.$t("monitor.coordinate"),'</span>: <span style="color:').concat(a?"red":"#000",'">').concat(r,",").concat(o,'</span><i class="el-icon-document-copy" style="font-size:12px;cursor: pointer;" onclick="onClikCopyDevice(\'').concat(r,",").concat(o,"')\"></i></div>"),n+=d?'<div class="ellipsis" style="height:20px;line-height:20px;"><span style="color:#000000;">'.concat(this.$t("home.status"),"</span>: <span>").concat(d,"</span></div>"):"",m>=6e4*this.parkIntervaltime&&(n+='<div class="ellipsis" style="height:20px;line-height:20px;"><span style="color:#000000;">'.concat(this.$t("reportForm.parkingDuration"),"</span>: <span>").concat(Object(p["Sb"])(m),"</span></div>")),n+='<div><span id="marker_track_address">'.concat(s,"</span></div>"),n+='<div class="function-item" style="text-align:center;">\n                            <div class="el-button el-button--primary el-button--mini is-plain el-dropdown-selfdefine" onclick="onClikMapInfoWindowMark(\'settime\',\''.concat(e.deviceid,"')\">").concat(this.$t("common.selectTime"),'</div>  \n                            <div class="el-button el-button--primary el-button--mini is-plain el-dropdown-selfdefine" style="width:80px;" onclick="onClikMapInfoWindowMark(\'device\',\'').concat(e.deviceid,"')\">").concat(this.$t("common.save"),"</div>\n                        </div>"),{animation:!1,width:280,dy:5,content:"<div>".concat(n,"</div>")}},createIconMarker:function(e){this.mapType;var t=[e.maplon,e.maplat],a=h["a"].deviceInfos[e.deviceid],i=a?a.devicename:e.deviceid,n=a.icon,s=new maptalks.Marker(t,{cursor:"pointer",draggable:!0,properties:{name:i},symbol:[{markerFile:Object(g["b"])(e,n),markerWidth:b,markerHeight:b,markerRotation:Object(g["d"])(n)?0:360-(e.course||0),markerHorizontalAlignment:"middle",markerVerticalAlignment:"middle"}]});return s.deviceid=e.deviceid,s},createTextMarker:function(e){this.mapType;var t=e.deviceid,a=[e.maplon,e.maplat],i=h["a"].deviceInfos[t],n=i?i.devicename:t,s="#"+Object(p["h"])(this.userSetting.mapdevicelabel_fontcolor,6),o="#"+Object(p["h"])(this.userSetting.mapdevicelabel_backcolor,6),r=0!==this.userSetting.mapdevicelabel_showbackcolor,c=0!==this.userSetting.mapdevicelabel_showborder,l="#"+Object(p["h"])(this.userSetting.mapdevicelabel_bordercolor,6),d=0!==this.userSetting.mapdevicelabel_fontbold,m=1==this.userSetting.mapdevicelabel_usingcartagcolor;if(m){var u=Object(p["q"])(i.cartagcolor);s=u.fontColor,o=u.bgColor}var f=new maptalks.Label(n,a,{cursor:"pointer",textSymbol:{textFill:s,textSize:this.userSetting.mapdevicelabel_fontsize,textWeight:d?"bold":"normal",textDy:b},boxStyle:{padding:[5,4],verticalAlignment:"top",horizontalAlignment:"middle",symbol:{markerFillOpacity:.8,markerFill:r?o:"transparent",markerLineColor:c?l:"transparent",markerLineWidth:1,markerLineOpacity:1}}});return f.deviceid=t,f},saveAll:function(){var e=[];for(var t in this.lastPositions){var a=this.lastPositions[t],i=a._changedposition,n=a._changedtime;(i||n)&&e.push({deviceid:a.deviceid,updatetime:a.updatetime,lon:a.callon,lat:a.callat})}this.setPositionLasts(e)},setPositionLasts:function(e){var t=this,a=Date.now(),i="bMap"==this.mapType;Object(f["nb"])({positions:e}).then((function(e){if(0==e.status){var n=e.records,o="";n.forEach((function(e){o=e.deviceid,e.online=Object(p["E"])(e,a);var n=null;n=i?Object(d["n"])(e.callon,e.callat):Object(d["o"])(e.callon,e.callat),e.maplon=n[0],e.maplat=n[1],h["a"].lastPositions[e.deviceid]=e,t.lastPositions[e.deviceid]=Object(s["a"])(Object(s["a"])({},e),{},{_changedposition:!1,_changedtime:!1})}));var r=t.mapIconMarkers[o],c=t.lastPositions[o];r.setInfoWindow(t.getInfoWindowContent(c)),r.openInfoWindow(),t.calcChangeCount(),t.$XModal.message({message:t.$t("tips.setSucc"),status:"success",zIndex:9999})}else t.$XModal.message({message:t.$t("tips.setFail"),status:"error",zIndex:9999})}))}},mounted:function(){var e=this;this.mapIns=null,this.carMarker=null,this.googleTrafficLayer=null,this.baiduTrafficLayer=null,this.mapIconMarkers={},this.mapTextMarkers={},this.lastPositions={},this.myMapType=this.mapType;var t=this;if(void 0==window.maptalks){var a=document.createElement("script");a.src="./maptalks/maptalks.min.js",a.onload=function(){var e=document.createElement("script");e.src="./maptalks/maptalks.markercluster.js",e.onload=function(){t.$nextTick(t.initMap)},document.head.appendChild(e);var a=document.createElement("script");a.src="./js/MyAreaTool.js",a.onload=function(){},document.head.appendChild(a)},document.head.appendChild(a)}else t.$nextTick(t.initMap);window.onClikMapInfoWindowMark=function(t,a){if(e.deviceid=a,"settime"==t)e.dialog=!0;else{var i=e.lastPositions[a],n=[{deviceid:a,updatetime:e.updatetime,lon:Object(p["Vb"])(i.callon),lat:Object(p["Vb"])(i.callat)}];e.setPositionLasts(n)}}}},x=k,w=a("2877"),T=Object(w["a"])(x,o,r,!1,null,null,null),I=T.exports,C=a("b562"),M=a("0139"),L=a("7e15"),A={name:"MarkPosition",data:function(){return{searchText:"",changeCount:0,reloadLoading:!1,showCoordinateType:!1,coordinateType:"wgs84"}},components:{MapMark:I,LabelWrap:M["a"],SearchDeviceZtree:L["a"]},computed:Object(s["a"])({},Object(c["b"])(["isQueryInitData","isZh"])),watch:{isQueryInitData:function(e){e&&this.initImport()}},mounted:function(){this.isQueryInitData&&this.initImport()},methods:{downloadTemp:function(){var e=document.createElement("a");e.href=this.isZh?"./xlsxtemplates/markposition.xlsx":"./xlsxtemplates/markposition_en.xlsx",e.download="markposition.xlsx",e.click()},saveAll:function(){this.$refs.mapIns.saveAll()},importMarks:function(){var e=this.fileEl;e.value="",e.click()},initImport:function(){var e=this,t=document.getElementById("import-mark-file");t.onchange=function(t){var a=t.srcElement.value.lastIndexOf("."),i=t.srcElement.value.slice(a);if(-1!=i.indexOf("xlsx")){var n=t.target.files[0];e.readWorkbookFromLocalFile(n,(function(t){var a=t.getWorksheet("位置标注");a||(a=t.getWorksheet("MarkPosition")),e.parserExcelData(a)}))}else e.$XModal.message({message:e.$t("insure.importExcelTips"),status:"error",zIndex:9999})},this.fileEl=t},parserExcelData:function(e){console.log(e);try{var t=[];e.eachRow({includeEmpty:!0},(function(e,a){if(a>1){var i={},n=0;e.eachCell({includeEmpty:!0},(function(e,t){switch(t){case 1:i.deviceid=e.text;break;case 2:i.callat=Number(e.text);break;case 3:i.callon=Number(e.text);break;case 4:e.text&&"string"==typeof e.text&&(n=new Date(e.value).getTime());break}}));var s=i.deviceid;s&&(s=s.trim());var o=h["a"].deviceInfos[s];if(o){if(0==n){var r=h["a"].lastPositions[s];i.updatetime=r?r.updatetime:Date.now()}else i.updatetime=n;t.push(i)}}})),t.length>0&&(this.selectedDeviceIds={},this.showCoordinateType=!0,this.importData=t)}catch(a){console.log(a),this.$XModal.message({message:this.$t("insure.importExcelFailTips"),status:"error",zIndex:9999})}},handleDetermineImport:function(){var e=this,t=this.importData,a=this.coordinateType;t.forEach((function(t){var i=t.callon,n=t.callat;if("bd09"==a){var s=Object(d["d"])(i,n);t.callon=s[0],t.callat=s[1]}else if("gcj02"==a){var o=Object(d["h"])(i,n);t.callon=o[0],t.callat=o[1]}e.selectedDeviceIds[t.deviceid]=!0})),this.$refs.mapIns.importMarkers(t),this.$refs.ztree.selectedCheckNodes(t.map((function(e){return e.deviceid}))),this.showCoordinateType=!1,this.$XModal.message({message:this.$t("bgManage.importSuccCount",{count:t.length}),status:"success",zIndex:9999})},readWorkbookFromLocalFile:function(e,t){var a=new FileReader;a.onload=function(e){var a=e.target.result,i=new ExcelJS.Workbook;i.xlsx.load(a).then((function(){t&&t(i)}))},a.readAsBinaryString(e)},refreshZtree:function(){var e=this;0==this.reloadLoading&&(this.reloadLoading=!0,Object(C["S"])().then((function(t){var a=t.rootuser;e.reloadLoading=!1,h["a"].deviceInfos={},h["a"].rootuser=a,h["a"].setDeviceInfos(a),e.changeCount=0,e.ztreeIns.destroy(),e.initZtree(),e.searchText="",e.selectedDeviceIds={},e.$refs.mapIns.markLayer.clear()})).catch((function(t){e.reloadLoading=!1})))},onTreeCheck:function(e){this.$refs.mapIns.addMarkers(e)},onClickDeviceNode:function(e){var t=e.info.deviceid;this.$refs.mapIns.setCenter(t)}}},D=A,O=(a("d414"),Object(w["a"])(D,i,n,!1,null,"69a80b92",null)),j=O.exports;t["default"]=j}}]);