(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-776ce9ed"],{"52d5":function(t,e,a){"use strict";a("532c")},"532c":function(t,e,a){},"5c4f":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-record full"},[e("div",{staticClass:"login-record-header"},[e("div",{staticClass:"f_left",staticStyle:{width:"210px"}},[e("DropdownZtreeUser",{ref:"ztreeUser",attrs:{label:t.$t("reportForm.creater")},model:{value:t.username,callback:function(e){t.username=e},expression:"username"}})],1),e("div",{staticClass:"f_left"},[e("div",{staticClass:"login-record-days"},[e("div",{style:{backgroundColor:7==t.totaldays?"#E0E0E0":"#ffffff"},on:{click:function(e){t.totaldays=7}}},[t._v("7"+t._s(t.$t("reportForm.d")))]),e("div",{style:{backgroundColor:15==t.totaldays?"#E0E0E0":"#ffffff"},on:{click:function(e){t.totaldays=15}}},[t._v("15"+t._s(t.$t("reportForm.d")))]),e("div",{style:{backgroundColor:30==t.totaldays?"#E0E0E0":"#ffffff"},on:{click:function(e){t.totaldays=30}}},[t._v("30"+t._s(t.$t("reportForm.d")))])])]),e("div",{staticClass:"f_left"},[e("el-button",{staticStyle:{width:"90px"},attrs:{type:"primary",loading:t.loading},on:{click:t.handleClickQuery}},[t._v(t._s(t.$t("common.query")))])],1)]),e("div",[e("el-tabs",{model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},[e("el-tab-pane",{attrs:{label:t.$t("bgManage.chart"),name:"overview"}}),e("el-tab-pane",{attrs:{label:t.$t("reportForm.detailed"),name:"detail"}})],1)],1),e("div",{staticClass:"login-record-content",staticStyle:{top:"79px"},style:{zIndex:"overview"==t.activeName?99:1}},[e("PieEchart",{ref:"echart",on:{selectUser:t.selectUser,"on-click-pie":t.onClickPie}})],1),e("div",{staticClass:"login-record-content",staticStyle:{top:"79px"},style:{zIndex:"detail"==t.activeName?99:1}},[e("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","highlight-current-row":"","highlight-hover-row":"","auto-resize":"","show-overflow":"",size:"mini",height:"auto",data:t.tableList}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index")}}),e("vxe-table-column",{attrs:{type:"expand",width:"36"},scopedSlots:t._u([{key:"content",fn:function(a){var i=a.row;a.rowIndex;return[[e("div",{staticStyle:{"padding-left":"60px"}},[e("vxe-table",{staticClass:"mytable-scrollbar",attrs:{align:"right",border:"",resizable:"","auto-resize":"",height:i.tableHeight,"show-overflow":"","highlight-hover-row":"",size:"mini",data:i.records}},[e("vxe-table-column",{attrs:{field:"logintimeStr",title:t.$t("bgManage.loginTime"),width:"150",sortable:""}}),e("vxe-table-column",{attrs:{field:"fromstr",title:t.$t("bgManage.loginSource"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"logintype",title:t.$t("bgManage.logintype"),width:"100",sortable:""}}),e("vxe-table-column",{attrs:{field:"version",title:t.$t("bgManage.version"),width:"88"}}),e("vxe-table-column",{attrs:{field:"ip",title:"ip",width:"140",sortable:""}}),e("vxe-table-column",{attrs:{field:"pcbrowser",title:t.$t("bgManage.pcbrowser"),width:"110"}}),e("vxe-table-column",{attrs:{field:"phonebrand",title:t.$t("bgManage.phonebrand"),width:"110"}}),e("vxe-table-column",{attrs:{field:"phonemodel",title:t.$t("bgManage.phonemodel"),width:"110"}}),e("vxe-table-column",{attrs:{field:"phonesdkversion",title:t.$t("bgManage.phonesdkversion"),width:"110"}}),e("vxe-table-column",{attrs:{field:"phonesystem",title:t.$t("bgManage.phonesystem"),width:"110"}}),e("vxe-table-column",{attrs:{field:"wxversion",title:t.$t("bgManage.wxversion"),width:"110"}})],1)],1)]]}}])}),e("vxe-table-column",{attrs:{field:"userid",title:t.$t("bgManage.userName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"showname",title:t.$t("bgManage.displayName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"count",title:t.$t("reportForm.count"),sortable:""}}),e("vxe-table-column",{attrs:{field:"onlineDayAanTotalDay",title:t.$t("reportForm.loginDayAanTotalDay")}}),e("vxe-table-column",{attrs:{field:"onlineRate",title:t.$t("reportForm.loginRate"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",[t._v(t._s(a.row.onlineRate)+"%")])]}}])}),e("vxe-table-column",{attrs:{title:t.$t("reportForm.loginDate")},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleClickRow(a.row)}}},[t._v(t._s(t.$t("monitor.calendar")))])]}}])})],1)],1),e("LoginDate",{ref:"loginDate",model:{value:t.show,callback:function(e){t.show=e},expression:"show"}})],1)},n=[],s=a("5530"),o=(a("14d9"),a("4e82"),a("b64b"),a("d3b7"),a("07ac"),a("498a"),a("159b"),a("4795"),a("2f62")),r=a("e285"),l=a("7ef3"),c=a("201d"),d=a("5101"),h=(a("b0c0"),function(){var t=this,e=t._self._c;return e("div",{staticClass:"login-pie full"},[e("div",{staticClass:"login-pie-left"},[e("el-card",{staticClass:"box-card",staticStyle:{width:"200px",height:"100%"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",{domProps:{textContent:t._s(t.$t("bgManage.loginMaxCount"))}})]),e("div",{staticClass:"login-pie-left-content"},[e("el-scrollbar",{staticStyle:{height:"100%"}},t._l(t.maxLoginLists,(function(a,i){return e("div",{key:i,staticClass:"login-pie-left-content-row",on:{click:function(e){return t.handleClick(a)}}},[e("el-row",[e("el-col",{staticClass:"ellipsis",staticStyle:{"padding-left":"15px","border-right":"1px solid #dcdfe6"},attrs:{span:16}},[t._v(" "+t._s(a.name)+" ")]),e("el-col",{staticStyle:{"padding-right":"10px","text-align":"center"},attrs:{span:8}},[t._v(" "+t._s(a.value)+" ")])],1)],1)})),0)],1)])],1),e("div",{staticClass:"login-pie-right"},[e("el-card",{staticClass:"box-card",staticStyle:{width:"200px",height:"100%"}},[e("div",{attrs:{slot:"header"},slot:"header"},[e("span",{domProps:{textContent:t._s(t.$t("bgManage.loginMinCount"))}})]),e("div",{staticClass:"login-pie-left-content"},[e("el-scrollbar",{staticStyle:{height:"100%"}},t._l(t.minLoginLists,(function(a,i){return e("div",{key:i,staticClass:"login-pie-left-content-row",on:{click:function(e){return t.handleClick(a)}}},[e("el-row",[e("el-col",{staticClass:"ellipsis",staticStyle:{"padding-left":"15px","border-right":"1px solid #dcdfe6"},attrs:{span:16}},[t._v(" "+t._s(a.name)+" ")]),e("el-col",{staticStyle:{"padding-right":"10px","text-align":"center"},attrs:{span:8}},[t._v(" "+t._s(a.value)+" ")])],1)],1)})),0)],1)])],1),e("div",{staticClass:"full",attrs:{id:t.chartId}})])}),u=[],f=(a("fb6a"),a("43c8")),m=a.n(f),g=a("6e52"),v={name:"PieEchart",computed:{chartId:function(){return"chart_".concat(this._uid)}},data:function(){return{maxLoginLists:[],minLoginLists:[]}},methods:{handleClick:function(t){this.$emit("selectUser",t)},initChart:function(){var t=this;this.chartsIns=m.a.init(document.getElementById(this.chartId));var e={legendData:[],seriesData:[]};this.chartsIns.setOption(this.getChartsOption(e),!0),this.chartsIns.on("click","series.pie",(function(e){var a=e.data;t.$emit("on-click-pie",a)}))},resize:function(){this.chartsIns.resize()},updateChartsOption:function(t,e){var a={legendData:[],seriesData:[]},i=[];e.forEach((function(t){return i.push(t)})),i.forEach((function(t){var e=t.userid,i=g["a"].getUserByUserName(e),n=i?i.showname:e;a.legendData.push(n),a.seriesData.push({name:n,username:e,value:t.count})})),a.seriesData.sort((function(t,e){return e.value-t.value})),this.maxLoginLists=a.seriesData.slice(0,10),this.minLoginLists=a.seriesData.slice(a.seriesData.length-10,a.seriesData.length),this.chartsIns.setOption(this.getChartsOption(a),!0)},getChartsOption:function(t){return{tooltip:{trigger:"item",formatter:"{b} : {c} "},legend:{type:"scroll",orient:"vertical",right:60,top:20,bottom:20,data:t.legendData},series:[{name:"账号/登录次数",type:"pie",radius:"80%",center:["50%","50%"],data:t.seriesData,emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]}}},mounted:function(){var t=this;this.$nextTick((function(){t.initChart()}))}},y=v,p=(a("f0ef"),a("2877")),b=Object(p["a"])(y,h,u,!1,null,null,null),w=b.exports,D=function(){var t=this,e=t._self._c;return e("vxe-modal",{attrs:{title:t.title,value:t.value,className:"modal-padding0",width:"420px"},on:{hide:t.handleClose,close:t.handleClose}},[e("div",{staticClass:"login-date"},[e("div",{staticClass:"login-date-header"},[e("div",{staticStyle:{width:"40%","line-height":"30px"}},[t._v(t._s(t.year)+t._s(t.$t("monitor.year"))+t._s(t.month)+t._s(t.$t("monitor.month")))]),e("div",{staticStyle:{width:"60%","text-align":"right"}},[e("el-button-group",[e("el-button",{attrs:{size:"mini"},on:{click:t.prveMonth}},[t._v(t._s(t.$t("monitor.prevMonth")))]),e("el-button",{attrs:{size:"mini"},on:{click:t.toDay}},[t._v(t._s(t.$t("el.datepicker.today")))]),e("el-button",{attrs:{size:"mini"},on:{click:t.nextMonth}},[t._v(t._s(t.$t("el.datepicker.nextMonth")))])],1)],1)]),e("div",{staticClass:"login-date-week"},t._l(t.weeks,(function(a,i){return e("div",{key:i},[t._v(t._s(a))])})),0),e("div",{staticClass:"login-date-dates"},t._l(t.datesArr,(function(a,i){return e("div",{key:i,class:{"active-day":a.isTheMonth,"no-current-month":!a.isTheMonth}},[e("div",{staticClass:"calendar-body-dates-date",domProps:{textContent:t._s(a.day)}}),e("div",{style:{color:a.color},domProps:{textContent:t._s(a.mileage)}})])})),0),e("div",{staticClass:"login-date-footer"},[e("div",[e("span",{domProps:{textContent:t._s(t.$t("reportForm.loginDayAanTotalDay"))}}),t._v(" : "),e("span",{domProps:{textContent:t._s(t.onlineDayAanTotalDay)}})]),e("div",[e("span",{domProps:{textContent:t._s(t.$t("reportForm.loginRate"))}}),t._v(" : "),e("span",[t._v(t._s(t.onlineRate)+"%")])])])])])},x=[],k=(a("99af"),a("3c65"),{name:"LoginDate",props:{value:{type:Boolean,default:!1}},data:function(){return{title:"",year:"",month:"",date:"",weeks:[this.$t("el.datepicker.weeks.mon"),this.$t("el.datepicker.weeks.tue"),this.$t("el.datepicker.weeks.wed"),this.$t("el.datepicker.weeks.thu"),this.$t("el.datepicker.weeks.fri"),this.$t("el.datepicker.weeks.sat"),this.$t("el.datepicker.weeks.sun")],datesArr:[],currentDate:d["a"].format(new Date,"yyyy-MM-dd"),onlineDayAanTotalDay:"",onlineRate:""}},watch:{value:function(t){}},computed:Object(s["a"])({},Object(o["b"])(["isZh"])),methods:{updateOnlineStatus:function(t,e,a,i,n){this.deviceid=t,this.dateStr=e,this.daysStatus=a,this.onlineDayAanTotalDay=i,this.onlineRate=n,this.setTheDate(e),this.title=this.$t("reportForm.loginDate")+" - "+t},handleClose:function(){this.$emit("input",!1)},prveMonth:function(){var t=new Date,e=d["a"].reduceMonth(new Date(t.getFullYear(),t.getMonth()-1,1),1),a=d["a"].reduceMonth(new Date(this.year,this.month-1,1),1);a<e||this.setTheDate(d["a"].format(a,"yyyy-MM-dd"))},toDay:function(){var t=d["a"].format(new Date,"yyyy-MM-dd");this.setTheDate(t)},nextMonth:function(){var t=d["a"].addMonth(new Date(this.year,this.month-1,1),1);if(!(this.currentDate<d["a"].format(t,"yyyy-MM-dd"))){this.setTheDate(d["a"].format(t,"yyyy-MM-dd"));var e="".concat(this.year,"-").concat(this.month,"-").concat(this.date),a={deviceids:[this.deviceid],offset:d["a"].getOffset(),year:this.year,month:this.month,dateStr:e};this.$emit("queryOnlineMonth",a)}},getTheMonthFirstDayWeek:function(){return new Date(this.year,this.month-1,1).getDay()},getTheMonthDays:function(){var t=12==this.month?this.year+1:this.year,e=12==this.month?1:this.month;return new Date(new Date(t,e,1)-1).getDate()},getPrevMonthLastDate:function(){return new Date(new Date(this.year,this.month-1,1)-1).getDate()},setTheDate:function(t){var e=t.split("-");this.year=e[0],this.month=e[1],this.date=e[2],this.datesArr=this.getDatesArr()},getDatesArr:function(){var t=[],e=this.getTheMonthFirstDayWeek(),a=this.getPrevMonthLastDate(),i=d["a"].format(new Date,"yyyy-MM-dd"),n=d["a"].format(new Date(new Date(this.year,this.month-2,1)),"yyyy-MM"),s=d["a"].format(new Date(new Date(this.year,this.month,1)),"yyyy-MM"),o=this.getTheMonthDays();while(e--)t.unshift({dateStr:n+"-"+(a>9?a:"0"+a),day:a--,isTheMonth:!1,isPrevMonth:!0,isNextMonth:!1,mileage:"-"});var r=1,l=this.month,c=this.daysStatus;while(o--){var h=this.year+"-"+l+"-"+(r<10?"0"+r:r),u=c[h],f="",m="";void 0===u?(f=i<h?"-":"x",m="#606266"):(f=u,m=u?"#409EFF":"#e4393c"),t.push({day:r,isTheMonth:!0,mileage:f,dateStr:h,color:m}),r++}var g=1;while(t.length<42){h=s+"-"+(g<10?"0"+g:g);t.push({day:g++,isTheMonth:!1,mileage:"-",dateStr:h,isNextMonth:!0,isPrevMonth:!1})}return t}},mounted:function(){}}),C=k,_=(a("91f7"),Object(p["a"])(C,D,x,!1,null,"3eea5829",null)),M=_.exports,$={name:"LoginRecord",data:function(){return{loading:!1,show:!1,username:"",totaldays:7,activeName:"overview",tableList:[]}},components:{DropdownZtreeUser:l["a"],PieEchart:w,LoginDate:M,LabelWrap:c["a"]},computed:Object(s["a"])({},Object(o["b"])(["userName","isQueryInitData"])),watch:{isQueryInitData:function(t){t&&(this.username=this.userName,this.$refs.ztreeUser.selectedUser(this.userName),this.queryRecords())},totaldays:function(){this.handleClickQuery()}},methods:{onClickPie:function(t){for(var e=null,a=0;a<this.tableList.length;a++)if(e=this.tableList[a],t.username==e.userid)break;e&&this.handleClickRow(e)},handleClickRow:function(t){this.$refs.loginDate.updateOnlineStatus(t.userid,d["a"].formatutc(new Date,"yyyy-MM-dd"),t.loginTotal,t.onlineDayAanTotalDay,t.onlineRate),this.show=!0},selectUser:function(t){var e=this;this.activeName="detail";var a=t.username,i=null;this.tableList.forEach((function(t){t.userid==a&&(i=t)})),i&&(this.$refs.xTable.setRowExpand(i,!0),this.$refs.xTable.setCurrentRow(i),setTimeout((function(){e.$refs.xTable.scrollToRow(i)}),300))},resize:function(){this.$refs.echart.resize()},queryRecords:function(){var t=this;this.loading=!0;var e={},a=(document.body.clientHeight||documentElement.clientHeight)-280;Object(r["dc"])(this.username,this.totaldays,d["a"].getOffset()).then((function(i){var n=i.logs,s=i.totaldays,o=[];if(n){for(var r in s||(s=30),n.forEach((function(t){t.logintimeStr=d["a"].longToLocalDateTimeStr(t.logintime),t.loginDateStr=t.logintimeStr.split(" ")[0];var a=t.userid.toLowerCase().trim();if(void 0==e[a]){var i=g["a"].getUserByUserName(a),n=i?i.showname:a;e[a]={totaldays:s,records:[],userid:a,showname:n,count:0,tableHeight:72}}e[a].count++,e[a].records.push(t)})),e){var l=e[r],c=36*l.count+48;l.tableHeight=c>a?a:c}o=Object.values(e),o.sort((function(t,e){return e.count-t.count})),o.forEach((function(t){var e={};t.records.forEach((function(t){void 0==e[t.loginDateStr]&&(e[t.loginDateStr]=0),e[t.loginDateStr]++})),t.loginTotal=e,t.onlineDayAanTotalDay=Object.keys(e).length+"/"+s,t.onlineRate=parseInt(Object.keys(e).length/s*100)})),t.$refs.echart&&t.$refs.echart.updateChartsOption(t.username,o)}t.tableList=o,t.loading=!1})).catch((function(t){}))},handleClickQuery:function(){this.queryRecords()}},mounted:function(){var t=this;this.$nextTick((function(){t.isQueryInitData&&(t.username=t.userName,t.$refs.ztreeUser.selectedUser(t.userName))}))}},S=$,T=(a("52d5"),Object(p["a"])(S,i,n,!1,null,null,null)),L=T.exports;e["default"]=L},"91f7":function(t,e,a){"use strict";a("bfff")},bfff:function(t,e,a){},d009:function(t,e,a){},f0ef:function(t,e,a){"use strict";a("d009")}}]);