(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-050c3b0b"],{"0595":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"quick-time-range"},[t("div",{staticClass:"quick-time-range-wrapper"},e._l(e.list,(function(a){return t("div",{key:a.type,style:{color:a.type==e.type?"#409EFF":""},on:{click:function(t){return e.selectDate(a.type)}}},[e._v(e._s(a.label))])})),0),t("div",{staticClass:"quick-time-range-space"}),t("div",{staticClass:"quick-time-range-btn",on:{click:function(t){e.isCollapse=!e.isCollapse}}},[e.isCollapse?t("i",{staticClass:"el-icon-arrow-right"}):t("i",{staticClass:"el-icon-arrow-left"})])])},s=[],r=a("5101"),l={name:"QuickTimeRange",props:{value:{type:Array,default:function(){return[]}},dateType:{type:String,default:"date"}},watch:{isCollapse:function(){this.setList()}},data:function(){return{isCollapse:!0,type:0,list:[]}},methods:{setList:function(){this.isCollapse?this.list=[{label:this.$t("reportForm.toDay"),type:0},{label:this.$t("reportForm.yesterDay"),type:1},{label:this.$t("reportForm.recent3Days"),type:3}]:this.list=[{label:this.$t("reportForm.recent7Days"),type:7},{label:this.$t("reportForm.recent10Days"),type:10},{label:this.$t("reportForm.recent30Days"),type:30}]},selectDate:function(e){var t="datetimerange"==this.dateType,a=[],i=new Date,s=new Date;switch(t&&(i=new Date(r["a"].format(new Date,"yyyy-MM-dd")+" 00:00:00"),s=new Date(r["a"].format(new Date,"yyyy-MM-dd")+" 23:59:59")),e){case 0:a=[new Date(r["a"].format(i,"yyyy-MM-dd")+" 00:00:00"),new Date(r["a"].format(s,"yyyy-MM-dd")+" 23:59:59")];break;case 1:i.setTime(i.getTime()-864e5),s.setTime(s.getTime()-864e5),a=[i,s];break;case 3:i.setTime(i.getTime()-2592e5),a=[i,s];break;case 7:i.setTime(i.getTime()-6048e5),a=[i,s];break;case 10:i.setTime(i.getTime()-864e6),a=[i,s];break;case 30:i.setTime(i.getTime()-2592e6),a=[i,s];break}this.type=e,this.$emit("input",a)}},mounted:function(){var e=this;this.$nextTick((function(){e.setList()}))}},o=l,n=(a("8d09"),a("2877")),c=Object(n["a"])(o,i,s,!1,null,null,null);t["a"]=c.exports},"3b13":function(e,t,a){},"50f7":function(e,t,a){},"57c9":function(e,t,a){"use strict";var i=a("0595");t["a"]=i["a"]},7031:function(e,t,a){"use strict";a("3b13")},"80f4":function(e,t,a){"use strict";var i=a("32eb");t["a"]=i["a"]},"8d09":function(e,t,a){"use strict";a("a818")},a818:function(e,t,a){},b5981:function(e,t,a){"use strict";a("50f7")},d4be:function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"report-form full check-report"},[t("div",{staticClass:"report-form-inner"},[t("el-scrollbar",{staticStyle:{width:"100%"}},[t("div",{staticClass:"report-form-inner-header",staticStyle:{height:"45px"}},[t("div",{staticClass:"f_left"},[t("MultiChoiceVehicle",{on:{onSelectDevice:e.onSelectDevice}})],1),t("div",{staticClass:"f_left"},[t("SelectDate",{model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),t("div",{staticClass:"f_left"},[t("QuickTimeRange",{model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),t("div",{staticClass:"f_left",staticStyle:{width:"180px"}},[t("LabelWrap",{attrs:{label:e.$t("reportForm.selectType")}},[t("el-select",{staticStyle:{width:"100px"},model:{value:e.checktype,callback:function(t){e.checktype=t},expression:"checktype"}},e._l(e.optionList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"f_left"},[t("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleQuery}},[e._v(e._s(e.$t("common.query")))])],1),t("div",{staticClass:"f_left"},[t("el-popover",{attrs:{placement:"bottom",width:"236",trigger:"click"}},[t("div",[t("el-button",{staticStyle:{width:"100px"},attrs:{type:"primary",loading:e.exportLoading1,plain:""},on:{click:e.exportData}},[e._v(e._s(e.$t("common.summary")))]),t("el-button",{staticStyle:{width:"100px"},attrs:{type:"primary",loading:e.exportLoading2,plain:""},on:{click:e.exportDetailData}},[e._v(e._s(e.$t("reportForm.detailed")))])],1),t("el-button",{attrs:{slot:"reference",type:"primary"},slot:"reference"},[e._v(e._s(e.$t("common.export")))])],1)],1)])]),t("div",{staticClass:"report-form-inner-tabs"},[t("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("el-tab-pane",{attrs:{label:e.$t("reportForm.checkStatistics")+"(".concat(e.totalList.length,")"),name:"tabTotal"}}),t("el-tab-pane",{attrs:{label:"",name:"details"}})],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"details"==e.activeName,expression:"activeName == 'details'"}],staticClass:"tableTitle"},[t("b",{domProps:{textContent:e._s(e.tableTitle)}}),e._v("("+e._s(e.detailsList.length)+")")])],1),t("div",{staticClass:"report-form-inner-content",staticStyle:{top:"80px"}},[t("div",{style:e.statisticsStyle},[t("vxe-table",{ref:"xTable1",attrs:{"sort-config":e.sortConfig,"menu-config":e.tableMenu,border:"","auto-resize":"",resizable:"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:e.totalList},on:{"menu-click":e.handleClickTableMenu}},[t("vxe-table-column",{attrs:{type:"seq",width:"60",title:e.$t("reportForm.index")}}),t("vxe-table-column",{attrs:{title:e.$t("reportForm.action"),width:"70"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(t){return e.handleClickRow(a.row)}}},[e._v(e._s(e.$t("reportForm.details")))])]}}])}),t("vxe-table-column",{attrs:{field:"devicename",title:e.$t("alarm.devName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"deviceid",title:e.$t("alarm.devNum"),sortable:""}}),t("vxe-table-column",{attrs:{field:"creater",title:e.$t("reportForm.creater"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(a){return t("div",{key:a.username},[e._v(e._s(a.username)+"("+e._s(a.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(a.row.creater)}},slot:"reference"},[e._v(e._s(a.row.creater))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"groupname",title:e.$t("reportForm.groupName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"count",title:e.$t("reportForm.count"),sortable:""}})],1)],1),t("div",{style:e.detailsStyle},[t("div",{staticClass:"check-report-details-table"},[t("vxe-table",{ref:"xTable2",attrs:{"sort-config":e.sortConfig,"menu-config":e.tableMenu,border:"","auto-resize":"",resizable:"","show-overflow":"","highlight-current-row":"","highlight-hover-row":"",size:"mini",height:"auto",data:e.detailsList},on:{"menu-click":e.handleClickTableMenu,"current-change":e.onCellClick}},[t("vxe-table-column",{attrs:{type:"seq",width:"60",title:e.$t("reportForm.index")}}),t("vxe-table-column",{attrs:{field:"stralarm",title:e.$t("reportForm.status"),sortable:""}}),t("vxe-table-column",{attrs:{field:"lasttimeStr",title:e.$t("reportForm.time"),sortable:""}}),t("vxe-table-column",{attrs:{field:"address",title:e.$t("reportForm.address"),sortable:""}})],1)],1),t("div",{staticClass:"check-report-details-map"},[t("ReportMap",{ref:"reportMap"})],1)])])],1)])},s=[],r=a("5530"),l=(a("14d9"),a("4e82"),a("a9e3"),a("d3b7"),a("159b"),a("6e52")),o=a("e561"),n=a("d462"),c=a("57c9"),d=a("80f4"),u=a("1c31"),p=a("5101"),h=a("201d"),m=a("2f62"),v=a("c276"),f=a("4c3c"),b=a("a05b"),y=a("0c87"),g={name:"checkReport",data:function(){return{loading:!1,exportLoading1:!1,exportLoading2:!1,activeName:"tabTotal",tableTitle:"",dateRange:[new Date,new Date],totalList:[],detailsList:[],checktype:"0",optionList:[]}},watch:{dateRange:function(){this.loading||this.handleQuery()}},mixins:[f["a"],b["a"],y["a"]],computed:Object(r["a"])(Object(r["a"])({},Object(m["b"])(["isZh"])),{},{statisticsStyle:function(){return{zIndex:"tabTotal"==this.activeName?999:0}},detailsStyle:function(){return{zIndex:"details"==this.activeName?999:0}}}),components:{MultiChoiceVehicle:o["a"],SelectDate:n["a"],QuickTimeRange:c["a"],ReportMap:d["a"],LabelWrap:h["a"]},methods:{onSelectDevice:function(e){this.deviceids=e},onCellClick:function(e){var t=e.row;t.callat=t.lat,t.callon=t.lon,this.$refs.reportMap.singleMarkerToMap(t)},handleQuery:function(){var e=this,t=this.deviceids,a=this.dateRange;if(0!=t.length)if(0!=a.length){"details"==this.activeName&&(this.activeName="tabTotal",this.totalList=[],this.detailsList=[]);var i=p["a"].format(a[0],"yyyy-MM-dd"),s=p["a"].format(a[1],"yyyy-MM-dd"),r={startday:i,endday:s,offset:p["a"].getOffset(),devices:t,checktype:Number(this.checktype)};this.loading=!0,this.queryDetailDateRange=r.startday+"  "+r.endday,Object(u["F"])(r).then((function(t){var a=t.records,i=t.addressmap;e.addressmap=i||{},e.loading=!1;var s=[];null!=a&&a.forEach((function(t,a){var i=l["a"].deviceInfos[t.deviceid],r=i.devicename,o=l["a"].getShowName(i.creater),n=i.groupname,c={index:a+1,deviceid:t.deviceid,count:t.records.length,devicename:r,creater:o,groupname:n,records:t.records};t.records.sort((function(e,t){return e.lastalarmtime-t.lastalarmtime})),t.records.forEach((function(t){t.devicename=r,t.creater=o,t.groupname=n,t.lasttimeStr=p["a"].longToLocalDateTimeStr(t.lastalarmtime),t.address=e.$t("common.getAddress"),e.isZh||(t.stralarm=t.stralarmen)})),s.push(c)})),e.totalList=s})).catch((function(t){e.loading=!1}))}else this.$XModal.message({message:this.$t("tips.selectTime"),status:"error",zIndex:9999});else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})},handleClickRow:function(e){if(e.records&&e.records.length>0){this.activeName="details";var t=this.addressmap;this.tableTitle=e.devicename+"-"+e.deviceid,e.records.forEach((function(e){e.address=Object(v["L"])(t,e.lat,e.lon)})),this.detailsList=e.records,this.$refs.xTable2.setCurrentRow(this.detailsList[0]),this.onCellClick({row:this.detailsList[0]})}else this.$XModal.message({message:this.$t("tips.noData"),status:"error",zIndex:9999})},exportData:function(){var e=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.count")]],t=this.$refs.xTable1.getTableData().visibleData;if(0!=t.length){t.forEach((function(t,a){var i=[];i.push(a+1),i.push(t.devicename),i.push(t.deviceid),i.push(t.creater),i.push(t.groupname),i.push(t.count),e.push(i)}));var a={title:this.$t("reportForm.checkReport"),data:e,dateRange:this.queryDetailDateRange};this.exportLoading1=!0,new ExcelCls(a).exportExcel(this)}},exportDetailData:function(){var e=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.status"),this.$t("reportForm.time"),this.$t("reportForm.address"),this.$t("monitor.coordinate")]],t=this.totalList;if(0!=t.length){var a=this.addressmap;t.forEach((function(t,i){if(t.records.forEach((function(t,i){var s=Object(v["L"])(a,t.lat,t.lon),r=[];r.push(i+1),r.push(t.devicename),r.push(t.deviceid),r.push(t.creater),r.push(t.groupname),r.push(t.stralarm),r.push(t.lasttimeStr),r.push(s),r.push(t.lon+","+t.lat),e.push(r)})),t.records.length>0){var s=[];s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),e.push(s)}else{s=[];s.push(1),s.push(t.devicename),s.push(t.deviceid),s.push(t.creater),s.push(t.groupname),s.push("-"),s.push("-"),s.push("-"),s.push("-"),e.push(s)}}));var i={title:this.$t("reportForm.checkReport")+"_"+this.$t("reportForm.detailed"),data:e,dateRange:this.queryDetailDateRange};this.exportLoading2=!0,new ExcelCls(i).exportExcel(this)}}},mounted:function(){var e=this;this.deviceids=[],this.queryDetailDateRange=null,this.$nextTick((function(){e.optionList=[{label:e.$t("monitor.all"),value:"0"},{label:e.$t("reportForm.checkIn"),value:"1"},{label:e.$t("reportForm.checkOut"),value:"2"}]}))}},x=g,k=(a("b5981"),a("2877")),$=Object(k["a"])(x,i,s,!1,null,null,null),D=$.exports;t["default"]=D},e561:function(e,t,a){"use strict";var i=a("ea22");t["a"]=i["a"]},ea22:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"multi-choice multi-choice-vehicle"},[t("div",{staticClass:"multi-choice-input"},[t("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:e.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:e.isQueryInitData,selectDeviceIds:e.multipleDeviceids},on:{onTreeCheck:e.onTreeCheck}})],1)])},s=[],r=a("5530"),l=(a("4795"),a("2f62")),o=a("2df7"),n={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(r["a"])({},Object(l["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:o["a"]},methods:Object(r["a"])(Object(r["a"])({},Object(l["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(e){this.$emit("onSelectDevice",e),this.setMultipleDeviceids(e)},clearText:function(){var e=this;setTimeout((function(){e.$refs.ztreeDevice.clearText()}),300)}})},c=n,d=(a("7031"),a("2877")),u=Object(d["a"])(c,i,s,!1,null,null,null);t["a"]=u.exports}}]);