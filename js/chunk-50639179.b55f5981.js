(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-50639179"],{"3b13":function(t,e,a){},"632c2":function(t,e,a){"use strict";a("6e31")},"6e31":function(t,e,a){},7031:function(t,e,a){"use strict";a("3b13")},cdec:function(t,e,a){"use strict";a.r(e);var i=a("ade3"),r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form full oil-month-summary"},[e("div",{staticClass:"report-form-inner"},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left"},[e("SelectDate",{attrs:{dateType:"month"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{type:"primary",loading:t.exportLoading1},on:{click:t.exportData}},[t._v(t._s(t.$t("common.export")))])],1)]),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"39px"}},[e("vxe-table",{staticClass:"mytable-scrollbar",attrs:{"cell-style":t.cellStyle,"sort-config":t.sortConfig,"menu-config":t.tableMenu,border:"",resizable:"","auto-resize":"",size:"mini","show-overflow":"","highlight-hover-row":"",height:"auto",data:t.totalList},on:{"menu-click":t.handleClickTableMenu}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index"),fixed:"left"}}),e("vxe-table-column",{attrs:Object(i["a"])({field:"devicename",sortable:"",width:"120",title:t.$t("alarm.devName"),fixed:"left"},"sortable","")}),e("vxe-table-column",{attrs:Object(i["a"])({field:"deviceid",sortable:"",width:"120",title:t.$t("alarm.devNum")},"sortable","")}),e("vxe-table-column",{attrs:{field:"creater",title:t.$t("reportForm.creater"),width:"90",sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[e("div",{staticClass:"parents-wrapper"},t._l(t.parentsList,(function(a){return e("div",{key:a.username},[t._v(t._s(a.username)+"("+t._s(a.usertypeStr)+")")])})),0),e("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(e){return t.queryParents(a.row.creater)}},slot:"reference"},[t._v(t._s(a.row.creater))])],1)]}}])}),e("vxe-table-column",{attrs:{field:"groupname",title:t.$t("reportForm.groupName"),width:"90",sortable:""}}),e("vxe-table-column",{attrs:{field:"useDay",title:t.$t("reportForm.usageDay"),width:"90",sortable:""}}),e("vxe-table-column",{attrs:{field:"usageRate",title:t.$t("reportForm.usageRate"),width:"90",sortable:""}}),e("vxe-table-column",{attrs:{field:"totaldistance",formatter:t.numberToFixed2,sortable:"",width:"145",title:t.$t("reportForm.totalMileage")+t.distanceUnit}}),t._l(t.dayList,(function(a,i){return[e("vxe-table-column",{key:i,attrs:{title:a.label+t.distanceUnit,width:"80",formatter:t.numberToFixed2,field:"day"+(i+1),sortable:""}})]}))],2)],1)])])},o=[],s=a("5530"),n=(a("14d9"),a("a9e3"),a("b680"),a("d3b7"),a("159b"),a("5101")),c=a("e561"),l=a("d462"),u=a("6e52"),d=a("1c31"),h=a("4c3c"),m=a("a05b"),p=a("0c87"),v=a("c276"),f=a("2f62"),b={name:"MileageMonth",data:function(){return{show:!1,loading:!1,exportLoading1:!1,month:new Date,totalList:[],dayList:[]}},mixins:[h["a"],m["a"],p["a"]],components:{MultiChoiceVehicle:c["a"],SelectDate:l["a"]},computed:Object(s["a"])({},Object(f["b"])(["distanceUnit"])),watch:{month:function(){this.loading||this.handleQuery()}},methods:{numberToFixed2:v["qb"],cellStyle:function(t){t.row,t.rowIndex;var e=t.column,a={};return"devicename"===e.property&&"deviceid"===e.property&&"creater"===e.property&&"groupname"===e.property||(a.textAlign="right"),a},onSelectDevice:function(t){this.deviceids=t},handleQuery:function(){var t=this,e=this.deviceids;if(0!=e.length){this.loading=!0,this.dayList=this.getDayList();var a=this.dayList.length,r=this.month.getFullYear(),o=this.month.getMonth()+1,s={year:r,month:o,offset:n["a"].getOffset(),deviceids:e},c={totaldistance:0,devicename:"",deviceid:"",creater:"",groupname:"",usageRate:this.$t("reportForm.total")};Object(d["S"])(s).then((function(e){var r=e.devices;t.loading=!1,r.forEach((function(t,e){t.index=e+1;var i=t.deviceid,r=u["a"].deviceInfos[i],o=r.devicename,s=r.creater,n=r.groupname;t.devicename=o,t.creater=s,t.groupname=n;for(var l=t.records,d=0,h=0,m=0;m<a;m++){var p=l[m];if(p){var f=p.statisticsday.split("-")[2],b=Object(v["d"])(p.totaldistance);d+=b,b>0&&h++;var g="day"+String(parseInt(f)),y=b;void 0===c[g]&&(c[g]=0),c[g]=c[g]+y,t[g]=b}}for(var x=0;x<a;x++){f="day"+(x+1);t[f]||(t[f]=0,void 0===c[f]&&(c[f]=0))}t.useDay=h,t.usageRate=Number((h/a*100).toFixed(2))+"%",t.totaldistance=d,c.totaldistance+=d})),r.length>0&&(r.push(Object(i["a"])({totaldistance:"",devicename:"",deviceid:"",creater:"",groupname:"",usageRate:""},"totaldistance","")),r.push(c)),t.totalList=r})).catch((function(e){console.log(e),t.loading=!1}))}else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})},exportData:function(){for(var t=n["a"].format(this.month,"yyyy_MM"),e=this.dayList.length,a=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.usageDay"),this.$t("reportForm.usageRate"),this.$t("reportForm.totalMileage")+this.distanceUnit]],i=t.split("_")[0],r=t.split("_")[1],o=0;o<e;o++)a[0].push(i+"/"+r+"/"+(o+1)+this.distanceUnit);if(0!=this.totalList.length){this.totalList.forEach((function(t,i){var r=[];r.push(i+1),r.push(t.devicename),r.push(t.deviceid),r.push(t.creater),r.push(t.groupname),r.push(t.useDay),r.push(t.usageRate),r.push(Object(v["qb"])(t.totaldistance));for(var o=0;o<e;o++){var s="day"+(o+1);void 0!=t[s]?r.push(Object(v["qb"])(t[s])):r.push("")}a.push(r)}));var s={title:this.$t("reportForm.mileageMonth")+"_"+t,data:a};this.exportLoading1=!0,new ExcelCls(s).exportExcel(this)}},getTheMonthDays:function(t){var e=t.getFullYear(),a=t.getMonth()+1;return new Date(new Date(e,a,1)-1).getDate()},getDayList:function(){for(var t=[],e=this.getTheMonthDays(this.month),a=1;a<=e;a++)t.push({label:String(a),value:"day".concat(a)});return t}},mounted:function(){var t=this;this.$nextTick((function(){t.dayList=t.getDayList()}))}},g=b,y=(a("632c2"),a("2877")),x=Object(y["a"])(g,r,o,!1,null,null,null),D=x.exports;e["default"]=D},e561:function(t,e,a){"use strict";var i=a("ea22");e["a"]=i["a"]},ea22:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-choice multi-choice-vehicle"},[e("div",{staticClass:"multi-choice-input"},[e("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:t.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:t.isQueryInitData,selectDeviceIds:t.multipleDeviceids},on:{onTreeCheck:t.onTreeCheck}})],1)])},r=[],o=a("5530"),s=(a("4795"),a("2f62")),n=a("2df7"),c={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(o["a"])({},Object(s["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:n["a"]},methods:Object(o["a"])(Object(o["a"])({},Object(s["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(t){this.$emit("onSelectDevice",t),this.setMultipleDeviceids(t)},clearText:function(){var t=this;setTimeout((function(){t.$refs.ztreeDevice.clearText()}),300)}})},l=c,u=(a("7031"),a("2877")),d=Object(u["a"])(l,i,r,!1,null,null,null);e["a"]=d.exports}}]);