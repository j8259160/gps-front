(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c6473910"],{"23ec":function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-history full"},[t("div",{staticClass:"edit-history-header"},[t("div",{staticClass:"f_left",staticStyle:{width:"210px"}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.queryDevice"),showLabel:!1}},[t("el-input",{attrs:{clearable:"","prefix-icon":"el-icon-search",placeholder:e.$t("bgManage.pleaseEnterSearchDeviceid")},model:{value:e.queryText,callback:function(t){e.queryText=t},expression:"queryText"}})],1)],1),t("div",{staticClass:"f_left"},[t("el-button",{attrs:{type:"primary",loading:e.loading},on:{click:e.handleClickQuery}},[e._v(e._s(e.$t("common.query")))])],1),t("div",{staticClass:"f_right",staticStyle:{"padding-top":"3px"}},[t("el-button",{staticStyle:{height:"28px"},attrs:{size:"mini",loading:e.exportLoading},on:{click:e.exportDataAll}},[e._v(e._s(e.$t("device.exportAllDevice")))])],1),t("div",{staticClass:"f_right",staticStyle:{"padding-top":"3px"}},[t("el-button",{staticStyle:{height:"28px"},attrs:{size:"mini",loading:e.exportLoading1},on:{click:e.exportData}},[e._v(e._s(e.$t("device.exportCurrentDevice")))])],1),t("div",{staticClass:"f_right"},[t("el-radio",{attrs:{label:"60"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("device.daysEdit60"))),"60"==e.queryType?t("span",[e._v("("+e._s(e.totalcount)+")")]):e._e()])],1),t("div",{staticClass:"f_right"},[t("el-radio",{attrs:{label:"7"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("device.daysEdit7"))+" "),"7"==e.queryType?t("span",[e._v("("+e._s(e.totalcount)+")")]):e._e()])],1),t("div",{staticClass:"f_right",staticStyle:{width:"auto"}},[t("el-radio",{attrs:{label:"0"},model:{value:e.queryType,callback:function(t){e.queryType=t},expression:"queryType"}},[e._v(e._s(e.$t("device.allEditDevice"))+" "),"0"==e.queryType?t("span",[e._v("("+e._s(e.totalcount)+")")]):e._e()])],1)]),t("div",{staticClass:"edit-history-content",staticStyle:{top:"39px"}},[t("vxe-table",{attrs:{"sort-config":e.sortConfig,"menu-config":e.tableMenu,border:"","auto-resize":"",resizable:"","show-overflow":"","highlight-current-row":"",size:"mini",height:"auto",data:e.tableList,"cell-style":e.cellStyle},on:{"menu-click":e.handleClickTableMenu}},[t("vxe-table-column",{attrs:{title:e.$t("reportForm.action"),width:"78",fixed:"left"},scopedSlots:e._u([{key:"default",fn:function(r){return[-1==r.row.actionStatus||3==r.row.actionStatus||4==r.row.actionStatus||5==r.row.actionStatus?t("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.restoreEditDeviceHistory(r)}}},[e._v(e._s(e.$t("bgManage.revert")))]):t("el-button",{attrs:{type:"primary",disabled:"",size:"mini"},on:{click:function(t){return e.restoreEditDeviceHistory(r)}}},[e._v(e._s(e.$t("bgManage.revert")))])]}}])}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:e.$t("reportForm.index"),fixed:"left"}}),t("vxe-table-column",{attrs:{field:"editor",title:e.$t("bgManage.operator"),width:"100",fixed:"left",sortable:""}}),t("vxe-table-column",{attrs:{field:"edittypeStr",title:e.$t("device.editType"),width:"120",fixed:"left",sortable:""}}),t("vxe-table-column",{attrs:{field:"devicename",width:"120",title:e.$t("alarm.devName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"deviceid",width:"120",title:e.$t("alarm.devNum"),sortable:""}}),t("vxe-table-column",{attrs:{field:"edittimeStr",title:e.$t("reportForm.time"),width:"150",sortable:""}}),t("vxe-table-column",{attrs:{field:"prevalue",title:e.$t("device.beforeOperation"),width:"120"}}),t("vxe-table-column",{attrs:{field:"postvalue",title:e.$t("device.afterOperation"),width:"120"}}),t("vxe-table-column",{attrs:{title:e.$t("bgManage.user"),field:"username",width:"120",sortable:""},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(r){return t("div",{key:r.username},[e._v(e._s(r.username)+"("+e._s(r.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(r.row.postcreater)}},slot:"reference"},[e._v(e._s(r.row.postcreater))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"groupname",title:e.$t("reportForm.groupName"),width:"120",sortable:""}}),t("vxe-table-column",{attrs:{title:e.$t("device.accountBeforeOperation"),field:"username",width:"120",sortable:""},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(r){return t("div",{key:r.username},[e._v(e._s(r.username)+"("+e._s(r.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(r.row.precreater)}},slot:"reference"},[e._v(e._s(r.row.precreater))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"pregroupname",title:e.$t("device.groupBeforeOperation"),width:"120"}}),t("vxe-table-column",{attrs:{field:"actionStatus",title:e.$t("reportForm.status"),width:"80","edit-render":{name:"$select",options:e.statusList,props:{multiple:!1}}}})],1)],1),t("div",{staticStyle:{position:"absolute",left:"0px",right:"10px",bottom:"0px"}},[t("el-pagination",{attrs:{currentPage:e.currentPage,"current-page":e.currentChangePage,"page-sizes":[20,40,60,80],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.totalcount},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)])},i=[],o=r("5530"),s=(r("14d9"),r("a9e3"),r("d3b7"),r("159b"),r("0139")),n=r("e285"),c=r("2f62"),l=r("5101"),u=r("6e52"),d=r("c276"),p=r("4c3c"),v=r("a05b"),h=r("61fc"),f=r("e173"),m=r("7b49"),y={name:"RemovedDevices",data:function(){return{editIcon:h,deleteIcon:f,moreIcon:m,loading:!1,editDialog:!1,recordsDialog:!1,oilMarkDiglog:!1,editDiglog:!1,weightDialog:!1,ioDialog:!1,queryText:"",queryType:"0",tableList:[],totalcount:0,deviceid:"",deviceName:"",currentRow:{},pageSize:20,currentPage:1,exportLoading:!1,exportLoading1:!1,parentsList:[],statusList:[{label:this.$t("device.notOperated"),value:-1},{label:this.$t("device.recoveryWasSuccessful"),value:0},{label:this.$t("device.restoreToDefaultGrouping"),value:1},{label:this.$t("device.restoreToYourOwnAccount"),value:2},{label:this.$t("device.editRecordNotFound"),value:3},{label:this.$t("device.deviceHasBeenDeleted"),value:4},{label:this.$t("device.restoreFailed"),value:5}]}},mixins:[p["a"],v["a"]],components:{LabelWrap:s["a"]},computed:Object(o["a"])({},Object(c["b"])(["deviceTypes","isQueryInitData"])),watch:{isQueryInitData:function(e){var t=this;e&&Object(n["rb"])({creater:null,keyword:""}).then((function(e){var r=e.forwards,a=[];r&&r.forEach((function(e){a.push({label:e.servername,value:e.forwardid})})),t.forwardLists=a;var i={count:t.pageSize,keyword:t.queryText,offset:0,all:!1,days:0};t.queryDeviceEditHistory(i)}))},queryType:function(){this.totalcount=0;var e={count:this.pageSize,keyword:this.queryText,offset:0,all:!1,days:Number(this.queryType)};this.queryDeviceEditHistory(e)}},destroyed:function(){this.tableList=null},methods:Object(o["a"])(Object(o["a"])({},Object(c["c"])(["setIsReloadRootuser","setReportTagList"])),{},{queryParents:function(e){var t=this;this.parentsList=[],Object(n["Bb"])(e).then((function(e){var r=e.status,a=e.records;0==r&&(a.forEach((function(e){e.usertypeStr=Object(d["cb"])(t.isZh,e.usertype)})),t.parentsList=a)}))},getForwardNameByForwardid:function(e){var t="";return this.forwardLists.forEach((function(r){r.value===e&&(t=r.label)})),t},getEditTypeStr:function(e){var t="";switch(e){case 1:t=this.$t("device.modifyDeviceName");break;case 2:t=this.$t("device.modifySim");break;case 3:t=this.$t("device.modifyRemarks");break;case 4:t=this.$t("device.modifyRemarks");break;case 5:t=this.$t("device.transferDevice");break;case 6:t=this.$t("bgManage.setConveyIp");break}return t},cellStyle:function(e){var t=e.row,r=(e.rowIndex,e.column);e.columnIndex;if("actionStatus"===r.property){if(0==t.actionStatus||1==t.actionStatus||2==t.actionStatus)return{color:"green"};if(5==t.actionStatus)return{color:"red"}}},exportData:function(){var e=[[this.$t("reportForm.index"),this.$t("bgManage.operator"),this.$t("device.editType"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.time"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("device.accountBeforeOperation"),this.$t("device.groupBeforeOperation"),this.$t("device.beforeOperation"),this.$t("device.afterOperation")]];this.tableList.forEach((function(t,r){var a=[];a.push(++r),a.push(t.editor),a.push(t.edittypeStr),a.push(t.devicename),a.push(t.deviceid),a.push(t.edittimeStr),a.push(t.postcreater),a.push(t.groupname),a.push(t.precreater),a.push(t.pregroupname),a.push(t.prevalue?t.prevalue:""),a.push(t.postvalue?t.postvalue:""),e.push(a)}));var t={title:this.$t("bgManage.editHistory"),data:e,dateRange:null};this.exportLoading1=!0,new ExcelCls(t).exportExcel(this)},restoreEditDeviceHistory:function(e){var t=this,r=e.row,a=r.edittype,i=r.deviceid,o={records:[r.edithistoryid]},s=u["a"].deviceInfos[i];Object(n["jc"])(o).then((function(e){var i=e.records;e.cause;if(i){var o=i[0];if(r.actionStatus=o.status,0==o.status){var n=r.prevalue;t.$XModal.message({message:t.$t("device.recoveryWasSuccessful"),status:"success",zIndex:9999}),1==a?(s&&(s.devicename=n),t.setReportTagList([]),t.setIsReloadRootuser(!0)):2==a?s&&(s.simiccid=n):3==a?s&&(s.remark=n):4==a?s&&(s.remark2=n):5==a&&(t.setReportTagList([]),t.setIsReloadRootuser(!0))}else 1==o.status?t.$XModal.message({message:t.$t("device.restoreToDefaultGrouping"),status:"success",zIndex:9999}):2==o.status?t.$XModal.message({message:t.$t("device.restoreToYourOwnAccount"),status:"success",zIndex:9999}):3==o.status?t.$XModal.message({message:t.$t("device.editRecordNotFound"),status:"error",zIndex:9999}):4==o.status?t.$XModal.message({message:t.$t("device.deviceHasBeenDeleted"),status:"error",zIndex:9999}):5==o.status&&t.$XModal.message({message:t.$t("device.restoreFailed"),status:"error",zIndex:9999})}}))},exportDataAll:function(){var e=this,t=[[this.$t("reportForm.index"),this.$t("bgManage.operator"),this.$t("device.editType"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.time"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("device.accountBeforeOperation"),this.$t("device.groupBeforeOperation"),this.$t("device.beforeOperation"),this.$t("device.afterOperation")]],r=this.deviceTypes;u["a"].deviceInfos;this.exportLoading=!0,Object(n["nb"])({all:!0,keyword:""}).then((function(a){var i=a.devices;if(e.exportLoading=!1,i){i.forEach((function(a,i){var o=[],s=a.deviceid,n="",c="",d=a.postcreater,p=a.postgroupid,v=a.precreater,h=a.pregroupid;n=0==p?e.$t("common.defaultGroup"):u["a"].getGroupName(d,p),c=0==h?e.$t("common.defaultGroup"):u["a"].getGroupName(v,h);var f=r[a.devicetype].typename;a.edittimeStr=l["a"].longToLocalDateTimeStr(a.edittime),a.deviceType=f,a.actionStatus=-1,a.edittypeStr=e.getEditTypeStr(a.edittype),a.groupname=n,a.pregroupname=c,o.push(++i),o.push(a.editor),o.push(a.edittypeStr),o.push(a.devicename),o.push(s),o.push(a.edittimeStr),o.push(a.postcreater),o.push(a.groupname),o.push(a.precreater),o.push(a.pregroupname),o.push(a.prevalue?a.prevalue:""),o.push(a.postvalue?a.postvalue:""),t.push(o)}));var o={title:e.$t("bgManage.editHistory"),data:t,dateRange:null};new ExcelCls(o).exportExcel(e)}})).catch((function(t){console.log(t),e.exportLoading=!1}))},handleEdit:function(e){this.currentRow=e.row,this.deviceid=e.row.deviceid,this.deviceName=e.row.devicename,this.editDialog=!0},handleClickQuery:function(){var e={count:this.pageSize,keyword:this.queryText,offset:0,all:!1,days:Number(this.queryType)};this.queryDeviceEditHistory(e)},queryDeviceEditHistory:function(e){var t=this;this.loading=!0;var r=this.deviceTypes;Object(n["nb"])(e).then((function(e){var a=e.devices,i=e.totalcount;t.totalcount=i,a.forEach((function(e){e.deviceid;var a="",i="",o=e.postcreater,s=e.postgroupid,n=e.precreater,c=e.pregroupid;a=0==s?t.$t("common.defaultGroup"):u["a"].getGroupName(o,s),i=0==c?t.$t("common.defaultGroup"):u["a"].getGroupName(n,c);var d=r[e.devicetype].typename;e.edittimeStr=l["a"].longToLocalDateTimeStr(e.edittime),e.deviceType=d,e.actionStatus=-1,e.edittypeStr=t.getEditTypeStr(e.edittype),e.groupname=a,e.pregroupname=i,6==e.edittype&&(e.prevalue=t.getForwardNameByForwardid(e.prevalue),e.postvalue=t.getForwardNameByForwardid(e.postvalue))})),t.tableList=a,t.loading=!1})).catch((function(e){console.log(e),t.loading=!1}))},currentChangePage:function(e){var t={count:this.pageSize,keyword:this.queryText,offset:e-1,all:!1,days:0};this.queryDeviceEditHistory(t)},handleSizeChange:function(e){this.pageSize=e,this.currentChangePage(this.currentPage)},handleCurrentChange:function(e){this.currentChangePage(e)}}),mounted:function(){var e=this;this.isQueryInitData&&Object(n["rb"])({creater:null,keyword:""}).then((function(t){var r=t.forwards,a=[];r&&r.forEach((function(e){a.push({label:e.servername,value:e.forwardid})})),e.forwardLists=a;var i={count:e.pageSize,keyword:e.queryText,offset:0,all:!1,days:0};e.queryDeviceEditHistory(i)}))}},g=y,b=(r("4b37"),r("2877")),$=Object(b["a"])(g,a,i,!1,null,null,null),x=$.exports;t["default"]=x},"2d3a":function(e,t,r){},"4b37":function(e,t,r){"use strict";r("2d3a")}}]);