(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7a40b362"],{"9ff0":function(e,t,r){},de88:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"user-record full"},[t("div",{staticClass:"user-record-header"},[t("div",{staticClass:"f_left",staticStyle:{width:"210px"}},[t("DropdownZtreeUser",{ref:"ztreeUser",attrs:{placeholder:e.$t("bgManage.pleaseEnterQueryUser"),label:e.$t("bgManage.queryUser")},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}})],1),t("div",{staticClass:"f_left"},[t("el-button",{staticStyle:{width:"90px"},attrs:{type:"primary",loading:e.loading},on:{click:e.handleClickQuery}},[e._v(e._s(e.$t("common.query")))])],1),t("div",{staticClass:"f_left",staticStyle:{"padding-top":"5px"}},[t("span",{staticStyle:{"font-size":"13px"}},[e._v(" "+e._s(e.$t("missing.totalNumber"))+":"+e._s(e.tableList.length)+" ")])]),t("div",{staticClass:"f_right"},[t("el-button",{attrs:{type:"primary",loading:e.exportLoading1},on:{click:e.exportData}},[e._v(e._s(e.$t("common.export")))])],1)]),t("div",{staticClass:"user-record-content",staticStyle:{top:"39px"}},[t("vxe-table",{ref:"xTable",attrs:{border:"",resizable:"","auto-resize":"","menu-config":e.tableMenu,"sort-config":e.sortConfig,"show-overflow":"","highlight-current-row":"",size:"mini",height:"auto",data:e.tableList},on:{"menu-click":e.handleClickTableMenu,"current-change":e.currentChangeEvent,"cell-dblclick":e.cellDblclick}},[t("vxe-table-column",{attrs:{field:"usertype",title:e.$t("reportForm.action"),width:"100"},scopedSlots:e._u([{key:"default",fn:function(r){return[t("div",{staticStyle:{"padding-top":"7px"}},[t("span",{staticStyle:{padding:"0px 11px 0px 0px"},attrs:{title:e.$t("common.edit")}},[t("img",{staticStyle:{width:"17px",cursor:"pointer"},attrs:{src:e.editIcon},on:{click:function(t){return e.handleEditUser(r)}}})]),t("el-popconfirm",{attrs:{placement:"top",icon:"el-icon-info","icon-color":"red","confirm-button-text":e.$t("common.confirm"),"cancel-button-text":e.$t("common.cancel"),title:e.$t("tips.confirmDelete")},on:{confirm:function(t){return e.handleDelete(r)}}},[t("span",{attrs:{slot:"reference"},slot:"reference"},[t("img",{staticStyle:{width:"16px",cursor:"pointer","margin-right":"11px"},attrs:{src:e.deleteIcon,title:e.$t("common.delete")}})])]),t("el-dropdown",{attrs:{trigger:"click",size:"mini"},on:{command:e.onCommand}},[t("span",{staticStyle:{position:"relative",top:"1px"}},[t("img",{staticStyle:{width:"18px",cursor:"pointer"},attrs:{src:e.moreIcon,title:e.$t("common.more")}})]),t("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},[t("el-dropdown-item",{staticClass:"clearfix",attrs:{command:"resetPassword"}},[e._v(e._s(e.$t("common.resetPassword")))]),t("el-dropdown-item",{staticClass:"clearfix",attrs:{command:"loginUser"}},[e._v(e._s(e.$t("bgManage.loginUser")))])],1)],1)],1)]}}])}),t("vxe-table-column",{attrs:{type:"seq",width:"60",title:e.$t("reportForm.index")}}),t("vxe-table-column",{attrs:{title:e.$t("bgManage.user"),field:"username",width:"145",sortable:""},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(r){return t("div",{key:r.username},[e._v(e._s(r.username)+"("+e._s(r.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(r.row.username)}},slot:"reference"},[e._v(e._s(r.row.username))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"showname",title:e.$t("bgManage.displayName"),width:"145",sortable:""}}),t("vxe-table-column",{attrs:{field:"usertypeStr",title:e.$t("bgManage.userType"),width:"90",sortable:""}}),t("vxe-table-column",{attrs:{field:"roleStr",title:e.$t("bgManage.role"),width:"90",sortable:""}}),t("vxe-table-column",{attrs:{field:"companyname",title:e.$t("bgManage.companyName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"cardname",title:e.$t("bgManage.contacts"),sortable:""}}),t("vxe-table-column",{attrs:{field:"phone",title:e.$t("reportForm.contactPhone"),sortable:""}}),t("vxe-table-column",{attrs:{field:"companyaddr",title:e.$t("bgManage.contactAddress"),sortable:""}}),t("vxe-table-column",{attrs:{title:e.$t("bgManage.upperUser"),field:"creater",sortable:""},scopedSlots:e._u([{key:"default",fn:function(r){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(r){return t("div",{key:r.username},[e._v(e._s(r.username)+"("+e._s(r.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(r.row.creater)}},slot:"reference"},[e._v(e._s(r.row.creater))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"createtimeStr",title:e.$t("bgManage.createTime"),sortable:""}})],1)],1),t("EditUserDialog",{ref:"dialog",attrs:{roles:e.roles},on:{"edit-user":e.onEditUser},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}})],1)},s=[],o=r("ade3"),n=r("5530"),i=(r("99af"),r("4de4"),r("c975"),r("14d9"),r("4e82"),r("a9e3"),r("b680"),r("d3b7"),r("159b"),r("2f62")),c=r("e285"),l=r("201d"),u=r("c7bc"),d=r("4a8a"),m=r("5101"),p=r("c276"),h=r("6e52"),g=r("0c87"),b=r("a05b"),f=r("b562"),v=r("61fc"),x=r("e173"),y=r("7b49"),w={name:"queryUser",data:function(){return{editIcon:v,deleteIcon:x,moreIcon:y,dialog:!1,loading:!1,exportLoading1:!1,searchText:"",parentsList:[],tableList:[],roles:[],sortConfig:{sortMethod:function(e){var t=e.data,r=e.sortList,a=r[0],s=a.property,o=a.order,n=[];return console.log("property",s),n="desc"===o?t.sort((function(e,t){var r=t[s]+"";return r.localeCompare(e[s])})):"asc"===o?t.sort((function(e,t){var r=e[s]+"";return r.localeCompare(t[s])})):t.sort(),n}}}},mixins:[g["a"],b["a"]],components:{LabelWrap:l["a"],EditUserDialog:d["a"],DropdownZtreeUser:u["a"]},computed:Object(n["a"])({},Object(i["b"])(["isZh","userName","isQueryInitData"])),watch:{isQueryInitData:function(e){e&&this.queryRecords()}},methods:Object(n["a"])(Object(n["a"])({},Object(i["c"])(["setIsReloadRootuser","setReportTagList"])),{},{onCommand:function(e){var t=this.currentRow.username;switch(e){case"resetPassword":this.resetUserPwd(t);break;case"loginUser":this.loginUserPwd(t);break;default:break}},currentChangeEvent:function(e){var t=e.row;this.currentRow=t},cellDblclick:function(e){this.handleEditUser(e)},handleEditUser:function(e){var t=e.row;document.body.clientWidth<document.body.clientHeight&&(document.body.scrollLeft=0),this.$refs.dialog.setInfo(t),this.dialog=!0},handleDelete:function(e){var t=this,r=e.rowIndex,a=e.row,s=a.username;Object(c["K"])([s]).then((function(e){var a=e.status,o=e.cause,n=e.count,i=e.bonuspoints,c=e.addvaluepoints,l=e.commission;if(0==a)t.$XModal.message({message:t.$t("tips.deleteSucc"),status:"success",zIndex:9999}),t.$delete(t.tableList,r),t.cacheList=t.cacheList.filter((function(e){return e.username!=s})),h["a"].removeUser(s),t.setReportTagList([]),t.setIsReloadRootuser(!0);else if(1==a)t.$XModal.message({message:t.$t("tips.accountAndDevice",{count:n}),status:"error",zIndex:9999});else if(2==a){var u="";i>0&&(u+=t.$t("bgManage.bonuspoints")+" "+i.toFixed(0)),c>0&&(u.length>0&&(u+=","),u+=t.$t("bgManage.addvaluepoints")+" "+Number(c.toFixed(2))),l>0&&(u.length>0&&(u+=","),u+=t.$t("bgManage.commission")+" "+Number(l.toFixed(2))),t.$XModal.message({message:t.$t("tips.accountAndGoldenBean",{str:u}),status:"error",zIndex:9999})}else t.$XModal.message({message:t.$t("tips.deleteFail")+o,status:"error",zIndex:9999})}))},resetUserPwd:function(e){var t=this;Object(c["fc"])(e).then((function(e){var r=e.status,a=e.newpass;0==r?t.$XModal.message({message:t.$t("tips.resetPassSucc")+a,status:"success",zIndex:9999}):t.$XModal.message({message:t.$t("tips.resetPassFail")+cause,status:"error",zIndex:9999})}))},loginUserPwd:function(e){var t=this,r={type:"USER",from:"web",username:e,aslevel1:0};Object(f["K"])(r,this.$store.state.user.token).then((function(e){var r=e.status,a=e.token;if(0==r){var s;Object(p["Fb"])(a),Object(p["Hb"])(e.username),Object(p["Bb"])(e.nickname),Object(p["Ib"])(e.usertype),Object(p["ub"])(e.forcealarm),Object(p["sb"])(e.alarmaction);var n=(s={playbacklinewidth:e.playbacklinewidth,email:e.email,nickname:e.nickname,phone:e.phone,qq:e.qq,wechat:e.wechat},Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(Object(o["a"])(s,"email",e.email),"creatername",e.creatername),"username",e.username),"multilogin",e.multilogin),"intervaltime",e.intervaltime),"createremail",e.createremail),"creatername",e.creatername),"createrphone",e.createrphone),"createrqq",e.createrqq),"createrwechat",e.createrwechat),Object(o["a"])(Object(o["a"])(s,"logourl",e.logourl),"logotitle",e.logotitle));Object(p["Ab"])(n),window.open("".concat(window.location.origin).concat(window.location.pathname,"#/monitorPage"))}else-1==r?t.$XModal.message({message:t.$t("login.error_3"),status:"error",zIndex:9999}):1==r?t.$XModal.message({message:t.$t("login.error_4"),status:"error",zIndex:9999}):2==r?t.$XModal.message({message:t.$t("login.error_5"),status:"error",zIndex:9999}):3==r?t.$XModal.message({message:t.$t("login.error_6"),status:"error",zIndex:9999}):4==r?t.$XModal.message({message:t.$t("login.error_7"),status:"error",zIndex:9999}):5==r&&t.$XModal.message({message:t.$t("login.error_8"),status:"error",zIndex:9999})}))},formatLevel:function(e){var t=e.usertype;return Object(p["cb"])(this.isZh,t)},formatRole:function(e){for(var t=e.roleuuid,r=this.roles,a="",s=0;s<r.length;s++){var o=r[s];if(o.roleuuid==t){a=1==o.roletype?this.isZh?o.rolename:o.rolenameen:o.rolename;break}}return a},onEditUser:function(e){e.usertypeStr=this.formatLevel(e),e.roleStr=this.formatRole(e)},queryRecords:function(){var e=this;this.loading=!0;this.isZh;Object(c["Tb"])(this.userName,0).then((function(t){var r=t.userlists,a=[];r&&(r.forEach((function(t){t.usertypeStr=e.formatLevel(t),t.roleStr=e.formatRole(t),t.createtimeStr=m["a"].format(new Date(t.createtime),"yyyy-MM-dd")})),a=r),e.tableList=a,e.cacheList=a,e.loading=!1}))},handleClickQuery:function(){var e=[],t=this.searchText.toLowerCase();this.cacheList.forEach((function(r){var a=r.username?r.username:"",s=r.showname?r.showname:"";-1==a.toLowerCase().indexOf(t)&&-1==s.toLowerCase().indexOf(t)||e.push(r)})),this.tableList=e},queryRoles:function(e){var t=this,r=this.isZh;Object(c["Lb"])({}).then((function(a){var s=a.status,o=a.roles,n=[];0==s&&null!=o&&o.forEach((function(e){1==e.roletype&&0==r&&(e.rolename=e.rolenameen);var t="";e.remark&&(t="-"+e.remark),e.label=e.rolename+"(".concat(e.creater,")")+t,e.value=e.roleuuid,n.push(e)})),t.roles=n,e()})).catch((function(e){console.log(e),t.loading=!1}))},exportData:function(){if(0!=this.cacheList.length){var e=[[this.$t("reportForm.index"),this.$t("bgManage.user"),this.$t("bgManage.displayName"),this.$t("bgManage.userType"),this.$t("bgManage.role"),this.$t("reportForm.contactPhone"),this.$t("bgManage.contactAddress"),this.$t("reportForm.creater"),this.$t("bgManage.createTime")]],t=this.$refs.xTable.getTableData().visibleData;t.forEach((function(t,r){var a=[];a.push(r+1),a.push(t.username),a.push(t.showname),a.push(t.usertypeStr),a.push(t.roleStr),a.push(t.phone?t.phone:""),a.push(t.companyaddr?t.companyaddr:""),a.push(t.creater),a.push(t.createtimeStr),e.push(a)}));var r={title:this.$t("bgManage.queryUser"),data:e};this.exportLoading1=!0,new ExcelCls(r).exportExcel(this)}}}),mounted:function(){var e=this;this.cacheList=[],this.$nextTick((function(){e.isQueryInitData&&e.queryRoles((function(){e.queryRecords()}))}))}},$=w,k=(r("fd65"),r("2877")),M=Object(k["a"])($,a,s,!1,null,null,null),_=M.exports;t["default"]=_},fd65:function(e,t,r){"use strict";r("9ff0")}}]);