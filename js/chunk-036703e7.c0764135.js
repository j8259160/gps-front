(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-036703e7"],{"0595":function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"quick-time-range"},[e("div",{staticClass:"quick-time-range-wrapper"},t._l(t.list,(function(a){return e("div",{key:a.type,style:{color:a.type==t.type?"#409EFF":""},on:{click:function(e){return t.selectDate(a.type)}}},[t._v(t._s(a.label))])})),0),e("div",{staticClass:"quick-time-range-space"}),e("div",{staticClass:"quick-time-range-btn",on:{click:function(e){t.isCollapse=!t.isCollapse}}},[t.isCollapse?e("i",{staticClass:"el-icon-arrow-right"}):e("i",{staticClass:"el-icon-arrow-left"})])])},r=[],s=a("5101"),o={name:"QuickTimeRange",props:{value:{type:Array,default:function(){return[]}},dateType:{type:String,default:"date"}},watch:{isCollapse:function(){this.setList()}},data:function(){return{isCollapse:!0,type:0,list:[]}},methods:{setList:function(){this.isCollapse?this.list=[{label:this.$t("reportForm.toDay"),type:0},{label:this.$t("reportForm.yesterDay"),type:1},{label:this.$t("reportForm.recent3Days"),type:3}]:this.list=[{label:this.$t("reportForm.recent7Days"),type:7},{label:this.$t("reportForm.recent10Days"),type:10},{label:this.$t("reportForm.recent30Days"),type:30}]},selectDate:function(t){var e="datetimerange"==this.dateType,a=[],i=new Date,r=new Date;switch(e&&(i=new Date(s["a"].format(new Date,"yyyy-MM-dd")+" 00:00:00"),r=new Date(s["a"].format(new Date,"yyyy-MM-dd")+" 23:59:59")),t){case 0:a=[new Date(s["a"].format(i,"yyyy-MM-dd")+" 00:00:00"),new Date(s["a"].format(r,"yyyy-MM-dd")+" 23:59:59")];break;case 1:i.setTime(i.getTime()-864e5),r.setTime(r.getTime()-864e5),a=[i,r];break;case 3:i.setTime(i.getTime()-2592e5),a=[i,r];break;case 7:i.setTime(i.getTime()-6048e5),a=[i,r];break;case 10:i.setTime(i.getTime()-864e6),a=[i,r];break;case 30:i.setTime(i.getTime()-2592e6),a=[i,r];break}this.type=t,this.$emit("input",a)}},mounted:function(){var t=this;this.$nextTick((function(){t.setList()}))}},n=o,c=(a("8d09"),a("2877")),l=Object(c["a"])(n,i,r,!1,null,null,null);e["a"]=l.exports},"0886":function(t,e,a){"use strict";a("bd2b")},"3b13":function(t,e,a){},"3fdb":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form full"},[e("div",{staticClass:"report-form-inner"},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left"},[e("SelectDate",{model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),e("div",{staticClass:"f_left"},[e("QuickTimeRange",{model:{value:t.dateRange,callback:function(e){t.dateRange=e},expression:"dateRange"}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("div",{staticClass:"f_right"},[e("el-popover",{attrs:{placement:"bottom",width:"236",trigger:"click"}},[e("div",[e("el-button",{staticStyle:{width:"100px"},attrs:{slot:"reference",type:"primary",loading:t.exportLoading1,plain:""},on:{click:t.exportData},slot:"reference"},[t._v(t._s(t.$t("common.summary")))]),e("el-button",{staticStyle:{width:"100px"},attrs:{slot:"reference",type:"primary",loading:t.exportLoading2,plain:""},on:{click:t.exportDetailData},slot:"reference"},[t._v(t._s(t.$t("reportForm.detailed")))])],1),e("el-button",{attrs:{slot:"reference",type:"primary"},slot:"reference"},[t._v(t._s(t.$t("common.export")))])],1)],1)])]),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"45px"}},[e("vxe-table",{ref:"xTable",staticClass:"mytable-scrollbar acc-report",attrs:{"sort-config":t.sortConfig,"menu-config":t.tableMenu,border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:t.totalList},on:{"menu-click":t.handleClickTableMenu}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index")}}),e("vxe-table-column",{attrs:{type:"expand",width:"36"},scopedSlots:t._u([{key:"content",fn:function(a){var i=a.row;return[[e("div",{staticStyle:{"padding-left":"60px"}},[e("vxe-table",{staticClass:"mytable-scrollbar",attrs:{"sort-config":t.sortConfig,"menu-config":t.tableMenu,"highlight-current-row":"",border:"",resizable:"","auto-resize":"",size:"mini","show-overflow":"","highlight-hover-row":"",height:i.tableHeight,data:i.detailsList},on:{"menu-click":t.handleClickTableMenu,"current-change":t.currentChange}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index"),sortable:""}}),e("vxe-table-column",{attrs:{field:"accStatus",title:t.$t("reportForm.accStatus"),width:"100",sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("span",{style:{color:a.row.accColor},domProps:{textContent:t._s(a.row.accStatus)}})]}}],null,!0)}),e("vxe-table-column",{attrs:{field:"durationStr",align:"right",title:t.$t("common.duration"),width:"260",sortable:""}}),e("vxe-table-column",{attrs:{field:"startDate",title:t.$t("reportForm.startTime"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"address-wrap",attrs:{title:a.row.saddress}},[e("div",{domProps:{textContent:t._s(a.row.startDate)}}),e("div",{staticClass:"ellipsis",domProps:{textContent:t._s(a.row.saddress)}})])]}}],null,!0)}),e("vxe-table-column",{attrs:{field:"endDate",title:t.$t("reportForm.endTime"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("div",{staticClass:"address-wrap",attrs:{title:a.row.eaddress}},[e("div",{domProps:{textContent:t._s(a.row.endDate)}}),e("div",{staticClass:"ellipsis",domProps:{textContent:t._s(a.row.eaddress)}})])]}}],null,!0)})],1)],1)]]}}])}),e("vxe-table-column",{attrs:{field:"devicename",title:t.$t("alarm.devName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"deviceid",title:t.$t("alarm.devNum"),sortable:""}}),e("vxe-table-column",{attrs:{field:"creater",title:t.$t("reportForm.creater"),sortable:""},scopedSlots:t._u([{key:"default",fn:function(a){return[e("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[e("div",{staticClass:"parents-wrapper"},t._l(t.parentsList,(function(a){return e("div",{key:a.username},[t._v(t._s(a.username)+"("+t._s(a.usertypeStr)+")")])})),0),e("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(e){return t.queryParents(a.row.creater)}},slot:"reference"},[t._v(t._s(a.row.creater))])],1)]}}])}),e("vxe-table-column",{attrs:{field:"groupname",title:t.$t("reportForm.groupName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"opennumber",title:t.$t("reportForm.accCount"),sortable:""}}),e("vxe-table-column",{attrs:{field:"durationStr",title:t.$t("reportForm.accDuration"),align:"right",sortable:""}})],1)],1)])])},r=[],s=(a("14d9"),a("4e82"),a("a9e3"),a("b680"),a("d3b7"),a("159b"),a("4795"),a("6e52")),o=a("e561"),n=a("d462"),c=a("57c9"),l=a("1c31"),d=a("5101"),u=a("c276"),p=a("a05b"),m=a("0c87"),h={name:"accReport",data:function(){return{loading:!1,exportLoading1:!1,exportLoading2:!1,tableTitle:"",activeName:"tabTotal",dateRange:[new Date,new Date],totalList:[],detailsList:[],sortConfig:{sortMethod:function(t){var e=t.data,a=t.sortList,i=a[0],r=i.property,s=i.order,o=[];return o="accStatus"==r?"desc"===s?e.sort((function(t,e){return e.accstate-t.accstate})):"asc"===s?e.sort((function(t,e){return t.accstate-e.accstate})):e.sort():"durationStr"==r?"desc"===s?e.sort((function(t,e){return e.duration-t.duration})):"asc"===s?e.sort((function(t,e){return t.duration-e.duration})):e.sort():"desc"===s?e.sort((function(t,e){var a=e[r]+"";return a.localeCompare(t[r])})):"asc"===s?e.sort((function(t,e){var a=t[r]+"";return a.localeCompare(e[r])})):e.sort(),o}}}},mixins:[p["a"],m["a"]],computed:{statisticsStyle:function(){return{zIndex:"tabTotal"==this.activeName?999:0}},detailsStyle:function(){return{zIndex:"details"==this.activeName?999:0}}},watch:{dateRange:function(){this.loading||this.handleQuery()}},components:{MultiChoiceVehicle:o["a"],SelectDate:n["a"],QuickTimeRange:c["a"]},methods:{onSelectDevice:function(t){this.deviceids=t},handleQuery:function(){var t=this,e=this.deviceids,a=this.dateRange;if(0!=e.length)if(0!=a.length){"details"==this.activeName&&(this.activeName="tabTotal",this.totalList=[],this.detailsList=[]);var i=d["a"].format(a[0],"yyyy-MM-dd"),r=d["a"].format(a[1],"yyyy-MM-dd"),o={starttime:"".concat(i," 00:00:00"),endtime:"".concat(r," 23:59:59"),offset:d["a"].getOffset(),deviceids:e,needaddress:1};this.loading=!0,this.queryDetailDateRange=o.starttime+"  "+o.endtime,Object(l["B"])(o).then((function(e){var a=e.records,i=e.addressmap;t.loading=!1;var r=[];null!=a&&a.forEach((function(e,a){var o=s["a"].deviceInfos[e.deviceid],n=o.devicename,c=s["a"].getShowName(o.creater),l=o.groupname,d={index:a+1,deviceid:e.deviceid,opennumber:0,duration:"",devicename:n,creater:c,groupname:l,records:e.records},p=0;e.records.forEach((function(t){t.devicename=n,3==t.accstate&&(p+=t.endtime-t.begintime,d.opennumber++)})),d.detailsList=t.getAccDetailTableData(e.records,i),d.tableHeight=0==e.records.length?79:42*e.records.length+79,d.duration=Number((p/1e3/3600).toFixed(2)),d.durationStr=Object(u["Pb"])(p,!0),r.push(d)})),t.totalList=r,1==r.length&&setTimeout((function(){t.$refs.xTable.setRowExpand(r[0],!0)}),500)})).catch((function(e){t.loading=!1}))}else this.$XModal.message({message:this.$t("tips.selectTime"),status:"error",zIndex:9999});else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})},currentChange:function(t){},getAccDetailTableData:function(t,e){var a=[],i=this,r=0,s=0;return null==e&&(e={}),t.sort((function(t,e){return t.begintime-e.begintime})),t.forEach((function(t,o){var n=Number(((t.endtime-t.begintime)/1e3/3600).toFixed(2)),c=Object(u["Pb"])(t.endtime-t.begintime,!0),l="",p="";0==t.accstate?(l=i.$t("reportForm.notEnabled"),p="red"):3==t.accstate?(l=i.$t("reportForm.accOpen"),p="#43B984",r+=t.endtime-t.begintime):2==t.accstate&&(s+=t.endtime-t.begintime,p="#F0676A",l=i.$t("reportForm.stalling"));var m={index:o+1,deviceid:t.deviceid,devicename:t.devicename,startDate:d["a"].longToLocalDateTimeStr(t.begintime),endDate:d["a"].longToLocalDateTimeStr(t.endtime),accStatus:l,accColor:p,accstate:t.accstate,duration:n,durationStr:c,saddress:Object(u["L"])(e,t.slat,t.slon),eaddress:Object(u["L"])(e,t.elat,t.elon)};m.data={deviceids:[m.deviceid],reporttype:1,startday:m.startDate,endday:m.endDate,offset:d["a"].getOffset()},a.push(m)})),a.length>0&&a.push({durationStr:this.$t("reportForm.accOnTime")+":"+Object(u["Pb"])(r,!0)+" "+this.$t("reportForm.accOffTime")+":"+Object(u["Pb"])(s,!0)}),a},exportData:function(){if(0!=this.totalList.length){var t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.accCount"),this.$t("reportForm.accDuration")]];this.totalList.forEach((function(e,a){var i=[];i.push(a+1),i.push(e.devicename),i.push(e.deviceid),i.push(e.creater),i.push(e.groupname),i.push(e.opennumber),i.push(e.durationStr),t.push(i)}));var e={title:this.$t("reportForm.accReport"),data:t,dateRange:this.queryDetailDateRange};this.exportLoading1=!0,new ExcelCls(e).exportExcel(this)}},exportDetailData:function(){var t=this;if(0!=this.totalList.length){var e=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.startTime"),this.$t("reportForm.endTime"),this.$t("reportForm.accStatus"),this.$t("reportForm.accDuration"),this.$t("reportForm.saddress"),this.$t("reportForm.eaddress")]],a="";this.totalList.forEach((function(i){var r=i.detailsList,o=i.deviceid;1==t.totalList.length&&(a=s["a"].getDeviceNameByDeviceId(o)),r.forEach((function(t,a){if(t.deviceid){var i=[];i.push(a+1),i.push(t.devicename),i.push(t.deviceid),i.push(t.startDate),i.push(t.endDate),i.push(t.accStatus),i.push(t.durationStr),i.push(t.saddress),i.push(t.eaddress),e.push(i)}else{i=[];i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(""),i.push(t.durationStr),i.push(""),i.push(""),e.push(i)}}));var n=[];n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),e.push(n)}));var i={title:this.$t("reportForm.accReport")+"_"+this.$t("reportForm.detailed")+" "+(a?" - "+a:""),data:e,dateRange:this.queryDetailDateRange};this.exportLoading2=!0,new ExcelCls(i).exportExcel(this)}}},mounted:function(){this.deviceids=[]}},f=h,v=(a("0886"),a("2877")),b=Object(v["a"])(f,i,r,!1,null,null,null),g=b.exports;e["default"]=g},"57c9":function(t,e,a){"use strict";var i=a("0595");e["a"]=i["a"]},7031:function(t,e,a){"use strict";a("3b13")},"8d09":function(t,e,a){"use strict";a("a818")},a818:function(t,e,a){},bd2b:function(t,e,a){},e561:function(t,e,a){"use strict";var i=a("ea22");e["a"]=i["a"]},ea22:function(t,e,a){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-choice multi-choice-vehicle"},[e("div",{staticClass:"multi-choice-input"},[e("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:t.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:t.isQueryInitData,selectDeviceIds:t.multipleDeviceids},on:{onTreeCheck:t.onTreeCheck}})],1)])},r=[],s=a("5530"),o=(a("4795"),a("2f62")),n=a("2df7"),c={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(s["a"])({},Object(o["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:n["a"]},methods:Object(s["a"])(Object(s["a"])({},Object(o["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(t){this.$emit("onSelectDevice",t),this.setMultipleDeviceids(t)},clearText:function(){var t=this;setTimeout((function(){t.$refs.ztreeDevice.clearText()}),300)}})},l=c,d=(a("7031"),a("2877")),u=Object(d["a"])(l,i,r,!1,null,null,null);e["a"]=u.exports}}]);