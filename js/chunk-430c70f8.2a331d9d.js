(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-430c70f8"],{"388ae":function(e,t,a){"use strict";a("5cc9")},"52b0":function(e,t,a){"use strict";a("8c0e")},"5cc9":function(e,t,a){},"8c0e":function(e,t,a){},ae31:function(e,t,a){"use strict";var r=function(){var e=this,t=e._self._c;return t("vxe-modal",{attrs:{title:e.$t("bgManage.batchTransferDevice"),className:"vxe-modal-visible modal-padding0",value:e.value,width:"320px"},on:{hide:function(t){return e.$emit("input",!1)},close:function(t){return e.$emit("input",!1)}}},[t("el-row",{staticClass:"margin_b10"},[t("el-col",{attrs:{span:24}},[t("div",{staticStyle:{"padding-left":"4px","font-size":"13px"}},[t("span",[e._v(e._s(e.$t("bgManage.selectedTransferDevices")))]),t("span",{staticStyle:{height:"32px","line-height":"32px","padding-left":"10px",color:"#1678ff"},domProps:{textContent:e._s(e.selectList.length)}})])])],1),t("el-row",{staticClass:"margin_b10"},[t("el-col",{attrs:{span:21}},[t("DropdownZtreeUserGroup",{ref:"ztree",attrs:{label:e.$t("bgManage.transferUser")},model:{value:e.target,callback:function(t){e.target=t},expression:"target"}})],1),t("el-col",{attrs:{span:3}},[t("div",{staticClass:"user-ztree-refresh",on:{click:e.refreshZtree}},[e.reloadLoading?t("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"18px"}}):t("i",{staticClass:"el-icon-refresh-right",staticStyle:{"font-size":"18px"}})])])],1),t("el-row",{staticStyle:{"margin-top":"20px"}},[t("el-col",{staticStyle:{"text-align":"center"},attrs:{span:24}},[t("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary",loading:e.loading},on:{click:e.handleClickTransfer}},[e._v(e._s(e.$t("common.determine")))])],1)],1)],1)},i=[],n=a("5530"),s=(a("d81d"),a("d3b7"),a("201d")),o=a("cf40"),l=a("e285"),c=a("b562"),d=a("6e52"),h=a("2f62"),u={props:{value:{type:Boolean,default:!1},selectList:{type:Array,default:function(){return[]}}},data:function(){return{loading:!1,reloadLoading:!1,target:{}}},components:{LabelWrap:s["a"],DropdownZtreeUserGroup:o["a"]},mounted:function(){},methods:Object(n["a"])(Object(n["a"])({},Object(h["c"])(["setIsReloadRootuser","setReportTagList"])),{},{refreshZtree:function(){var e=this;0==this.reloadLoading&&(this.reloadLoading=!0,Object(c["S"])().then((function(t){var a=t.rootuser;e.reloadLoading=!1,d["a"].rootuser=a,d["a"].setDeviceInfos(a),e.$refs.ztree.ininZtree()})).catch((function(t){e.reloadLoading=!1})))},openFullLoading:function(){var e=this.$loading({lock:!0,text:this.$t("missing.pleaseWait"),spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});return e},handleClickTransfer:function(){var e=this,t=this.target.creater,a=this.target.groupid;if(void 0!=t&&void 0!=a){var r=this.selectList.map((function(e){var t=e.deviceid;return t}));if(r.length>500)return void this.$XModal.message({message:this.$t("tips.transferDeviceExceed500"),status:"error",zIndex:9999});if(r.length>0){var i={action:"move",deviceids:r,targetgroupid:a,targetusername:t};this.loading=!0;var n=this.openFullLoading();Object(l["m"])(i).then((function(t){var a=t.status,r=t.success;e.loading=!1,0==a?(Object(c["S"])().then((function(t){var a=t.rootuser;d["a"].rootuser=a,d["a"].setDeviceInfos(a),e.$emit("transferSucc"),e.$emit("input",!1)})),e.$XModal.message({message:e.$t("tips.transferSucc",{success:r}),status:"success",zIndex:9999}),e.setReportTagList([]),e.setIsReloadRootuser(!0)):91==a?e.$XModal.message({message:e.$t("tips.noPermission"),status:"error",zIndex:9999}):e.$XModal.message({message:e.$t("tips.transferFail"),status:"error",zIndex:9999})})).catch((function(t){console.log(t),e.loading=!1})).finally((function(e){n.close()}))}else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})}else this.$XModal.message({message:this.$t("tips.transferTargetUser"),status:"error",zIndex:9999})}})},p=u,f=(a("52b0"),a("2877")),g=Object(f["a"])(p,r,i,!1,null,"cf7be80e",null);t["a"]=g.exports},cf40:function(e,t,a){"use strict";a("b0c0");var r=function(){var e=this,t=e._self._c;return t("LabelWrap",{attrs:{label:e.label}},[t("div",{directives:[{name:"clickoutside",rawName:"v-clickoutside",value:e.handleClickOutside,expression:"handleClickOutside"}],staticClass:"full",staticStyle:{position:"relative"}},[t("el-input",{attrs:{clearable:"",placeholder:e.placeholder},on:{input:e.onChange},nativeOn:{click:function(t){e.show=!0}},model:{value:e.textVal,callback:function(t){e.textVal=t},expression:"textVal"}}),t("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"el-popover el-popper",staticStyle:{width:"240px",position:"absolute",top:"32px","z-index":"3029"},attrs:{"x-placement":"bottom"}},[t("div",{staticClass:"drop-down-vxetree noselect",staticStyle:{height:"280px",width:"100%"}},[t("vxe-table",{ref:"xTable",staticClass:"mytree-scrollbar",attrs:{height:"100%",size:"mini","show-overflow":"","highlight-hover-row":"","highlight-current-row":"","row-config":e.rowConfig,"auto-resize":!0,border:"none","checkbox-config":{checkStrictly:!1,showHeader:!0},"tree-config":e.treeConfig,"show-header":!1,"scroll-y":{enabled:!0,gt:0},data:e.treeData},on:{"cell-click":e.onClickRow}},[t("vxe-table-column",{attrs:{width:"100%",field:"id"},scopedSlots:e._u([{key:"default",fn:function(a){var r=a.row;return[t("div",{staticClass:"fence-checkbox-cell",style:{paddingLeft:e.getIndent(r)+"px"},on:{contextmenu:function(e){e.preventDefault()}}},[r.children.length?t("span",{staticStyle:{position:"relative",top:"1.5px","padding-right":"3px"},on:{dblclick:function(e){e.stopPropagation()},click:function(t){return t.stopPropagation(),e.onExpandNode(r)}}},[(0==r.children.length?r.expand:e.$refs.xTable.isTreeExpandByRow(r))?t("img",{attrs:{src:e.bihe,width:"12",height:"12"}}):t("img",{attrs:{src:e.zhankai,width:"12",height:"12"}})]):t("span",{staticStyle:{position:"relative",top:"1.5px","padding-right":"3px"}},[t("img",{staticStyle:{visibility:"hidden"},attrs:{src:e.zhankai,width:"12",height:"12"}})]),t("span",{on:{click:function(e){e.stopPropagation()},dblclick:function(e){e.stopPropagation()}}},[t("el-radio",{staticStyle:{margin:"0px 3px 0px 2px"},attrs:{label:r.id},on:{change:function(t){return e.handleCheckboxChange(r)}},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}})],1),"user"==r.nodeType?t("img",{staticStyle:{width:"16px",height:"16px",border:"0px",position:"relative",top:"3.5px"},attrs:{src:r.icon}}):e._e(),"group"==r.nodeType?t("img",{staticStyle:{width:"15px",height:"14px",border:"0px",position:"relative",top:"2.5px"},attrs:{src:r.icon}}):e._e(),t("span",{staticStyle:{"padding-left":"3px"},domProps:{textContent:e._s(r.name)}})])]}}])})],1)],1),t("div",{staticClass:"popper__arrow",staticStyle:{left:"112.5px"},attrs:{"x-arrow":""}})])],1)])},i=[],n=a("5530"),s=(a("99af"),a("4de4"),a("c975"),a("14d9"),a("d3b7"),a("498a"),a("159b"),a("4795"),a("0139")),o=a("6e52"),l=a("c276"),c=a("6406"),d=a("2ef0"),h=a("9169"),u=a("2f62"),p=a("0d33"),f=a("7fa8"),g=a("0d27"),v=a("8130"),m={name:"DropdownZtreeUserGroup",props:{value:{type:Object,default:function(){return{}}},disableShare:{type:Boolean,default:!1},label:{type:String,default:""}},data:function(){return{show:!1,zhankai:g,bihe:v,textVal:"",placeholder:"",radio:"",rowConfig:{height:24,useKey:"id",keyField:"id"},treeConfig:{transform:!0,showLine:!0,rowField:"id",parentField:"parentId",expandRowKeys:[]},treeData:[]}},components:{LabelWrap:s["a"]},computed:Object(n["a"])({},Object(u["b"])(["isQueryInitData","userName"])),directives:{Clickoutside:h["a"]},methods:{getIndent:function(e){var t=18;return e.level*t},handleClickOutside:function(){this.show=!1},onChange:function(e){this.searchUser(this,e.trim())},searchUser:Object(d["debounce"])((function(e,t){0==e.show&&(e.show=!0);var a=e.$refs.xTable;if(0==t.length)e.treeData=Object(c["h"])(e.treeNodes),a.setTreeExpand(e.treeNodes[0],!0);else{e.expandIds={};var r=e.variableDeepSearch(e.treeNodes,t.trim());e.treeData=Object(c["h"])(r),a.reloadData(e.treeData);var i=e.treeData.filter((function(t){return e.expandIds[t.id]}));setTimeout((function(){a.setTreeExpand(i,!0)}),100)}}),300),handleCheckboxChange:function(e){var t=this,a=this.$refs.xTable;this.treeData.forEach((function(a){a.id==e.id?(t.radio=e.id,a.checked=!0):a.checked=!1})),a.setCurrentRow(e),this.onTreeCheck(e)},getNodeByid:function(e){for(var t=null,a=this.treeData,r=0;r<a.length;r++){var i=a[r];if(i.id==e){t=i;break}}return t},onClickRow:function(e){var t=e.row;this.handleCheckboxChange(t)},onExpandNode:function(e){var t=this.$refs.xTable,a=null;0==e.children.length?(a=!e.expand,e.expand=a):a=!t.isTreeExpandByRow(e),t.setTreeExpand(e,a)},onTreeCheck:function(e){var t=e.name;if(this.textVal=t,this.placeholder=t,e.nodeType==o["a"].NodeType_User)this.$emit("input",{creater:e.username,groupid:0,name:t});else if(e.nodeType==o["a"].NodeType_Group){var a=e.parentId,r=this.getNodeByid(a);r&&this.$emit("input",{creater:r.username,groupid:e.groupid,name:t})}this.show=!1},emitValue:function(e){this.textVal=e.name?e.name:e.creater,this.placeholder=e.creater,this.radio=e.creater,this.$emit("input",e)},getUserGroupNode:function(e){for(var t=e.creater,a=e.groupid,r=e.nodeType,i=this.treeData,n=null,s=0;s<i.length;s++){var o=i[s];if("user"==o.nodeType&&t==o.username&&0==a){n=o;break}if(r==o.nodeType&&o.username==t&&o.groupid==a){n=o;break}}return n},ininZtree:function(){var e=this.castUsersTreeToDevicesTree(o["a"].rootuser),t=Object(c["h"])(e);this.treeData=t,this.$refs.xTable.setTreeExpand(e[0],!0),this.treeNodes=this.castUsersTreeToDevicesTree(o["a"].rootuser)},variableDeepSearch:function(e,t){t=t.toLowerCase();for(var a=[],r=this,i=0;i<e.length;i++){var n=null,s=e[i];if(null!=s){var l=!1;if(-1==s.name.toLowerCase().indexOf(t)&&-1==(s.username&&s.username.toLowerCase().indexOf(t))||(n=Object(d["cloneDeep"])(s),l=!0),0==l){var c=o["a"].pinyinMap[s.name];(c&&-1!=c.l.toLowerCase().indexOf(t)||c&&-1!=c.p.toLowerCase().indexOf(t))&&(n=Object(d["cloneDeep"])(s),l=!0)}if(0==l&&s.children&&s.children.length>0){var h=r.variableDeepSearch(s.children,t);h&&h.length>0&&(n=Object(d["cloneDeep"])(s),n.children=h,l=!0)}1==l&&(r.expandIds[n.parentId]=!0,a.push(n))}}return a},getDeviceListGroups:function(e,t,a){var r=[];if(e)for(var i=0;i<e.length;++i){var n=e[i],s=n.groupid>0;if(s){var c=void 0===n.shared?0:n.shared,d=n.groupname,h={groupid:n.groupid,name:d,groupname:d,icon:f,username:t,id:t+"-"+n.groupid,parentId:t,nodeType:o["a"].NodeType_Group,shared:c,level:a,checked:!1};if(this.disableShare&&1==n.shared)continue;r.push(h)}}return Object(l["Kb"])(r),r},castUsersTreeToDevicesTree:function(e){var t={name:"",icon:p,open:!0,nodeType:o["a"].NodeType_User,level:0,checked:!1};if(null!=e){var a=e.username,r=e.subusers,i=e.showname;t.name=a,t.username=a,t.showname=i,t.id=a,t.parentId=null;var n=this.getDeviceListGroups(e.groups,a,t.level+1);if(null!=a&&null!=r&&r.length>0){var s=this.doCastUsersTreeToDevicesTree(r,a,t.level+1);s.length>0&&(t.children=s)}if(n.length){var l=n.concat(t.children?t.children:[]);t.children=l}}return[t]},doCastUsersTreeToDevicesTree:function(e,t,a){var r=[];if(null!=e&&e.length>0)for(var i=0;i<e.length;++i){var n=e[i],s=n.username,c=n.subusers,d=n.showname,h={name:d||s,icon:p,nodeType:o["a"].NodeType_User,username:s,showname:d,id:s,parentId:t,level:a,checked:!1},u=this.getDeviceListGroups(n.groups,s,a+1);if(null!=s&&null!=c&&c.length>0){var f=this.doCastUsersTreeToDevicesTree(c,s,a+1);f.length>0&&(h.children=f)}var g=u.concat(h.children?h.children:[]);g.length>0&&(h.children=g),r.push(h)}return Object(l["Kb"])(r),r}},watch:{isQueryInitData:function(e){e&&this.ininZtree()}},mounted:function(){var e=this;this.isQueryInitData&&this.ininZtree(),this.$nextTick((function(){e.placeholder=e.$t("bgManage.editUserTitle1")}))}},x=m,b=(a("388ae"),a("2877")),w=Object(b["a"])(x,r,i,!1,null,null,null);t["a"]=w.exports}}]);