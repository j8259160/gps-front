(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-f948358a"],{"0595":function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"quick-time-range"},[t("div",{staticClass:"quick-time-range-wrapper"},e._l(e.list,(function(a){return t("div",{key:a.type,style:{color:a.type==e.type?"#409EFF":""},on:{click:function(t){return e.selectDate(a.type)}}},[e._v(e._s(a.label))])})),0),t("div",{staticClass:"quick-time-range-space"}),t("div",{staticClass:"quick-time-range-btn",on:{click:function(t){e.isCollapse=!e.isCollapse}}},[e.isCollapse?t("i",{staticClass:"el-icon-arrow-right"}):t("i",{staticClass:"el-icon-arrow-left"})])])},r=[],s=a("5101"),o={name:"QuickTimeRange",props:{value:{type:Array,default:function(){return[]}},dateType:{type:String,default:"date"}},watch:{isCollapse:function(){this.setList()}},data:function(){return{isCollapse:!0,type:0,list:[]}},methods:{setList:function(){this.isCollapse?this.list=[{label:this.$t("reportForm.toDay"),type:0},{label:this.$t("reportForm.yesterDay"),type:1},{label:this.$t("reportForm.recent3Days"),type:3}]:this.list=[{label:this.$t("reportForm.recent7Days"),type:7},{label:this.$t("reportForm.recent10Days"),type:10},{label:this.$t("reportForm.recent30Days"),type:30}]},selectDate:function(e){var t="datetimerange"==this.dateType,a=[],i=new Date,r=new Date;switch(t&&(i=new Date(s["a"].format(new Date,"yyyy-MM-dd")+" 00:00:00"),r=new Date(s["a"].format(new Date,"yyyy-MM-dd")+" 23:59:59")),e){case 0:a=[new Date(s["a"].format(i,"yyyy-MM-dd")+" 00:00:00"),new Date(s["a"].format(r,"yyyy-MM-dd")+" 23:59:59")];break;case 1:i.setTime(i.getTime()-864e5),r.setTime(r.getTime()-864e5),a=[i,r];break;case 3:i.setTime(i.getTime()-2592e5),a=[i,r];break;case 7:i.setTime(i.getTime()-6048e5),a=[i,r];break;case 10:i.setTime(i.getTime()-864e6),a=[i,r];break;case 30:i.setTime(i.getTime()-2592e6),a=[i,r];break}this.type=e,this.$emit("input",a)}},mounted:function(){var e=this;this.$nextTick((function(){e.setList()}))}},n=o,l=(a("8d09"),a("2877")),c=Object(l["a"])(n,i,r,!1,null,null,null);t["a"]=c.exports},"3b13":function(e,t,a){},"57c9":function(e,t,a){"use strict";var i=a("0595");t["a"]=i["a"]},"5f74":function(e,t,a){"use strict";a("bfbc")},7031:function(e,t,a){"use strict";a("3b13")},"80f4":function(e,t,a){"use strict";var i=a("32eb");t["a"]=i["a"]},"8d09":function(e,t,a){"use strict";a("a818")},9550:function(e,t,a){"use strict";a.r(t);var i=a("ade3"),r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"report-form full"},[t("div",{staticClass:"report-form-inner"},[t("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[t("div",{staticClass:"f_left"},[t("MultiChoiceVehicle",{on:{onSelectDevice:e.onSelectDevice}})],1),t("div",{staticClass:"f_left",staticStyle:{width:"170px"}},[t("LabelWrap",{attrs:{label:e.$t("reportForm.parkingDuration")}},[t("el-select",{model:{value:e.interval,callback:function(t){e.interval=t},expression:"interval"}},e._l(e.optionList,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"f_left"},[t("SelectDate",{attrs:{dateType:"datetimerange"},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),t("div",{staticClass:"f_left"},[t("QuickTimeRange",{attrs:{dateType:"datetimerange"},model:{value:e.dateRange,callback:function(t){e.dateRange=t},expression:"dateRange"}})],1),t("div",{staticClass:"f_left"},[t("el-button",{attrs:{loading:e.loading,type:"primary"},on:{click:e.handleQuery}},[e._v(e._s(e.$t("common.query")))])],1),t("div",{staticClass:"f_left"},[t("el-button",{attrs:{type:"primary",loading:e.exportLoading1},on:{click:e.exportData}},[e._v(e._s(e.$t("common.export")))])],1)]),t("div",{staticClass:"report-form-inner-content",staticStyle:{top:"40px"}},[t("vxe-table",{ref:"xTable",staticClass:"mytable-scrollbar",attrs:{border:"","expand-config":{accordion:!0},"sort-config":e.sortConfig,"menu-config":e.tableMenu,data:e.totalList,height:"auto",size:"mini"},on:{"menu-click":e.handleClickTableMenu,"cell-dblclick":e.cellDblclick}},[t("vxe-table-column",{attrs:{type:"seq",width:"60"}}),t("vxe-table-column",{attrs:{type:"expand",width:"36"},scopedSlots:e._u([{key:"content",fn:function(a){var i=a.row;a.rowIndex;return[[t("div",{staticStyle:{"padding-left":"60px"}},[t("vxe-table",{attrs:{"sort-config":e.sortConfig,"menu-config":e.tableMenu,border:"",resizable:"","auto-resize":"",height:i.tableHeight,"show-overflow":"","highlight-hover-row":"","highlight-current-row":"",size:"mini",data:i.records},on:{"menu-click":e.handleClickTableMenu}},[t("vxe-table-column",{attrs:{type:"seq",width:"60"}}),t("vxe-table-column",{attrs:{field:"startDate",title:e.$t("reportForm.startTime"),width:"158",sortable:""}}),t("vxe-table-column",{attrs:{field:"endDate",title:e.$t("reportForm.endTime"),width:"158",sortable:""}}),t("vxe-table-column",{attrs:{field:"triptimeStrNoDay",align:"right",title:e.$t("reportForm.travelTime"),width:"100",sortable:""}}),t("vxe-table-column",{attrs:{field:"tripdistanceStr",formatter:e.numberToFixed2,align:"right",title:e.$t("reportForm.durationDistance")+e.distanceUnit,width:"120",sortable:""}}),t("vxe-table-column",{attrs:{field:"averagespeedStr",formatter:e.numberToFixed2,align:"right",title:e.$t("reportForm.avgSpeed")+e.speedUnit,width:"120",sortable:""}}),t("vxe-table-column",{attrs:{field:"maxspeedStr",formatter:e.numberToFixed2,align:"right",title:e.$t("reportForm.maxSpeed")+e.speedUnit,width:"120",sortable:""}}),t("vxe-table-column",{attrs:{field:"saddress",title:e.$t("reportForm.startAddress"),width:"240"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"text-decoration":"underline",cursor:"pointer",color:"#388cfe"},domProps:{textContent:e._s(a.row.saddress)},on:{click:function(t){return e.handleClickRow(a.row)}}})]}}],null,!0)}),t("vxe-table-column",{attrs:{field:"eaddress",title:e.$t("reportForm.endAddress"),width:"240"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("span",{staticStyle:{"text-decoration":"underline",cursor:"pointer",color:"#388cfe"},domProps:{textContent:e._s(a.row.eaddress)},on:{click:function(t){return e.handleClickRow(a.row)}}})]}}],null,!0)})],1)],1)]]}}])}),t("vxe-table-column",{attrs:{field:"devicename",title:e.$t("alarm.devName"),sortable:""}}),t("vxe-table-column",{attrs:{field:"deviceid",title:e.$t("alarm.devNum"),sortable:""}}),t("vxe-table-column",{attrs:{field:"creater",title:e.$t("reportForm.creater"),sortable:""},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-popover",{attrs:{placement:"bottom",trigger:"click"}},[t("div",{staticClass:"parents-wrapper"},e._l(e.parentsList,(function(a){return t("div",{key:a.username},[e._v(e._s(a.username)+"("+e._s(a.usertypeStr)+")")])})),0),t("el-button",{staticStyle:{color:"#000000"},attrs:{slot:"reference",type:"text"},on:{click:function(t){return e.queryParents(a.row.creater)}},slot:"reference"},[e._v(e._s(a.row.creater))])],1)]}}])}),t("vxe-table-column",{attrs:{field:"groupname",title:e.$t("reportForm.groupName"),sortable:""}}),t("vxe-table-column",{attrs:Object(i["a"])({field:"triptimeStrNoDay",align:"right",sortable:"",title:e.$t("reportForm.travelTime")},"sortable","")}),t("vxe-table-column",{attrs:Object(i["a"])({field:"totalDistance",formatter:e.numberToFixed2,align:"right",sortable:"",title:e.$t("reportForm.durationDistance")+e.distanceUnit},"sortable","")}),t("vxe-table-column",{attrs:{field:"averageSpeed",formatter:e.numberToFixed2,align:"right",sortable:"",title:e.$t("reportForm.avgSpeed")+e.speedUnit}}),t("vxe-table-column",{attrs:{field:"maxSpeed",formatter:e.numberToFixed2,align:"right",sortable:"",title:e.$t("reportForm.maxSpeed")+e.speedUnit}})],1)],1),t("vxe-modal",{attrs:{title:e.$t("reportForm.seeMap"),className:"modal-padding0",value:e.dialogMap,width:"500"},on:{hide:function(t){e.dialogMap=!1},close:function(t){e.dialogMap=!1}}},[t("div",{staticStyle:{width:"100%",height:"400px"}},[t("ReportMap",{ref:"mapIns"})],1)])],1)])},s=[],o=a("5530"),n=(a("14d9"),a("4e82"),a("a9e3"),a("d3b7"),a("159b"),a("4795"),a("d03a")),l=a("e561"),c=a("d462"),d=a("80f4"),u=a("57c9"),p=a("1c31"),m=a("7cf8"),h=a("c276"),f=a("201d"),b=a("5101"),v=a("6e52"),g=a("a05b"),y=a("0c87"),x=a("2f62"),D={name:"TravelRecords",data:function(){return{loading:!1,exportLoading1:!1,deviceid:"",tableTitle:"",totalParkTime:"",dialogMap:!1,interval:"10",optionList:[],dateRange:[new Date(b["a"].format(new Date,"yyyy-MM-dd")+" 00:00:00"),new Date(b["a"].format(new Date,"yyyy-MM-dd")+" 23:59:59")],totalList:[],detailsList:[],sortConfig:{sortMethod:function(e){var t=e.data,a=e.sortList,i=a[0],r=i.property,s=i.order,o=[];return o="tripdistanceStr"==r||"maxSpeed"==r||"averagespeedStr"==r||"totalDistance"==r?"desc"===s?t.sort((function(e,t){return Number(t[r])-Number(e[r])})):"asc"===s?t.sort((function(e,t){return Number(e[r])-Number(t[r])})):t.sort():"triptimeStrNoDay"==r?"desc"===s?t.sort((function(e,t){return t.triptime-e.triptime})):"asc"===s?t.sort((function(e,t){return e.triptime-t.triptime})):t.sort():"desc"===s?t.sort((function(e,t){var a=t[r]+"";return a.localeCompare(e[r])})):"asc"===s?t.sort((function(e,t){var a=e[r]+"";return a.localeCompare(t[r])})):t.sort(),o}}}},watch:{dateRange:function(){this.loading||this.handleQuery()}},computed:Object(o["a"])({},Object(x["b"])(["distanceUnit","speedUnit"])),mixins:[g["a"],y["a"]],components:{MultiChoiceVehicle:l["a"],SingleChoiceVehicle:n["a"],SelectDate:c["a"],ReportMap:d["a"],QuickTimeRange:u["a"],LabelWrap:f["a"]},methods:{numberToFixed2:h["qb"],cellDblclick:function(e){var t=e.row,a=this.$refs.xTable.isRowExpandByRow(t);this.$refs.xTable.setRowExpand(t,!a)},onSelectDevice:function(e){this.deviceids=e},exportData:function(){var e=this,t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.creater"),this.$t("reportForm.groupName"),this.$t("reportForm.startTime"),this.$t("reportForm.endTime"),this.$t("reportForm.travelTime")+"(H)",this.$t("reportForm.travelTime"),this.$t("reportForm.durationDistance")+this.distanceUnit,this.$t("reportForm.avgSpeed")+this.speedUnit,this.$t("reportForm.maxSpeed")+this.speedUnit,this.$t("reportForm.startAddress"),this.$t("reportForm.endAddress"),this.$t("reportForm.startLonLat"),this.$t("reportForm.endLonLat")]];if(0!=this.totalList.length){var a="",i="";this.totalList.forEach((function(r,s){a=r.devicename,i=r.deviceid,r.records.forEach((function(e,i){var s=[];s.push(++i),s.push(a),s.push(r.deviceid),s.push(r.creater),s.push(r.groupname),s.push(e.startDate),s.push(e.endDate),s.push(Object(h["qb"])(e.triptimeStr)),s.push(Object(h["Qb"])(e.triptime)),s.push(Object(h["qb"])(e.tripdistanceStr)),s.push(Object(h["qb"])(e.averagespeedStr)),s.push(Object(h["qb"])(e.maxspeedStr)),s.push(e.saddress?e.saddress:""),s.push(e.eaddress?e.eaddress:""),s.push(e.slon+","+e.slat),s.push(e.elon+","+e.elat),t.push(s),i++}));var o=[];o.push(e.$t("common.summary")),o.push(a),o.push(0==r.records.length?i:""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(Object(h["qb"])(r.triptimeStr)),o.push(Object(h["Qb"])(r.triptime)),o.push(Object(h["qb"])(r.totalDistance)),o.push(Object(h["qb"])(r.averageSpeed)),o.push(Object(h["qb"])(r.maxSpeed)),o.push(""),o.push(""),o.push(""),o.push(""),t.push(o),o=[],o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),o.push(""),t.push(o)}));var r="";r=1==this.totalList.length?a:e.$t("bgManage.tower",{count:this.totalList.length});var s={title:this.$t("reportForm.travelRecords")+" - "+r,data:t,dateRange:this.queryDetailDateRange};this.exportLoading1=!0,new ExcelCls(s).exportExcel(this)}},handleClickRow:function(e){var t=this,a={deviceid:e.deviceid,begintime:e.startDate,endtime:e.endDate,timezone:b["a"].getOffset()};this.dialogMap=!0,Object(m["Z"])(a).then((function(e){e.status;var a=e.records;setTimeout((function(){a=a||[],t.$refs.mapIns.markersAndLineLayerToMap(a)}),300)})).catch((function(e){console.log(e)}))},handleQuery:function(){var e=this,t=this.deviceids,a=this.dateRange;if(0!=t.length)if(0!=a.length){var i=b["a"].format(a[0],"yyyy-MM-dd HH:mm:ss"),r=b["a"].format(a[1],"yyyy-MM-dd HH:mm:ss"),s={begintime:i,endtime:r,deviceids:t,interval:60*Number(this.interval),needaddress:1,timezone:b["a"].getOffset(),needfuelreport:0};this.loading=!0,this.queryDetailDateRange=null,Object(p["w"])(s).then((function(t){e.queryDetailDateRange=i+"  "+r,e.loading=!1,console.log(t);var a=[],s=t.status,o=t.tripsmulti;0==s?o.forEach((function(e){var t=e.deviceid,i=e.totaltrips,r=e.totalaveragespeed,s=e.totaldistance,o=e.totalmaxspeed,n=e.totaltriptime,l=e.addressmap,c=v["a"].deviceInfos[t];i.forEach((function(e){e.deviceid=t,e.startDate=b["a"].longToLocalDateTimeStr(e.starttime),e.endDate=b["a"].longToLocalDateTimeStr(e.endtime),e.triptimeStr=e.triptime/1e3/3600,e.triptimeStrNoDay=Object(h["Qb"])(e.triptime),e.tripdistanceStr=Object(h["d"])(e.tripdistance),e.averagespeedStr=Object(h["e"])(e.averagespeed),e.maxspeedStr=Object(h["e"])(e.maxspeed),e.saddress=Object(h["L"])(l,e.slat,e.slon),e.eaddress=Object(h["L"])(l,e.elat,e.elon)}));var d={deviceid:t,tableHeight:0==i.length?82:36*i.length+46,devicename:c.devicename,creater:c.creater,groupname:c.groupname,averageSpeed:Object(h["e"])(r),totalDistance:Object(h["d"])(s),maxSpeed:Object(h["e"])(o),triptimeStr:n/1e3/3600,triptimeStrNoDay:Object(h["Qb"])(n),triptime:n,records:i};a.push(d)})):e.$XModal.message({message:e.$t("tips.queryFail"),status:"error",zIndex:9999}),e.totalList=a,1==a.length&&setTimeout((function(){e.$refs.xTable.setRowExpand(a[0],!0)}),500)}))}else this.$XModal.message({message:this.$t("tips.selectTime"),status:"error",zIndex:9999});else this.$XModal.message({message:this.$t("tips.selectDevice"),status:"error",zIndex:9999})}},mounted:function(){var e=this;this.deviceids=[],this.$nextTick((function(){e.optionList=[{label:"1"+e.$t("monitor.minute"),value:"1"},{label:"3"+e.$t("monitor.minute"),value:"3"},{label:"5"+e.$t("monitor.minute"),value:"5"},{label:"10"+e.$t("monitor.minute"),value:"10"},{label:"30"+e.$t("monitor.minute"),value:"30"},{label:"1"+e.$t("monitor.hour"),value:"60"},{label:"2"+e.$t("monitor.hour"),value:"120"}]}))}},$=D,w=(a("5f74"),a("2877")),S=Object(w["a"])($,r,s,!1,null,null,null),T=S.exports;t["default"]=T},a818:function(e,t,a){},bfbc:function(e,t,a){},e561:function(e,t,a){"use strict";var i=a("ea22");t["a"]=i["a"]},ea22:function(e,t,a){"use strict";var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"multi-choice multi-choice-vehicle"},[t("div",{staticClass:"multi-choice-input"},[t("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:e.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:e.isQueryInitData,selectDeviceIds:e.multipleDeviceids},on:{onTreeCheck:e.onTreeCheck}})],1)])},r=[],s=a("5530"),o=(a("4795"),a("2f62")),n=a("2df7"),l={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(s["a"])({},Object(o["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:n["a"]},methods:Object(s["a"])(Object(s["a"])({},Object(o["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(e){this.$emit("onSelectDevice",e),this.setMultipleDeviceids(e)},clearText:function(){var e=this;setTimeout((function(){e.$refs.ztreeDevice.clearText()}),300)}})},c=l,d=(a("7031"),a("2877")),u=Object(d["a"])(c,i,r,!1,null,null,null);t["a"]=u.exports}}]);