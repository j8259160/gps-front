(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0024cad5"],{"449c":function(e,t,s){"use strict";s.r(t);var a=s("ade3"),r=(s("b0c0"),function(){var e=this,t=e._self._c;return t("div",{staticClass:"create-user full"},[t("div",{staticClass:"create-user-left"},[t("div",{staticClass:"create-user-inner full"},[t("div",{staticClass:"create-user-inner-title"},[t("i",{staticClass:"circle"}),t("b",{domProps:{textContent:e._s(e.$t("bgManage.createUserTitle1"))}}),t("span",{domProps:{textContent:e._s(e.$t("bgManage.createUserDesc1"))}}),t("el-tooltip",{attrs:{placement:"right",effect:"light"}},[t("div",{attrs:{slot:"content"},slot:"content"},[t("ul",{staticStyle:{padding:"0px 0px 0px 20px",margin:"0px"}},[t("li",{staticStyle:{padding:"0px","list-style-type":"disc"},domProps:{textContent:e._s(e.$t("bgManage.createUserTip1"))}}),t("li",{staticStyle:{padding:"4px 0px 0px 0px","list-style-type":"disc"},domProps:{textContent:e._s(e.$t("bgManage.createUserTip2"))}})])]),t("span",{staticStyle:{padding:"0 10px",position:"relative",top:"2px"}},[t("i",{staticClass:"el-icon-warning-outline new-add-tips-icon",staticStyle:{"font-size":"16px",color:"#ECC849"}})])])],1),t("div",{staticClass:"create-user-inner-content"},[t("div",{staticClass:"create-user-inner-content-tab"},[t("div",{class:["user"==e.activeTab?"tab-ative":""],on:{click:function(t){e.activeTab="user"}}},[e._v(e._s(e.$t("bgManage.createSubUser")))]),t("div",{class:["group"==e.activeTab?"tab-ative":""],on:{click:function(t){e.activeTab="group"}}},[e._v(e._s(e.$t("monitor.createGroup")))])]),t("div",{staticClass:"create-user-form"},[t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("DropdownZtreeUser",{ref:"ztreeUser",attrs:{showLabel:"",label:e.$t("bgManage.upperUser")},model:{value:e.creater,callback:function(t){e.creater=t},expression:"creater"}})],1)],1),"user"==e.activeTab?t("div",[t("el-row",{staticClass:"margin_b12"},[t("el-col",{staticClass:"red-star",attrs:{span:1}},[e._v("*")]),t("el-col",{attrs:{span:22}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.subUser")}},[t("el-input",{attrs:Object(a["a"])(Object(a["a"])({clearable:"",maxlength:"32",disabled:e.disabled},"maxlength",32),"placeholder",e.$t("common.maxWords32")),on:{focus:e.onFocusSubUsername,blur:function(t){e.showStatus=!1}},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),e.showStatus?t("div",{staticClass:"username-tips"},[t("el-alert",{attrs:{size:"mini",title:e.userTip,type:"error",closable:!1,"show-icon":""}})],1):e._e()],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.accountLevel")}},[t("el-select",{staticStyle:{width:"100%"},attrs:{disabled:e.disabled},model:{value:e.userLevel,callback:function(t){e.userLevel=t},expression:"userLevel"}},e._l(e.userOptions,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("LabelWrap",{attrs:{label:e.$t("bgManage.initPassword")}},[t("el-input",{attrs:{clearable:"",disabled:e.disabled,placeholder:e.$t("login.inputPassword")},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{staticStyle:{height:"34px",background:"#1678ff","border-radius":"5px"},attrs:{type:"primary",loading:e.userLoading,size:"medium",disabled:e.disabled},on:{click:e.handleAddUser}},[e._v(e._s(e.$t("common.determine")))])],1)])],1)],1):e._e(),"group"==e.activeTab?t("div",[t("el-row",{staticClass:"margin_b12"},[t("el-col",{staticClass:"red-star",attrs:{span:1}},[e._v("*")]),t("el-col",{attrs:{span:22}},[t("LabelWrap",{attrs:{label:e.$t("reportForm.groupName")}},[t("el-input",{attrs:{clearable:"",maxlength:32,placeholder:e.$t("common.maxWords32")},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1)],1)],1),t("el-row",{staticClass:"margin_b12"},[t("el-col",{attrs:{span:22,offset:1}},[t("div",{staticStyle:{"text-align":"center"}},[t("el-button",{staticStyle:{height:"34px",background:"#1678ff"},attrs:{type:"primary",loading:e.groupLoading,size:"medium"},on:{click:e.handleAddGroup}},[e._v(e._s(e.$t("common.determine")))])],1)])],1)],1):e._e()],1)])])]),t("div",{staticClass:"create-user-right"},[t("div",{staticClass:"create-user-inner full"},[t("div",{staticClass:"create-user-inner-title"},[t("i",{staticClass:"circle"}),t("b",{staticStyle:{padding:"0px 5px"},domProps:{textContent:e._s(e.$t("bgManage.previewList"))}}),t("b",{domProps:{textContent:e._s(e.$t("bgManage.account"))}}),e._v("("),t("img",{attrs:{src:e.userIcon}}),e._v(")"),t("b",{staticStyle:{"padding-left":"5px"},domProps:{textContent:e._s(e.$t("bgManage.group"))}}),e._v("("),t("img",{attrs:{src:e.groupIcon}}),e._v(") "),t("span",{staticClass:"refresh",on:{click:e.refreshZtree}},[t("i",{staticClass:"el-icon-refresh"})])]),t("div",{staticClass:"create-user-inner-content",staticStyle:{"padding-top":"0px"}},[t("div",{staticClass:"full noselect",staticStyle:{overflow:"hidden",cursor:"pointer"}},[t("vxe-table",{ref:"xTable",staticClass:"mytree-scrollbar",attrs:{loading:e.treeLoading,height:"100%",size:"mini","show-overflow":"","highlight-hover-row":"","highlight-current-row":"","row-config":e.rowConfig,"auto-resize":!0,border:"none","checkbox-config":{checkStrictly:!1,showHeader:!0},"tree-config":e.treeConfig,"show-header":!1,"scroll-y":{enabled:!0,gt:0},data:e.treeData},on:{"cell-click":e.onClickRow}},[t("vxe-table-column",{attrs:{width:"100%",field:"id"},scopedSlots:e._u([{key:"default",fn:function(s){var a=s.row;return[t("div",{staticClass:"fence-checkbox-cell",style:{paddingLeft:e.getIndent(a)+"px"},attrs:{title:a.showTitle},on:{contextmenu:function(e){e.preventDefault()}}},[a.children.length?t("span",{staticStyle:{position:"relative",top:"1.5px","padding-right":"3px"},on:{dblclick:function(e){e.stopPropagation()},click:function(t){return t.stopPropagation(),e.onExpandNode(a)}}},[(0==a.children.length?a.expand:e.$refs.xTable.isTreeExpandByRow(a))?t("img",{attrs:{src:e.bihe,width:"12",height:"12"}}):t("img",{attrs:{src:e.zhankai,width:"12",height:"12"}})]):t("span",{staticStyle:{position:"relative",top:"1.5px","padding-right":"3px"}},[t("img",{staticStyle:{visibility:"hidden"},attrs:{src:e.zhankai,width:"12",height:"12"}})]),"user"==a.nodeType?t("img",{staticStyle:{width:"16px",height:"16px",border:"0px",position:"relative",top:"3.5px"},attrs:{src:a.icon}}):e._e(),"group"==a.nodeType?t("img",{staticStyle:{width:"15px",height:"14px",border:"0px",position:"relative",top:"2.5px"},attrs:{src:a.icon}}):e._e(),t("span",{staticStyle:{"padding-left":"3px"},domProps:{textContent:e._s(a.name)}}),t("span",[e._v("("+e._s(a.allCount)+")")])])]}}])})],1)],1)])])])])}),n=[],i=s("5530"),o=(s("99af"),s("14d9"),s("d3b7"),s("498a"),s("159b"),s("4795"),s("6e52")),l=s("c7bc"),c=s("0139"),u=s("2f62"),d=s("e285"),p=s("c276"),g=s("2ef0"),h=s("6406"),m=s("6821"),v=s.n(m),f=s("0d33"),b=s("7fa8"),x=s("0d27"),y=s("8130"),w={name:"createUser",data:function(){return{treeLoading:!1,activeTab:"user",creater:"",username:"",password:"Aa1357",groupname:"",userIcon:f,groupIcon:b,zhankai:x,bihe:y,userLevel:"",userOptions:[],showStatus:!1,userLoading:!1,groupLoading:!1,userTip:"",rowConfig:{height:24,useKey:"id",keyField:"id"},treeConfig:{transform:!0,showLine:!0,rowField:"id",parentField:"parentId",expandRowKeys:[]},treeData:[]}},computed:Object(i["a"])(Object(i["a"])({},Object(u["b"])(["isZh","userName","userLevelList","isQueryInitData"])),{},{disabled:function(){return 0==this.userOptions.length}}),watch:{userName:function(e){this.creater=e},username:function(e){"user"==this.activeTab&&this.checkUsernameStatus(this,e.trim())},userOptions:function(e){0==e.length&&this.$XModal.message({message:this.$t("bgManage.ordinarySupervisorsCannotCreateSubAccounts"),status:"error",zIndex:9999})},creater:function(e){this.userLevelList;var t=o["a"].getUserByUserName(e);t&&(this.userOptions=this.getUserOptions(t.usertype),this.userOptions.length&&(this.userLevel=this.userOptions[0].value))},isQueryInitData:function(e){e&&this.init()}},components:{DropdownZtreeUser:l["a"],LabelWrap:c["a"]},methods:Object(i["a"])(Object(i["a"])({},Object(u["c"])(["setIsReloadRootuser","setReportTagList"])),{},{checkUsernameStatus:Object(g["debounce"])((function(e,t){Object(d["p"])(t).then((function(s){var a=s.status;0==a?e.showStatus=!1:1==a?(e.showStatus=!0,e.userTip=e.$t("tips.accountNameOccupied")):2==a?(e.showStatus=t&&t.length>0,e.userTip=e.$t("tips.insufficientLength")):3==a?(e.showStatus=!0,e.userTip=e.$t("tips.lengthTooLong")):e.showStatus=!1}))}),300),onFocusSubUsername:function(){this.showStatus=!1,this.checkUsernameStatus(this,this.username)},handleAddUser:function(){var e=this,t=this.creater.trim(),s=this.username.trim();if(""!=s)if(s.length>32)this.$XModal.message({message:this.$t("bgManage.accountNameTooLong"),status:"error",zIndex:9999});else{this.userLoading=!0;var a={creater:t,username:s,usertype:this.userLevel,password:v()(this.password),multilogin:1};Object(d["j"])(a).then((function(r){var n=r.status,i=r.cause;if(e.userLoading=!1,0==n){var l={showname:s,username:s,subusers:null,groups:[],nodeType:o["a"].NodeType_User,usertype:a.usertype};o["a"].pinyinMap[l.username]=__pinyin.get(l.username),o["a"].addUser(t,l),e.username="",e.$refs.ztreeUser.initZtree(),e.initZtree(),e.setReportTagList([]),e.setIsReloadRootuser(!0),e.$XModal.message({message:e.$t("tips.addSucc"),status:"success",zIndex:9999})}else 1==n?e.$XModal.message({message:e.$t("tips.accountNameOccupied"),status:"error",zIndex:9999}):e.$XModal.message({message:e.$t("tips.addFail")+" "+i,status:"error",zIndex:9999})})).catch((function(t){e.userLoading=!1}))}},handleAddGroup:function(){var e=this,t=this.creater.trim(),s=this.username.trim();if(""!=s)if(s.length>32)this.$XModal.message({message:this.$t("bgManage.groupNameTooLong"),status:"error",zIndex:9999});else{this.groupLoading=!0;var a={groupname:s,creater:t};Object(d["e"])(a).then((function(s){var a=s.status,r=s.cause,n=s.groupid,i=s.groupname;if(e.groupLoading=!1,0==a){e.username="";var l={devices:[],groupid:n,groupname:i,remark:null,creater:t};o["a"].pinyinMap[l.groupname]=__pinyin.get(l.groupname),o["a"].addGroup(t,l),e.initZtree(),e.setReportTagList([]),e.setIsReloadRootuser(!0),e.$XModal.message({message:e.$t("tips.addSucc"),status:"success",zIndex:9999})}else 1==a?e.$XModal.message({message:e.$t("tips.addGroupSame"),status:"error",zIndex:9999}):2==a?e.$XModal.message({message:e.$t("tips.editDeviceFailTip3"),status:"error",zIndex:9999}):e.$XModal.message({message:e.$t("tips.addFail")+":"+r,status:"error",zIndex:9999})})).catch((function(t){e.groupLoading=!1}))}},refreshZtree:function(){this.$refs.xTable.reloadData(this.treeData),this.initZtree()},getTreeNodeByUsername:function(e,t){var s=null;function a(e,t){for(var r in e){var n=e[r];"user"===n.nodeType&&n.username&&n.username==t?s=n:n.children&&n.children.length>0&&a(n.children,t)}}return a(e,t),s},getTreeNodeByGroupname:function(e,t){var s=null;function a(e,t){for(var r in e){var n=e[r];"group"===n.nodeType&&void 0!=n.groupid&&n.groupid==t?s=n:n.children&&n.children.length>0&&a(n.children,t)}}return a(e,t),s},getIndent:function(e){var t=18;return e.level*t},onClickRow:function(){},onExpandNode:function(e){var t=this.$refs.xTable,s=null;0==e.children.length?(s=!e.expand,e.expand=s):s=!t.isTreeExpandByRow(e),t.setTreeExpand(e,s)},initZtree:function(){var e=this;this.treeLoading=!0,setTimeout((function(){var t=e.castUsersTreeToDevicesTree(o["a"].rootuser);e.treeData=Object(h["h"])(t),e.$refs.xTable.setTreeExpand(t[0],!0),e.treeLoading=!1}),100)},castUsersTreeToDevicesTree:function(e){var t={name:"",icon:f,open:!0,nodeType:o["a"].NodeType_User,level:0,checked:!1,allCount:0,children:[]};if(null!=e){var s=e.username,a=e.subusers,r=e.showname;t.name=s,t.username=s,t.showname=r,t.id=s,t.parentId=null;var n=this.getDeviceListGroups(t,e.groups,s,t.level+1);if(null!=s&&null!=a&&a.length>0){var i=this.doCastUsersTreeToDevicesTree(a,s,t.level+1);i.length>0&&(t.children=i)}if(n.length){var l=n.concat(t.children?t.children:[]);t.children=l}t.children.forEach((function(e){t.allCount+=e.allCount}))}return[t]},doCastUsersTreeToDevicesTree:function(e,t,s){var a=[];if(null!=e&&e.length>0)for(var r=0;r<e.length;++r){var n=e[r],i=n.username,l=n.subusers,c=n.showname,u={name:c||i,icon:f,nodeType:o["a"].NodeType_User,username:i,showname:c,id:i,parentId:t,level:s,checked:!1,allCount:0,children:[]},d=this.getDeviceListGroups(u,n.groups,i,s+1);if(null!=i&&null!=l&&l.length>0){var g=this.doCastUsersTreeToDevicesTree(l,i,s+1);g.length>0&&(u.children=g)}var h=d.concat(u.children?u.children:[]);h.length>0&&(u.children=h),u.children.forEach((function(e){u.allCount+=e.allCount})),a.push(u)}return Object(p["Kb"])(a),a},getDeviceListGroups:function(e,t,s,a){var r=[];if(t)for(var n=0;n<t.length;++n){var i=t[n],l=i.groupid>0;if(l){var c=void 0===i.shared?0:i.shared,u=i.groupname,d={groupid:i.groupid,name:u,groupname:u,icon:b,username:s,id:s+"-"+i.groupid,parentId:s,nodeType:o["a"].NodeType_Group,shared:c,level:a,checked:!1};if(d.allCount=i.devices.length,this.disableShare&&1==i.shared)continue;r.push(d)}else e.allCount+=i.devices.length}return Object(p["Kb"])(r),r},getUserOptions:function(e){var t=[];return this.userLevelList.forEach((function(s){var a=s.name,r=s.type;r>e&&r<=11&&t.push({label:a,value:r})})),t},init:function(){var e=this;this.$nextTick((function(){e.creater=e.userName;var t=o["a"].getUserByUserName(e.userName);t&&(e.userOptions=e.getUserOptions(t.usertype),e.userOptions.length&&(e.userLevel=e.userOptions[0].value),e.$refs.ztreeUser.selectedUser(e.userName)),e.initZtree()}))}}),mounted:function(){this.isQueryInitData&&this.init()}},T=w,C=(s("6df5"),s("2877")),$=Object(C["a"])(T,r,n,!1,null,null,null),_=$.exports;t["default"]=_},"64a6":function(e,t,s){},"6df5":function(e,t,s){"use strict";s("64a6")}}]);