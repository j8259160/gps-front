(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3e303732"],{ad2d:function(e,t,i){"use strict";i.r(t);i("b0c0");var n=function(){var e=this,t=e._self._c;return t("div",{staticClass:"edit-device full"},[t("div",{staticClass:"edit-device-left"},[t("div",{staticClass:"edit-device-inner full"},[t("div",{staticClass:"edit-device-inner-title"},[t("i",{staticClass:"circle"}),t("b",{domProps:{textContent:e._s(e.$t("common.selectDevice"))}}),t("span",{domProps:{textContent:e._s(e.$t("missing.viewEditDevice"))}})]),t("div",{staticClass:"edit-device-inner-content"},[t("div",{staticClass:"edit-device-inner-content-search"},[t("div",[t("el-input",{staticStyle:{width:"100%"},attrs:{clearable:"",placeholder:e.$t("reportForm.pleaseEnterSearchContent")},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),t("div",{on:{click:e.refreshZtree}},[t("i",{staticClass:"el-icon-refresh"})])]),t("div",{staticClass:"edit-device-inner-content-ztree drop-down-vxetree noselect"},[t("vxe-table",{ref:"xTable",staticClass:"mytree-scrollbar",attrs:{loading:e.tLoading,height:"100%",size:"mini","show-overflow":"","highlight-hover-row":"","highlight-current-row":"","row-config":e.rowConfig,"auto-resize":!0,border:"none","checkbox-config":{checkStrictly:!1,showHeader:!0},"tree-config":e.treeConfig,"show-header":!1,"scroll-y":{enabled:!0,gt:0},data:e.treeData},on:{"cell-click":e.onCellClick}},[t("vxe-table-column",{attrs:{width:"100%",field:"id"},scopedSlots:e._u([{key:"default",fn:function(i){var n=i.row;return[t("div",{style:{paddingLeft:e.getIndent(n)+"px"},on:{contextmenu:function(e){e.preventDefault()}}},[n.deviceid?t("span",{staticStyle:{padding:"0px 7.5px"}}):t("span",{staticStyle:{position:"relative",top:"1.5px","padding-right":"3px"},on:{dblclick:function(e){e.stopPropagation()},click:function(t){return t.stopPropagation(),e.onExpandNode(n)}}},[(0==n.children.length?n.expand:e.$refs.xTable.isTreeExpandByRow(n))?t("img",{attrs:{src:e.bihe,width:"12",height:"12"}}):t("img",{attrs:{src:e.zhankai,width:"12",height:"12"}})]),n.deviceid?t("span",[t("el-radio",{staticStyle:{margin:"0px 3px 0px 2px"},attrs:{label:n.id},model:{value:e.radio,callback:function(t){e.radio=t},expression:"radio"}})],1):e._e(),"user"==n.nodeType?t("img",{staticStyle:{width:"16px",height:"16px",border:"0px",position:"relative",top:"3.5px"},attrs:{src:n.icon}}):e._e(),"group"==n.nodeType?t("img",{staticStyle:{width:"15px",height:"14px",border:"0px",position:"relative",top:"2.5px"},attrs:{src:n.icon}}):e._e(),"videod"==n.nodeType||"normald"==n.nodeType?t("img",{staticStyle:{width:"16px",height:"16px",border:"0px",position:"relative",top:"3.5px"},attrs:{src:e.getDeviceIcon(n)}}):e._e(),t("span",{staticStyle:{"padding-left":"2px"},domProps:{textContent:e._s(n.name)}}),n.deviceid?t("span",{directives:[{name:"show",rawName:"v-show",value:e.getTreeDeviceState(n),expression:"getTreeDeviceState(row)"}]},[e._v(" ["+e._s(e.getTreeDeviceState(n))+"]")]):t("span",[e._v("("+e._s(n.showCount)+"/"+e._s(n.allCount)+")")])])]}}])})],1)],1)])])]),t("div",{staticClass:"edit-device-right"},[t("div",{staticClass:"edit-device-inner full"},[t("div",{staticClass:"edit-device-inner-title"},[t("i",{staticClass:"circle"}),t("b",{domProps:{textContent:e._s(e.$t("bgManage.editDevice"))}}),t("span",{domProps:{textContent:e._s(e.$t("missing.editDeviceHere"))}})]),t("div",{staticClass:"edit-device-inner-content"},[t("div",{staticClass:"full",staticStyle:{overflow:"hidden"}},[t("div",{staticClass:"device"},[t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("alarm.devNum")}},[t("el-input",{attrs:{clearable:"",disabled:""},model:{value:e.baseInfo.deviceid,callback:function(t){e.$set(e.baseInfo,"deviceid",t)},expression:"baseInfo.deviceid"}})],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("reportForm.deviceType")}},[t("el-select",{staticClass:"right_icon_none",staticStyle:{width:"100%"},attrs:{filterable:"",disabled:"","filter-method":e.deviceTypeFilterMethod},model:{value:e.baseInfo.devicetype,callback:function(t){e.$set(e.baseInfo,"devicetype",t)},expression:"baseInfo.devicetype"}},e._l(e.deviceTypes,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("alarm.devName")}},[t("el-input",{attrs:{clearable:"",placeholder:e.$t("tips.inputDevicename")},model:{value:e.baseInfo.devicename,callback:function(t){e.$set(e.baseInfo,"devicename",t)},expression:"baseInfo.devicename"}})],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("bgManage.simNum")}},[t("el-input",{attrs:{clearable:"",disabled:e.isDisableSim,placeholder:e.$t("tips.inputPhoneNumber")},model:{value:e.baseInfo.simnum,callback:function(t){e.$set(e.baseInfo,"simnum",t)},expression:"baseInfo.simnum"}})],1)],1),t("div",{staticClass:"margin_b10"},[t("LabelWrap",{attrs:{label:e.$t("reportForm.remarks")}},[e.userType<2?t("el-input",{attrs:{clearable:""},model:{value:e.baseInfo.remark,callback:function(t){e.$set(e.baseInfo,"remark",t)},expression:"baseInfo.remark"}}):t("el-input",{attrs:{clearable:""},model:{value:e.baseInfo.remark2,callback:function(t){e.$set(e.baseInfo,"remark2",t)},expression:"baseInfo.remark2"}})],1)],1),t("div",{staticStyle:{"text-align":"center","padding-top":"30px"}},[t("el-button",{staticStyle:{width:"120px"},attrs:{type:"primary",loading:e.loading,disabled:void 0==e.baseInfo.deviceid},on:{click:e.handleClickEdit}},[e._v(e._s(e.$t("common.edit")))])],1)])])])])])])},a=[],r=i("5530"),o=(i("99af"),i("4de4"),i("caad"),i("c975"),i("14d9"),i("4e82"),i("a9e3"),i("dca8"),i("d3b7"),i("2532"),i("159b"),i("4795"),i("c276")),s=i("2ef0"),l=i.n(s),d=i("6e52"),c=i("c7bc"),u=i("0139"),v=i("2f62"),h=i("7cf8"),p=i("e285"),f=i("6406"),m=i("0d33"),b=i("7fa8"),g=i("0d27"),x=i("8130"),C={name:"editDevice",data:function(){return{zhankai:g,bihe:x,loading:!1,tLoading:!1,baseInfo:{},searchText:"",deviceTypes:[],rowConfig:{height:24,useKey:"id",keyField:"id"},treeConfig:{transform:!0,showLine:!0,rowField:"id",parentField:"parentId"},treeData:[],radio:""}},computed:Object(r["a"])(Object(r["a"])({},Object(v["b"])(["isZh","userName","userType","userLevelList","isQueryInitData","userType","deviceTypeList","permissionList"])),{},{isDisableSim:function(){return!this.permissionList.includes("monitor-editdevice-editsim")}}),watch:{searchText:function(e){this.searchZtree(this,e)},isQueryInitData:function(e){e&&this.init()}},components:{DropdownZtreeUser:c["a"],LabelWrap:u["a"]},methods:Object(r["a"])(Object(r["a"])({},Object(v["c"])(["setIsReloadRootuser"])),{},{deviceTypeFilterMethod:o["j"],onCellClick:function(e){var t=e.row;t.nodeType==d["a"].NodeType_User||t.nodeType==d["a"].NodeType_Group?this.onExpandNode(t):t.nodeType!=d["a"].NodeType_Device_Normal&&t.nodeType!=d["a"].NodeType_Device_Video||(t.checked=!0,this.radio=t.id,this.onTreeCheck(t))},onExpandNode:function(e){var t=this.$refs.xTable,i=null;0==e.children.length?(i=!e.expand,e.expand=i):i=!t.isTreeExpandByRow(e),t.setTreeExpand(e,i)},getIndent:function(e){var t=18;return(e.level-1)*t},searchZtree:l.a.debounce((function(e,t){var i=e.$refs.xTable;if(0==t.length){var n=Object(f["h"])(e.treeNodes);e.treeData=n,i.reloadData(n)}else{e.expandIds={};var a=e.variableDeepSearch(e.treeNodes,t,0),r=Object(f["h"])(a);r.forEach((function(e){return e.checked=!1})),e.treeData=r,i.reloadData(r);var o=e.treeData.filter((function(t){return e.expandIds[t.id]}));setTimeout((function(){i.setTreeExpand(o,!0)}),100)}}),300),onTreeCheck:function(e){var t=this;e.deviceid&&Object(h["J"])(e.deviceid).then((function(e){var i=e.device;i&&(t.baseInfo=i,t.oldcreater=i.creater,t.oldgroupid=i.groupid)}))},handleClickEdit:function(){var e=this,t=this.baseInfo;this.loading=!0,t.needalarm=-1,Object(p["P"])(t).then((function(i){var n=i.status;if(e.loading=!1,0==n){var a=d["a"].deviceInfos[t.deviceid],r=a.devicename;Object.assign(a,t),r!=t.devicename&&e.updateNode(a),e.$XModal.message({message:e.$t("tips.editSucc"),status:"success",zIndex:9999})}else 91==n?e.$XModal.message({message:e.$t("tips.noPermission"),status:"error",zIndex:9999}):e.$XModal.message({message:e.$t("tips.editFail"),status:"error",zIndex:9999})}))},updateNode:function(e){for(var t=e.deviceid,i=Object(f["d"])(t),n=this.treeData,a=0;a<n.length;a++){var r=n[a];if(r.id==i){r.name=e.devicename;break}}},refreshZtree:function(){var e=this;this.tLoading=!0,this.treeData=[],setTimeout((function(){e.initZtree()}),60)},initZtree:function(){Date.now();var e=this.castUsersTreeToDevicesTree(d["a"].rootuser);this.treeData=Object(f["h"])(e),this.tLoading=!1,this.treeNodes=e},variableDeepSearch:function(e,t){t=t.toLowerCase();for(var i=[],n=this,a=0;a<e.length;a++){var r=null,o=e[a];if(null!=o){var s=!1;if((-1!=o.name.toLowerCase().indexOf(t)||o.username&&-1!=o.username.toLowerCase().indexOf(t)||o.deviceid&&-1!=o.deviceid.toLowerCase().indexOf(t))&&(r=l.a.cloneDeep(o),r.open=!1,s=!0),0==s){var c=d["a"].pinyinMap[o.name];(c&&-1!=c.l.toLowerCase().indexOf(t)||c&&-1!=c.p.toLowerCase().indexOf(t))&&(r=l.a.cloneDeep(o),s=!0)}if(0==s&&o.children&&o.children.length>0){var u=n.variableDeepSearch(o.children,t);u&&u.length>0&&(r=l.a.cloneDeep(o),r.children=u,r.open=!0,s=!0)}1==s&&(n.expandIds[r.parentId]=!0,i.push(r))}}return i},selectedRoot:function(e){this.radio=e},castUsersTreeToDevicesTree:function(e){var t=this,i={name:"",children:[],open:!0,icon:m,nodeType:d["a"].NodeType_User,level:e.level,indeterminate:!1},n=0,a=0;if(e){var r=d["a"].lastPositions,s=e.username,l=e.subusers,c=e.groups;i.name=s,i.username=s,i.id=s,i.parentId=null;var u=s,v=Object(f["c"])(c),h=-1!=v?c[v]:null,p=this.getOtherAllGroups(u,c),g=null;if(null!=l&&l.length>0&&(g=this.doCastUsersTreeToAllDevicesTree(u,l),g.sort((function(e,t){return e.name.localeCompare(t.name,"zh-CN")}))),0==p.length&&null==g&&h&&h.devices.length){var x=void 0!=h.level?h.level:e.level+1;h.devices.forEach((function(e){var a=e.deviceid,o=r[a],s=o?o.online:0;s>0&&n++;var l=t.getMonitorDeviceNodeData(e,u,x);i.children.push(l)})),a+=h.devices.length,Object(o["Jb"])(i.children)}else{if(h&&h.devices.length){var C=this.$t("common.defaultGroup"),T=u+"-"+h.groupid,y={id:T,parentId:u,groupid:h.groupid,name:C,icon:b,username:u,nodeType:d["a"].NodeType_Group,children:[],level:h.level,showCount:0};h.devices.forEach((function(e){var i=e.deviceid,n=r[i],a=n?n.online:0;a>0&&y.showCount++,e.username=u;var o=t.getMonitorDeviceNodeData(e,T);y.children.push(o)})),Object(o["Jb"])(y.children),y.allCount=h.devices.length,i.children.push(y)}if(p.length&&(i.children=i.children.concat(p)),g&&(i.children=i.children.concat(g)),i.children)for(var w=0;w<i.children.length;++w){var D=i.children[w];void 0!=D.allCount&&(a+=D.allCount,n+=D.showCount)}}}return i.showCount=n,i.allCount=a,i.children},doCastUsersTreeToAllDevicesTree:function(e,t){var i=this,n=[],a=d["a"].lastPositions;if(null!=t&&t.length>0)for(var r=function(){var r=t[s],l=r.username,c=r.subusers,u=r.showname,v=r.groups,h=0,p={parentId:e,id:l,name:u||l,username:l,showname:u,icon:m,nodeType:d["a"].NodeType_User,children:[],level:r.level,indeterminate:!1},g=Object(f["c"])(v),x=-1!=g?v[g]:null,C=i.getOtherAllGroups(l,v),T=null;null!=c&&c.length>0&&(T=i.doCastUsersTreeToAllDevicesTree(l,c),T.sort((function(e,t){return e.name.localeCompare(t.name,"zh-CN")})));var y=0;if(0==C.length&&null==T&&null!=x&&x.devices.length){var w=void 0!=x.level?x.level:r.level+1;x.devices.forEach((function(e){y++;var t=e.deviceid,n=a[t],r=n?n.online:0;r>0&&h++,e.username=l;var o=i.getMonitorDeviceNodeData(e,l,w);p.children.push(o)})),Object(o["Jb"])(p.children)}else{if(x&&x.devices.length){var D=i.$t("common.defaultGroup"),I=l+"-"+x.groupid,_={id:I,parentId:l,groupid:x.groupid,name:D,icon:b,username:l,nodeType:d["a"].NodeType_Group,shared:x.shared,children:[],level:x.level,showCount:0,indeterminate:!1};x.devices.forEach((function(t){var n=t.deviceid,r=a[n],o=r?r.online:0;o>0&&_.showCount++,t.username=e;var s=i.getMonitorDeviceNodeData(t,I);_.children.push(s)})),_.allCount=x.devices.length,Object(o["Jb"])(_.children),p.children.push(_)}C.length&&(p.children=p.children.concat(C)),T&&(p.children=p.children.concat(T))}if(p.children)for(var k=0;k<p.children.length;++k){var N=p.children[k];void 0!=N.allCount&&(y+=N.allCount,h+=N.showCount)}p.showCount=h,p.allCount=y,n.push(p)},s=0;s<t.length;++s)r();return n},getOtherAllGroups:function(e,t){var i=this,n=[],a=d["a"].lastPositions;if(t){for(var r,s,l=function(){if(r=t[c],s=r.groupid>0,s){var l=r.groupname,u=e+"-"+r.groupid,v={id:u,parentId:e,groupid:r.groupid,name:l,groupname:l,icon:b,username:e,nodeType:d["a"].NodeType_Group,shared:r.shared,level:r.level,indeterminate:!1,checked:!1},h=0;r.devices&&(v.children=[],r.devices.forEach((function(t){var n=t.deviceid,r=a[n],o=r?r.online:0;o>0&&h++,t.username=e;var s=i.getMonitorDeviceNodeData(t,u);v.children.push(s)})),Object(o["Jb"])(v.children)),v.showCount=h,v.allCount=r.devices.length,n.push(v)}},c=0;c<t.length;++c)l();n.sort((function(e,t){return e.name.localeCompare(t.name,"zh-CN")}))}return n},getUserOptions:function(e,t){var i=[],n=!1;return this.userLevelList.forEach((function(a){var r=a.name,o=a.type;0==n&&t&&e==o&&(i.push({label:r,value:Number(o)}),n=!0),o>e&&o<=11&&i.push({label:r,value:Number(o)})})),i},init:function(){var e=this;this.$nextTick((function(){e.deviceTypes=e.deviceTypeList,e.tLoading=!0,setTimeout((function(){e.initZtree()}),60)}))},getMonitorDeviceNodeData:function(e,t,i){var n=e.hasFunctions.isHasVideo,a=e.devicename,r=e.deviceid,o={deviceid:r,id:Object(f["d"])(r),parentId:t,name:a||r,nodeType:n?d["a"].NodeType_Device_Video:d["a"].NodeType_Device_Normal,level:void 0!=i?i:e.level,checked:!1};return Object.freeze(o)},getDeviceIcon:function(e){var t=e.deviceid,i=d["a"].deviceInfos[t],n=d["a"].lastPositions[t],a=n?n.online:0,r=Object(o["r"])(n,i,a);return r},getTreeDeviceState:function(e){var t=e.deviceid,i=d["a"].deviceInfos[t],n=d["a"].lastPositions[t],a=n?n.online:0,r=Date.now();return Object(o["gb"])(i,a,n,r)}}),created:function(){this.treeId=null,this.oilCreater=null,this.groupname="",this.groupid=""},mounted:function(){this.isQueryInitData&&this.init()},destroyed:function(){this.treeNodes=null,this.treeData=null}},T=C,y=(i("fc30"),i("2877")),w=Object(y["a"])(T,n,a,!1,null,null,null),D=w.exports;t["default"]=D},b912:function(e,t,i){},fc30:function(e,t,i){"use strict";i("b912")}}]);