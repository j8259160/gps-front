(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-896c183c"],{"3b13":function(t,e,n){},"6b2a":function(t,e,n){"use strict";n("b689")},7031:function(t,e,n){"use strict";n("3b13")},"72ee":function(t,e,n){"use strict";n("bab3")},b689:function(t,e,n){},bab3:function(t,e,n){},c9b7:function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"report-form full"},[e("div",{staticClass:"report-form-inner"},[e("div",{staticClass:"report-form-inner-header",staticStyle:{height:"35px"}},[e("div",{staticClass:"f_left"},[e("MultiChoiceVehicle",{on:{onSelectDevice:t.onSelectDevice}})],1),e("div",{staticClass:"f_left"},[e("SelectDate",{attrs:{dateType:"month"},model:{value:t.month,callback:function(e){t.month=e},expression:"month"}})],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{loading:t.loading,type:"primary"},on:{click:t.handleQuery}},[t._v(t._s(t.$t("common.query")))])],1),e("div",{staticClass:"f_left"},[e("el-button",{attrs:{type:"primary",loading:t.exportLoading1},on:{click:t.exportData}},[t._v(t._s(t.$t("common.export")))])],1)]),e("div",{staticClass:"report-form-inner-content",staticStyle:{top:"39px"}},[e("vxe-table",{attrs:{"sort-config":t.sortConfig,"menu-config":t.tableMenu,border:"",resizable:"","auto-resize":"","show-overflow":"","highlight-hover-row":"",size:"mini",height:"auto",data:t.totalList},on:{"menu-click":t.handleClickTableMenu}},[e("vxe-table-column",{attrs:{type:"seq",width:"60",title:t.$t("reportForm.index"),fixed:"left"}}),e("vxe-table-column",{attrs:{field:"devicename",title:t.$t("alarm.devName"),sortable:""}}),e("vxe-table-column",{attrs:{field:"deviceid",title:t.$t("alarm.devNum"),sortable:""}}),e("vxe-table-column",{attrs:{field:"onlineDayAanTotalDay",title:t.$t("reportForm.onlineDayAanTotalDay"),sortable:""}}),e("vxe-table-column",{attrs:{field:"onlineRate",title:t.$t("reportForm.onlineRate"),sortable:""}}),e("vxe-table-column",{attrs:{title:t.$t("reportForm.onlineDate")},scopedSlots:t._u([{key:"default",fn:function(n){return[e("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(e){return t.handleClickRow(n.row)}}},[t._v(t._s(t.$t("reportForm.details")))])]}}])})],1)],1),e("OnlineDate",{ref:"onlineDate",on:{queryOnlineMonth:t.queryOnlineMonth},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}})],1)])},a=[],o=(n("99af"),n("14d9"),n("4e82"),n("b680"),n("d3b7"),n("159b"),n("5101")),s=n("e561"),r=n("d462"),l=function(){var t=this,e=t._self._c;return e("vxe-modal",{attrs:{title:t.title,className:"modal-padding0",value:t.value,width:"420px"},on:{hide:t.handleClose,close:t.handleClose}},[e("div",{staticClass:"online-date"},[e("div",{staticClass:"online-date-header"},[e("div",{staticStyle:{width:"40%","line-height":"30px"}},[t._v(t._s(t.year)+t._s(t.$t("monitor.year"))+t._s(t.month)+t._s(t.$t("monitor.month")))]),e("div",{staticStyle:{width:"60%","text-align":"right"}},[e("el-button-group",[e("el-button",{attrs:{size:"mini"},on:{click:t.prveMonth}},[t._v(t._s(t.$t("monitor.prevMonth")))]),e("el-button",{attrs:{size:"mini"},on:{click:t.toDay}},[t._v(t._s(t.$t("el.datepicker.today")))]),e("el-button",{attrs:{size:"mini"},on:{click:t.nextMonth}},[t._v(t._s(t.$t("el.datepicker.nextMonth")))])],1)],1)]),e("div",{staticClass:"online-date-week"},t._l(t.weeks,(function(n,i){return e("div",{key:i},[t._v(t._s(n))])})),0),e("div",{staticClass:"online-date-dates"},t._l(t.datesArr,(function(n,i){return e("div",{key:i,class:{"active-day":n.isTheMonth,"no-current-month":!n.isTheMonth}},[e("div",{staticClass:"calendar-body-dates-date",domProps:{textContent:t._s(n.day)}}),e("div",{style:{color:n.color},domProps:{textContent:t._s(n.mileage)}})])})),0),e("div",{staticClass:"online-date-footer"},[e("div",[e("span",{domProps:{textContent:t._s(t.$t("reportForm.onlineDayAanTotalDay"))}}),t._v(" : "),e("span",{domProps:{textContent:t._s(t.onlineDayAanTotalDay)}})]),e("div",[e("span",{domProps:{textContent:t._s(t.$t("reportForm.onlineRate"))}}),t._v(" : "),e("span",{domProps:{textContent:t._s(t.onlineRate)}})])])])])},h=[],c=n("5530"),d=(n("3c65"),n("2f62")),u=n("6e52"),m={name:"OnlineDate",props:{value:{type:Boolean,default:!1}},data:function(){return{title:"",year:"",month:"",date:"",weeks:[this.$t("el.datepicker.weeks.mon"),this.$t("el.datepicker.weeks.tue"),this.$t("el.datepicker.weeks.wed"),this.$t("el.datepicker.weeks.thu"),this.$t("el.datepicker.weeks.fri"),this.$t("el.datepicker.weeks.sat"),this.$t("el.datepicker.weeks.sun")],datesArr:[],currentDate:o["a"].format(new Date,"yyyy-MM-dd"),onlineDayAanTotalDay:"",onlineRate:""}},watch:{value:function(t){}},computed:Object(c["a"])({},Object(d["b"])(["isZh"])),methods:{updateOnlineStatus:function(t,e,n,i,a){this.deviceid=t,this.dateStr=e,this.daysStatus=n,this.onlineDayAanTotalDay=i,this.onlineRate=a,this.setTheDate(e),this.title=this.$t("reportForm.onlineDate")+" - "+u["a"].getDeviceNameByDeviceId(t)},handleClose:function(){this.$emit("input",!1)},prveMonth:function(){var t=o["a"].reduceMonth(new Date(this.year,this.month-1,1),1);this.setTheDate(o["a"].format(t,"yyyy-MM-dd"));var e="".concat(this.year,"-").concat(this.month,"-").concat(this.date),n={deviceids:[this.deviceid],offset:o["a"].getOffset(),year:this.year,month:this.month,dateStr:e};this.$emit("queryOnlineMonth",n)},toDay:function(){var t=o["a"].format(new Date,"yyyy-MM-dd"),e=t.split("-")[0],n=t.split("-")[1],i={deviceids:[this.deviceid],offset:o["a"].getOffset(),year:e,month:n,dateStr:t};this.$emit("queryOnlineMonth",i)},nextMonth:function(){var t=o["a"].addMonth(new Date(this.year,this.month-1,1),1);if(!(this.currentDate<o["a"].format(t,"yyyy-MM-dd"))){this.setTheDate(o["a"].format(t,"yyyy-MM-dd"));var e="".concat(this.year,"-").concat(this.month,"-").concat(this.date),n={deviceids:[this.deviceid],offset:o["a"].getOffset(),year:this.year,month:this.month,dateStr:e};this.$emit("queryOnlineMonth",n)}},getTheMonthFirstDayWeek:function(){return new Date(this.year,this.month-1,1).getDay()},getTheMonthDays:function(){var t=12==this.month?this.year+1:this.year,e=12==this.month?1:this.month;return new Date(new Date(t,e,1)-1).getDate()},getPrevMonthLastDate:function(){return new Date(new Date(this.year,this.month-1,1)-1).getDate()},setTheDate:function(t){var e=t.split("-");this.year=e[0],this.month=e[1],this.date=e[2],this.datesArr=this.getDatesArr()},getDatesArr:function(){var t=[],e=this.getTheMonthFirstDayWeek(),n=this.getPrevMonthLastDate(),i=o["a"].format(new Date(new Date(this.year,this.month-2,1)),"yyyy-MM"),a=o["a"].format(new Date(new Date(this.year,this.month,1)),"yyyy-MM"),s=this.getTheMonthDays();while(e--)t.unshift({dateStr:i+"-"+(n>9?n:"0"+n),day:n--,isTheMonth:!1,isPrevMonth:!0,isNextMonth:!1,mileage:"-"});var r=1,l=this.month,h=this.daysStatus;while(s--){var c=h[r-1],d=!!c,u=this.year+"-"+l+"-"+(r<10?"0"+r:r),m="",v="";void 0===c?(m="-",v="#606266"):(m=d?this.$t("monitor.online"):this.$t("monitor.offline"),v=d?"#409EFF":"#e4393c"),t.push({day:r,isTheMonth:!0,mileage:m,dateStr:u,isOnline:d,color:v}),r++}var y=1;while(t.length<42){u=a+"-"+(y<10?"0"+y:y);t.push({day:y++,isTheMonth:!1,mileage:"-",dateStr:u,isNextMonth:!0,isPrevMonth:!1})}return t}},mounted:function(){}},v=m,y=(n("6b2a"),n("2877")),f=Object(y["a"])(v,l,h,!1,null,"cdf61a34",null),p=f.exports,D=n("1c31"),g=n("a05b"),M={name:"vehicleMonthOnline",data:function(){return{show:!1,loading:!1,exportLoading1:!1,month:new Date,totalList:[],dayList:[],sortConfig:{sortMethod:function(t){var e=t.data,n=t.sortList,i=n[0],a=i.property,o=i.order,s=[];return s="onlineDayAanTotalDay"==a||"onlineRate"==a?"desc"===o?e.sort((function(t,e){return e.onlineCount-t.onlineCount})):"asc"===o?e.sort((function(t,e){return t.onlineCount-e.onlineCount})):e.sort():"desc"===o?e.sort((function(t,e){var n=e[a]+"";return n.localeCompare(t[a])})):"asc"===o?e.sort((function(t,e){var n=t[a]+"";return n.localeCompare(e[a])})):e.sort(),s}}}},mixins:[g["a"]],components:{MultiChoiceVehicle:s["a"],SelectDate:r["a"],OnlineDate:p},watch:{month:function(t){this.dayList=this.getDayList(),this.loading||this.handleQuery()}},methods:{onSelectDevice:function(t){this.deviceids=t},handleClickRow:function(t){this.$refs.onlineDate.updateOnlineStatus(t.deviceid,t.yearMonth,t.daysstatus,t.onlineDayAanTotalDay,t.onlineRate),this.show=!0},queryOnlineMonth:function(t){var e=this;Object(D["J"])(t).then((function(n){var i=n.records;if(i&&i.length>0){var a=i[0].deviceid,o=i[0].daysstatus,s=0;o.forEach((function(t){1==t&&s++}));var r=s+"/"+o.length,l=(s/o.length*100).toFixed(2)+"%";e.$refs.onlineDate.updateOnlineStatus(a,t.dateStr,o,r,l)}}))},handleQuery:function(){var t=this,e=this.deviceids;if(0!=e.length){var n={deviceids:e,offset:o["a"].getOffset(),year:this.month.getFullYear(),month:this.month.getMonth()+1};this.queryDetailDateRange="".concat(n.year,"-").concat(n.month),this.loading=!0,Object(D["J"])(n).then((function(e){var n=e.records;t.loading=!1;var i=[];n&&(i=t.getTableData(n,t.month.getFullYear()+"-"+(t.month.getMonth()+1<10?"0"+(t.month.getMonth()+1):t.month.getMonth()+1)+"-01")),t.totalList=i}))}else this.$XModal.message({message:this.$t("tips.selectTime"),status:"error",zIndex:9999})},getTableData:function(t,e){var n=[];return t.forEach((function(t){var i=t.deviceid,a=u["a"].deviceInfos[i].devicename,o=t.daysstatus,s={deviceid:i,devicename:a,daysstatus:o},r=0;o.forEach((function(t){1==t&&r++})),s.onlineDayAanTotalDay=r+"/"+o.length;var l=r/o.length*100;s["onlineRate"]=l.toFixed(2)+"%",s.yearMonth=e,s.onlineCount=r,n.push(s)})),n},getTheMonthDays:function(t){var e=t.getFullYear(),n=t.getMonth()+1;return new Date(new Date(e,n,1)-1).getDate()},getDayList:function(){for(var t=[],e=this.getTheMonthDays(this.month),n=1;n<=e;n++)t.push({label:String(n),value:"day".concat(n)});return t},exportData:function(){if(0!=this.totalList.length){var t=[[this.$t("reportForm.index"),this.$t("alarm.devName"),this.$t("alarm.devNum"),this.$t("reportForm.onlineDayAanTotalDay"),this.$t("reportForm.onlineRate")]];this.totalList.forEach((function(e,n){var i=[];i.push(n+1),i.push(e.devicename),i.push(e.deviceid),i.push(e.onlineDayAanTotalDay),i.push(e.onlineRate),t.push(i)}));var e={title:this.$t("reportForm.vehicleMonthOnline"),data:t,dateRange:this.queryDetailDateRange};this.exportLoading1=!0,new ExcelCls(e).exportExcel(this)}}},mounted:function(){this.deviceids=[],this.dayList=this.getDayList(),this.queryDetailDateRange=null}},b=M,w=(n("72ee"),Object(y["a"])(b,i,a,!1,null,null,null)),x=w.exports;e["default"]=x},e561:function(t,e,n){"use strict";var i=n("ea22");e["a"]=i["a"]},ea22:function(t,e,n){"use strict";var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"multi-choice multi-choice-vehicle"},[e("div",{staticClass:"multi-choice-input"},[e("ZtreeDeviceDropdown",{ref:"ztreeDevice",attrs:{disableShare:t.disableShare,isCheck:"",placeholder:this.$t("tips.selectDevice"),isQueryInitData:t.isQueryInitData,selectDeviceIds:t.multipleDeviceids},on:{onTreeCheck:t.onTreeCheck}})],1)])},a=[],o=n("5530"),s=(n("4795"),n("2f62")),r=n("2df7"),l={name:"MultiChoiceVehicle",props:{disableShare:{type:Boolean,default:!1}},data:function(){return{}},computed:Object(o["a"])({},Object(s["b"])(["isQueryInitData","multipleDeviceids"])),components:{ZtreeDeviceDropdown:r["a"]},methods:Object(o["a"])(Object(o["a"])({},Object(s["c"])(["setMultipleDeviceids"])),{},{onTreeCheck:function(t){this.$emit("onSelectDevice",t),this.setMultipleDeviceids(t)},clearText:function(){var t=this;setTimeout((function(){t.$refs.ztreeDevice.clearText()}),300)}})},h=l,c=(n("7031"),n("2877")),d=Object(c["a"])(h,i,a,!1,null,null,null);e["a"]=d.exports}}]);