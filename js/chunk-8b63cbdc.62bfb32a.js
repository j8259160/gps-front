(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-8b63cbdc"],{"147b":function(e,t,n){},7082:function(e,t,n){"use strict";n("147b")},"7e15":function(e,t,n){"use strict";n("b0c0");var i=function(){var e=this,t=e._self._c;return t("div",{staticClass:"device-ztree-search full"},[t("div",{staticClass:"device-ztree-search-wrap"},[t("div",{staticClass:"device-ztree-search-wrap-input",style:{padding:"8px 48px 0px 10px"}},[t("div",[t("el-input",{staticStyle:{width:"100%",height:"32px"},attrs:{clearable:"",placeholder:e.$t("bgManage.pleaseEnterUsernameOrGroupnameOrDevice")},model:{value:e.searchText,callback:function(t){e.searchText=t},expression:"searchText"}},[t("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"prefix"},slot:"prefix"})])],1),t("div",{staticClass:"device-ztree-search-wrap-refresh",style:{right:"10px"},on:{click:e.refreshZtree}},[e.reloadLoading?t("i",{staticClass:"el-icon-loading",staticStyle:{"font-size":"18px"}}):t("i",{staticClass:"el-icon-refresh-right",staticStyle:{"font-size":"18px"}})])])]),t("div",{staticClass:"device-ztree-search-ztree drop-down-vxetree noselect"},[t("vxe-table",{ref:"xTable",staticClass:"mytree-scrollbar",attrs:{height:"100%",size:"mini",loading:e.loading,"show-overflow":"","highlight-hover-row":"","highlight-current-row":"","row-config":e.rowConfig,"auto-resize":!0,border:"none","checkbox-config":{checkStrictly:!1,showHeader:!0},"tree-config":e.treeConfig,"show-header":!1,"scroll-y":{enabled:!0,gt:0},data:e.treeData},on:{"cell-click":e.onCellClick}},[t("vxe-table-column",{attrs:{width:"100%",field:"id"},scopedSlots:e._u([{key:"default",fn:function(n){var i=n.row;return[t("div",{staticClass:"search-device-cell",style:{paddingLeft:e.getIndent(i)+"px"},on:{contextmenu:function(e){e.preventDefault()}}},["user"==i.info.nodeType||"group"==i.info.nodeType?t("span",{staticStyle:{position:"relative",top:"1.5px","padding-right":"3px"},on:{dblclick:function(e){e.stopPropagation()},click:function(t){return t.stopPropagation(),e.onExpandNode(i)}}},[(0==i.children.length?i.expand:e.$refs.xTable.isTreeExpandByRow(i))?t("img",{attrs:{src:e.bihe,width:"12",height:"12"}}):t("img",{attrs:{src:e.zhankai,width:"12",height:"12"}})]):t("span",{staticStyle:{padding:"0px 7.5px"}}),"user"==i.info.nodeType?t("img",{staticStyle:{width:"16px",height:"16px",border:"0px",position:"relative",top:"3.5px"},attrs:{src:i.info.icon}}):e._e(),"group"==i.info.nodeType?t("img",{staticStyle:{width:"15px",height:"14px",border:"0px",position:"relative",top:"2.5px","margin-right":"1px"},attrs:{src:i.info.icon}}):e._e(),"videod"==i.info.nodeType||"normald"==i.info.nodeType?t("img",{staticStyle:{width:"16px",height:"16px",border:"0px",position:"relative",top:"3.5px"},attrs:{src:e.getDeviceIcon(i)}}):e._e(),t("span",{on:{click:function(e){e.stopPropagation()}}},[t("el-checkbox",{staticStyle:{margin:"0px 3px 0px 2px"},attrs:{indeterminate:i.indeterminate},on:{change:function(t){return e.handleCheckboxChange(i)}},model:{value:i.checked,callback:function(t){e.$set(i,"checked",t)},expression:"row.checked"}})],1),t("span",{domProps:{textContent:e._s(i.name)}}),i.info.deviceid?t("span",{directives:[{name:"show",rawName:"v-show",value:e.getTreeDeviceState(i),expression:"getTreeDeviceState(row)"}]},[e._v(" ["+e._s(e.getTreeDeviceState(i))+"]")]):t("span",{attrs:{title:e.$t("monitor.online")+":"+i.showCount+"/"+e.$t("monitor.offline")+":"+i.offlineCount+"/"+e.$t("monitor.stock")+":"+i.notActiveCount+"/"+e.$t("missing.totalNumber")+":"+i.allCount}},[e._v("("+e._s(i.showCount)+"/"+e._s(i.offlineCount)+"/"+e._s(i.notActiveCount)+"/"+e._s(i.allCount)+")")])])]}}])})],1)],1)])},o=[],r=n("b85c"),a=n("5530"),c=(n("99af"),n("4de4"),n("caad"),n("c975"),n("14d9"),n("4e82"),n("dca8"),n("b64b"),n("d3b7"),n("2532"),n("498a"),n("159b"),n("4795"),n("2f62")),l=n("c276"),d=n("6406"),s=n("2ef0"),h=n("6e52"),u=n("5101"),f=n("b562"),v=n("0d33"),p=n("7fa8"),g=n("0d27"),m=n("8130"),C={name:"Temp",props:{showClear:{type:Boolean,default:!1}},data:function(){return{searchText:"",loading:!1,reloadLoading:!1,zhankai:g,bihe:m,rowConfig:{height:24,useKey:"id",keyField:"id"},treeConfig:{transform:!0,showLine:!0,rowField:"id",parentField:"parentId",lazy:!0,loadMethod:function(e){return console.log(e),[]}},treeData:[]}},watch:{isQueryInitData:function(e){var t=this;e&&(this.loading=!0,setTimeout((function(){t.loading=!1,t.initZtree()}),60))},searchText:function(e){this.searchZtree(this,e.trim())}},computed:Object(a["a"])({},Object(c["b"])(["isQueryInitData"])),methods:{onCellClick:function(e){var t=e.row,n=t.info.nodeType;n==h["a"].NodeType_User||n==h["a"].NodeType_Group?this.onExpandNode(t):n!=h["a"].NodeType_Device_Normal&&n!=h["a"].NodeType_Device_Video||(t.checked=!0,this.handleCheckboxChange(t))},handleCheckboxChange:function(e){this.$refs.xTable.updateData(),e.indeterminate=!1,e.children&&this.updateChildren(e,e.checked),this.updateParent(e),this.onTreeCheck(e)},updateChildren:function(e,t){var n=this;e.children.forEach((function(e){(e.checked!==t||e.indeterminate)&&(e.checked=t,e.indeterminate=!1,e.children&&n.updateChildren(e,t))}))},updateParent:function(e){var t=this.findParent(e);if(t){var n=t.children.every((function(e){return e.checked})),i=t.children.every((function(e){return!e.checked&&!e.indeterminate}));n?(t.checked=!0,t.indeterminate=!1):i?(t.checked=!1,t.indeterminate=!1):(t.checked=!1,t.indeterminate=!0),this.updateParent(t)}},findParent:function(e){var t,n=Object(r["a"])(this.treeData);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=this.findParentRecursive(i,e);if(o)return o}}catch(a){n.e(a)}finally{n.f()}return null},findParentRecursive:function(e,t){if(e.children&&e.children.includes(t))return e;if(e.children){var n,i=Object(r["a"])(e.children);try{for(i.s();!(n=i.n()).done;){var o=n.value,a=this.findParentRecursive(o,t);if(a)return a}}catch(c){i.e(c)}finally{i.f()}}return null},onExpandNode:function(e){var t=this.$refs.xTable,n=null;0==e.children.length?(n=!e.expand,e.expand=n):n=!t.isTreeExpandByRow(e),t.setTreeExpand(e,n)},getIndent:function(e){var t=e.info.level,n=17;return t*n},handleClear:function(){this.$parent.totalCount=0,this.$parent.tableList=[],this.$parent.totalList=[],this.$parent.cacheDeviceids=[]},checkAllNodes:function(e){this.selectedDeviceIds={},this.treeData.forEach((function(t){t.checked=e,t.indeterminate=!1}))},getDeviceIcon:function(e){var t=e.info.deviceid,n=h["a"].deviceInfos[t],i=h["a"].lastPositions[t],o=i?i.online:0,r=Object(l["r"])(i,n,o);return r},getTreeDeviceState:function(e){var t=e.info.deviceid,n=h["a"].deviceInfos[t],i=h["a"].lastPositions[t],o=i?i.online:0,r=Date.now();return Object(l["gb"])(n,o,i,r)},castUsersTreeToDevicesTree:function(e){var t=this,n={children:[],indeterminate:!1,checked:!1,name:"",info:{icon:v,nodeType:h["a"].NodeType_User,level:e.level}},i=0,o=0,r=0,a=0;if(e){var c=h["a"].lastPositions,s=e.username,u=e.subusers,f=e.groups;n.name=s,n.info.username=s,n.id=s,n.parentId=null;var g=s,m=Object(d["c"])(f),C=-1!=m?f[m]:null,b=this.getOtherAllGroups(g,f),x=null;if(null!=u&&u.length>0&&(x=this.doCastUsersTreeToAllDevicesTree(g,u),x.sort((function(e,t){return e.name.localeCompare(t.name,"zh-CN")}))),0==b.length&&null==x&&C&&C.devices.length){var T=void 0!=C.level?C.level:e.level+1;C.devices.forEach((function(e){var o=e.deviceid,l=c[o],d=l?l.online:0;d>0?i++:(l&&r++,0==e.firstloctime&&a++);var s=t.getMonitorDeviceNodeData(e,g,T);n.children.push(s)})),o+=C.devices.length,Object(l["Jb"])(n.children)}else{if(C&&C.devices.length){var D=this.$t("common.defaultGroup"),y=g+"-"+C.groupid,k=C.l,w=C.p,O={id:y,parentId:g,children:[],showCount:0,offlineCount:0,notActiveCount:0,checked:!1,name:D,info:{groupid:C.groupid,level:C.level,groupname:D,icon:p,username:g,nodeType:h["a"].NodeType_Group,l:k,p:w}};C.devices.forEach((function(e){var n=e.deviceid,i=c[n],o=i?i.online:0;o>0?O.showCount++:(i&&O.offlineCount++,0==e.firstloctime&&O.notActiveCount++),e.username=g;var r=t.getMonitorDeviceNodeData(e,y);O.children.push(r)})),Object(l["Jb"])(O.children),O.allCount=C.devices.length,n.children.push(O)}if(b.length&&(n.children=n.children.concat(b)),x&&(n.children=n.children.concat(x)),n.children)for(var N=0;N<n.children.length;++N){var I=n.children[N];void 0!=I.allCount&&(o+=I.allCount,i+=I.showCount,r+=I.offlineCount,a+=I.notActiveCount)}}}return n.showCount=i,n.allCount=o,n.offlineCount=r,n.notActiveCount=a,[n]},doCastUsersTreeToAllDevicesTree:function(e,t){var n=this,i=u["a"].getCurrentUTC(),o=[],r=h["a"].lastPositions;if(null!=t&&t.length>0)for(var a=function(){var a=t[c],s=a.username,u=a.subusers,f=a.showname,g=a.groups,m=0,C=0,b=0,x=f||s,T={parentId:e,id:s,children:[],indeterminate:!1,checked:!1,name:x,info:Object.freeze({username:s,showname:f,icon:v,nodeType:h["a"].NodeType_User,level:a.level})},D=Object(d["c"])(g),y=-1!=D?g[D]:null,k=n.getOtherAllGroups(s,g),w=null;null!=u&&u.length>0&&(w=n.doCastUsersTreeToAllDevicesTree(s,u),w.sort((function(e,t){return e.name.localeCompare(t.name,"zh-CN")})));var O=0;if(0==k.length&&null==w&&null!=y&&y.devices.length){var N=void 0!=y.level?y.level:a.level+1;y.devices.forEach((function(e){O++;var t=e.deviceid,o=r[t],a=Object(l["E"])(o,i);a>0?m++:(o&&C++,0==e.firstloctime&&b++);var c=n.getMonitorDeviceNodeData(e,s,N);T.children.push(c)})),Object(l["Jb"])(T.children)}else{if(y&&y.devices.length){var I=n.$t("common.defaultGroup"),_=s+"-"+y.groupid,j=y.l,E=y.p,$={id:_,parentId:s,name:I,info:Object.freeze({icon:p,groupid:y.groupid,username:s,nodeType:h["a"].NodeType_Group,l:j,p:E,level:y.level}),children:[],showCount:0,offlineCount:0,notActiveCount:0,indeterminate:!1,checked:!1};y.devices.forEach((function(t){var o=t.deviceid,a=r[o],c=Object(l["E"])(a,i);c>0?$.showCount++:(a&&$.offlineCount++,0==t.firstloctime&&$.notActiveCount++),t.username=e;var d=n.getMonitorDeviceNodeData(t,_);$.children.push(d)})),$.allCount=y.devices.length,Object(l["Jb"])($.children),T.children.push($)}k.length&&(T.children=T.children.concat(k)),w&&(T.children=T.children.concat(w))}if(T.children)for(var z=0;z<T.children.length;++z){var A=T.children[z];void 0!=A.allCount&&(O+=A.allCount,m+=A.showCount,C+=A.offlineCount,b+=A.notActiveCount)}T.showCount=m,T.allCount=O,T.offlineCount=C,T.notActiveCount=b,o.push(T)},c=0;c<t.length;++c)a();return o},getOtherAllGroups:function(e,t){var n=this,i=[],o=h["a"].lastPositions;if(t){for(var r,a,c=function(){if(r=t[d],a=r.groupid>0,a){var c=r.groupname,s=e+"-"+r.groupid,u={id:s,parentId:e,indeterminate:!1,checked:!1,name:c,info:Object.freeze({groupid:r.groupid,groupname:c,icon:p,username:e,nodeType:h["a"].NodeType_Group,shared:r.shared,level:r.level})},f=0,v=0,g=0;r.devices&&(u.children=[],r.devices.forEach((function(e){var t=e.deviceid,i=o[t],r=i?i.online:0;r>0?f++:(i&&v++,0==e.firstloctime&&g++);var a=n.getMonitorDeviceNodeData(e,s);u.children.push(a)})),Object(l["Jb"])(u.children)),u.showCount=f,u.offlineCount=v,u.notActiveCount=g,u.allCount=r.devices.length,i.push(u)}},d=0;d<t.length;++d)c();i.sort((function(e,t){return e.name.localeCompare(t.name,"zh-CN")}))}return i},getMonitorDeviceNodeData:function(e,t,n){var i=e.devicename,o=e.deviceid,r=e.hasFunctions.isHasVideo,a={id:Object(d["d"])(o),parentId:t,checked:!1,name:i||o,info:Object.freeze({deviceid:o,nodeType:r?h["a"].NodeType_Device_Video:h["a"].NodeType_Device_Normal,level:void 0!=n?n:e.level})};return a},refreshZtree:function(){var e=this;0==this.reloadLoading&&(this.reloadLoading=!0,Object(f["S"])().then((function(t){var n=t.rootuser;e.reloadLoading=!1,h["a"].deviceInfos={},h["a"].rootuser=n,h["a"].setDeviceInfos(n),e.$refs.xTable.setAllTreeExpand(!1),e.initZtree(),e.searchText="",e.selectedDeviceIds={},e.handleClear(),e.$emit("onTreeCheck",[])})).catch((function(t){e.reloadLoading=!1})))},updateZtreeIns:function(){this.initZtree()},updateNodes:function(e){var t=h["a"].deviceInfos,n=this.treeData;e.forEach((function(e){for(var i=0;i<n.length;i++){var o=n[i];if(o.info.deviceid==e){var r=t[e];o.name=r.devicename;break}}}))},initZtree:function(){this.selectedDeviceIds={};var e=this.castUsersTreeToDevicesTree(h["a"].rootuser);this.treeNodes=e;var t=Object(d["h"])(e);this.treeData=t,this.$refs.xTable.setTreeExpand(e[0],!0)},onTreeCheck:function(e){var t=this.selectedDeviceIds;Object(d["b"])(t,[e]),this.$emit("onTreeCheck",Object.keys(t)),e.info.nodeType!=h["a"].NodeType_Device_Video&&e.info.nodeType!=h["a"].NodeType_Device_Normal||this.$emit("onClickDevice",e)},cancelCheckNode:function(e){for(var t=this.treeData,n=0;n<t.length;n++){var i=t[n];i.id==e&&(i.checked=!1)}delete this.selectedDeviceIds[e]},selectedCheckNodes:function(e){var t=this;this.selectedDeviceIds={};var n=this.treeData;n.forEach((function(e){e.checked=!1})),e.forEach((function(e){t.selectedDeviceIds[e]=!0;for(var i=0;i<n.length;i++){var o=n[i];o.info.deviceid==e&&(o.checked=!0,t.updateParent(o))}})),this.$emit("onTreeCheck",e)},searchZtree:Object(s["debounce"])((function(e,t){var n=e.$refs.xTable;if(n.setAllTreeExpand(!1),0==t.length){var i=Object(d["h"])(e.treeNodes);e.treeData=i,setTimeout((function(){n.setTreeExpand(e.treeNodes[0],!0);var t=e.selectedDeviceIds;for(var o in t)for(var r=0;r<i.length;r++){var a=i[r];if(a.info.deviceid==o){a.checked=!0,e.updateParent(a);break}}}),30)}else{e.expandIds={};Date.now();var o=e.variableDeepSearch(e.treeNodes,t,0);Date.now(),e.treeData=Object(d["h"])(o);var r=e.treeData.filter((function(t){return e.expandIds[t.id]}));setTimeout((function(){n.setTreeExpand(r,!0),e.treeData.forEach((function(t){t.checked&&e.updateParent(t)}))}),30)}}),1e3),variableDeepSearch:function(e,t,n){t=t.toLowerCase();for(var i=[],o=this,r=this.selectedDeviceIds,a=0;a<e.length;a++){var c=null,l=e[a];if(null!=l){var d=!1;if((-1!=l.name.toLowerCase().indexOf(t)||l.info.username&&-1!=l.info.username.toLowerCase().indexOf(t)||l.info.deviceid&&-1!=l.info.deviceid.toLowerCase().indexOf(t))&&(c=Object(s["cloneDeep"])(l),d=!0),0==d){var u=h["a"].pinyinMap[l.name];(u&&-1!=u.l.toLowerCase().indexOf(t)||u&&-1!=u.p.toLowerCase().indexOf(t))&&(c=Object(s["cloneDeep"])(l),d=!0)}var f=l.info.deviceid;if(f){var v=h["a"].deviceInfos[f],p=v?v.simnum:null,g=v?v.simiccid:null;p&&-1!=p.indexOf(t)&&(c=Object(s["cloneDeep"])(l),d=!0),0==d&&g&&-1!=g.indexOf(t)&&(c=Object(s["cloneDeep"])(l),d=!0)}if(0==d&&l.children&&l.children.length>0){var m=o.variableDeepSearch(l.children,t);m&&m.length>0&&(c=Object(s["cloneDeep"])(l),c.children=m,d=!0)}if(1==d){var C=c.info.deviceid;if(void 0!=C&&1==r[C]&&(c.checked=!0),o.expandIds[c.parentId]=!0,i.push(c),n++,n>500)break}}}return i}},destroyed:function(){this.treeNodes=null,this.selectedDeviceIds=null,this.treeData=null},mounted:function(){var e=this;this.isQueryInitData&&(this.loading=!0,setTimeout((function(){e.loading=!1,e.initZtree()}),60))}},b=C,x=(n("7082"),n("2877")),T=Object(x["a"])(b,i,o,!1,null,null,null);t["a"]=T.exports}}]);