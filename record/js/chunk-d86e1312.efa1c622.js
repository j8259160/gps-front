(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-d86e1312"],{"3d56":function(t,e,a){"use strict";a("78ef")},"78ef":function(t,e,a){},a66c:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"full"},[a("page-frame",{ref:"pageFrame",attrs:{headerTitle:t.$t("record.parkingReport"),queryTime:t.queryTime,listLength:t.dataList.length,isCustomTime:"",isTime:"",showTempActions:""},on:{"select-day":t.onSelectTime,"on-download":t.onDownload}},[a("div",{staticClass:"data-list"},[0==t.dataList.length?a("div",{staticClass:"full",staticStyle:{"background-color":"#fff"}},[a("van-empty",{staticClass:"custom-image",attrs:{description:t.$t("tips.noData"),image:t.imageSrc}})],1):t._e(),t._l(t.dataList,(function(e,i){return[a("ParkingItemDetail",{attrs:{data:e},on:{handleClick:t.handleClick}})]}))],2)]),a("router-view")],1)},s=[],r=a("5530"),n=(a("5319"),a("ac1f"),a("159b"),a("2f62")),c=a("b562"),o=a("c276"),d=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"record-item",on:{click:t.handleClick}},[a("div",{staticClass:"record-item-title"},[a("div",{staticClass:"item-icon"},[a("img",{attrs:{src:t.data.imgSrc}})]),a("div",{staticClass:"item-title"},[a("div",{staticClass:"item-device-name"},[a("b",[t._v(t._s(t.data.devicename))])])])]),a("div",{staticClass:"record-item-content"},[a("div",[a("div",{staticClass:"ellipsis",staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.deviceId"))+": "+t._s(t.data.deviceid))]),a("div",{staticClass:"ellipsis",staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.creater"))+": "+t._s(t.data.creater))])]),a("div",[a("div",{staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.parkingCount"))+": "+t._s(t.data.records.length))]),a("div",{staticClass:"ellipsis",staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.parkingDuration"))+": "+t._s(t.data.totalParkTime))])])])])},l=[],u=a("ae60"),h={name:"ParkingItemDetail",components:{Icon:u["a"]},props:{data:{type:Object,default:function(){return{}}},textColor:{type:String,default:"#000000"}},data:function(){return{}},methods:{handleClick:function(){this.$emit("handleClick",this.data)}},computed:{textSty:function(){return{color:this.textColor}}}},m=h,p=(a("3d56"),a("2877")),f=Object(p["a"])(m,d,l,!1,null,null,null),v=f.exports,g=v,D=a("d503"),y=a("5101"),S={name:"TempStatistics",components:{PageFrame:D["a"],ParkingItemDetail:g},data:function(){return{imageSrc:a("6095"),queryTime:0,dataList:[]}},methods:Object(r["a"])({back:function(){this.$router.push("/home")},handleClick:function(t){console.log("detailList",t),this.setSelectedRecords(t),this.$router.push("/parkingreport/parkingdetail?queryTime=".concat(this.queryTime))},onSelectTime:function(t){if("number"==typeof t)this.queryTime=t,this.clearData(),this.queryTempAlarmRecord();else{this.queryTime=t.queryTime;var e=t.startDate,a=t.endDate;if(e.indexOf("/")>-1&&(e=e.replace("/","-"),e=e.replace("/","-"),a=a.replace("/","-"),a=a.replace("/","-")),t.isQuery)if(e<=a){this.clearData();var i={begintime:e,endtime:a,offset:y["a"].getOffset()};this.queryTempAlarmRecord(i)}else this.$toast(this.$t("tips.startDateAndEndDateTips"))}},clearData:function(){this.dataList=[],this.cacheList=[]},getStartAndEndDate:function(t){var e=864e5,a=y["a"].getOffset(),i=null;if(1==t){var s=y["a"].longToDateStr(Date.now()-e,a);i={begintime:s+" 00:00:00",endtime:s+" 23:59:59"}}else{0!=t&&(t-=1);var r=y["a"].longToDateStr(Date.now(),a);i={begintime:y["a"].longToDateStr(Date.now()-e*t,a)+" 00:00:00",endtime:r+" 23:59:59"}}return i.timezone=a,i},queryTempAlarmRecord:function(t){var e=this,a=null;a=t||this.getStartAndEndDate(this.queryTime),this.$store.commit("setQueryDetailDateRange",this.$t("record.startDate")+":"+a.begintime+" 00:00:00 "+this.$t("record.endDate")+":"+a.endtime+" 23:59:59"),a.deviceids=this.selectedList,a.interval=this.$refs.pageFrame.interval,a.needaddress=1,a.deviceids.length>0?Object(c["o"])(a).then((function(t){var a=t.status,i=t.records,s=t.addressmap;0===a?(e.addressmap=s,e.cacheList=e.getDataList(i),e.filterData()):e.clearData(),e.$toast.clear()})).catch((function(t){console.log(t),e.clearData(),e.$toast(e.$t("tips.networkError"))})):this.$toast(this.$t("record.selecteDevicetip"),{duration:1e4})},filterData:function(){this.dataList=this.cacheList},onDownload:function(t){var e=this;if(this.dataList.length>0){var a="zh"==this.$i18n.locale;this.$toast.loading({message:a?"下载中":"Downloading",forbidClick:!0});var i=[[this.$t("record.index"),this.$t("record.devicename"),this.$t("record.deviceid"),this.$t("record.date"),this.$t("record.time"),this.$t("record.parkingDuration"),this.$t("record.outDistance"),this.$t("record.area"),this.$t("record.address")]];if(this.dataList.forEach((function(t){var a=t.devicename,s=t.deviceid,r=t.records;if(r&&r.length){var n=0,c=0;r.forEach((function(t,e){var r=[];n+=t.parktime,c+=t.outdistance,r.push(e+1),r.push(a),r.push(s),r.push(t.dateStr),r.push(t.starttimeStr+"~"+t.endtimeStr),r.push(t.parktimeStr),r.push(t.outdistanceStr),r.push(t.region?t.region:""),r.push(t.address),i.push(r)}));var d=[];d.push(""),d.push(""),d.push(""),d.push(""),d.push(""),d.push(Object(o["r"])(n,e)),d.push(Object(o["b"])(c/1e3)),d.push(""),d.push(""),i.push(d);d=[];d.push(""),d.push(""),d.push(""),d.push(""),d.push(""),d.push(""),d.push(""),d.push(""),d.push(""),i.push(d)}})),1==i.length){var s=[];s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),s.push(""),i.push(s)}var r={title:this.$t("record.parkingReport"),data:i,dateRange:this.queryDetailDateRange};new ExcelCls(r).exportExcel(t)}},getDataList:function(t){var e=this,a=[],i={};return t.forEach((function(t){var s=t.deviceid,r=t.days,n=e.deviceNames[s],c=n.devicename,d=n.creater,l=0,u=[];r.forEach((function(t){var a=t.records;a.forEach((function(t){var a=t.endtime-t.starttime;l+=a,t.outdistanceStr=Object(o["b"])(t.outdistance),t.parktimeStr=Object(o["r"])(a,e),t.parktime=a,t.durationidleStr=Object(o["r"])(t.durationidle,e),t.dateStr=y["a"].format(new Date(t.starttime),"yyyy-MM-dd"),t.starttimeStr=y["a"].format(new Date(t.starttime),"HH:mm:ss"),t.endtimeStr=y["a"].format(new Date(t.endtime),"HH:mm:ss"),t.address=Object(o["i"])(e.addressmap,t.callat,t.callon),u.push(t)}))})),a.push({devicename:c,deviceid:s,creater:d,totalParkTime:Object(o["r"])(l,e),records:u,imgSrc:Object(o["h"])(e.lastPositon[s])}),i[s]=t.records})),this.globalRecords=i,a},getAddress:function(t){var e=[];return t.forEach((function(t){e.push({lon:t.slon,lat:t.slat})})),Object(c["b"])(e)}},Object(n["d"])(["setSelectedRecords"])),watch:{isShowAllData:function(){this.filterData()}},computed:Object(r["a"])({},Object(n["e"])(["groups","selectedList","deviceNames","lastPositon","isShowAllData","queryDetailDateRange"])),beforeDestroy:function(){this.$toast.clear()},mounted:function(){this.$store.commit("setQueryDetailDateRange",null),this.queryTempAlarmRecord()}},$=S,b=Object(p["a"])($,i,s,!1,null,null,null);e["default"]=b.exports}}]);