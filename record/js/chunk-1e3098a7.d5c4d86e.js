(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-1e3098a7"],{"137c":function(t,e,i){},"6f05":function(t,e,i){},7202:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"temp-statistics full"},[i("div",{staticClass:"temp-statistics-wrap full"},[i("page-frame",{ref:"pageFrame",attrs:{headerTitle:t.$t("record.tempStatistics"),queryTime:t.queryTime,listLength:t.dataList.length,isCustomTime:"",isTime:"",showTempActions:""},on:{"select-day":t.onSelectTime,"on-download":t.onDownload}},[i("div",{staticClass:"data-list"},[0==t.dataList.length?i("div",{staticClass:"full",staticStyle:{"background-color":"#fff"}},[i("van-empty",{staticClass:"custom-image",attrs:{description:t.$t("tips.noData"),image:t.imageSrc}})],1):t._e(),t._l(t.dataList,(function(e,a){return[i("TempStatisticsItem",{attrs:{data:e},nativeOn:{click:function(i){return t.handleClick(e.deviceid)}}})]}))],2)])],1),i("router-view")],1)},s=[],r=i("5530"),c=(i("8a79"),i("5319"),i("ac1f"),i("159b"),i("1276"),i("2f62")),n=i("b562"),o=i("c276"),d=i("d503"),l=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"record-item"},[i("div",{staticClass:"record-item-title"},[i("div",{staticClass:"item-icon"},[i("img",{attrs:{src:t.data.imgSrc}})]),i("div",{staticClass:"item-title"},[i("div",{staticClass:"item-device-name"},[i("b",[t._v(t._s(t.data.devicename))])])])]),i("div",{staticClass:"record-item-content"},[i("div",[i("div",{staticClass:"ellipsis",staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.deviceId"))+": "+t._s(t.data.deviceid))]),i("div",{staticClass:"ellipsis",staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.creater"))+": "+t._s(t.data.creater))])]),i("div",[i("div",{staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.reportStatistics"))+": "+t._s(t.data.count))]),t.data.realtimeTemp.isToDay?i("div",{staticClass:"ellipsis",staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.realtimeTemp"))+": "+t._s(t.data.realtimeTemp.realtimeTemp))]):i("div",{staticClass:"ellipsis",staticStyle:{width:"50%"},style:t.textSty},[t._v(t._s(t.$t("record.lastTemp"))+": "+t._s(t.data.realtimeTemp.realtimeTemp))])])])])},u=[],m=i("ae60"),h={name:"TempStatisticsItem",components:{Icon:m["a"]},props:{data:{type:Object,default:function(){return{}}},textColor:{type:String,default:"#000000"}},computed:{textSty:function(){return{color:this.textColor}}}},p=h,f=(i("8848"),i("2877")),v=Object(f["a"])(p,l,u,!1,null,null,null),g=v.exports,T=g,y=i("5101"),S={name:"TempStatistics",components:{PageFrame:d["a"],TempStatisticsItem:T},beforeRouteUpdate:function(t,e,i){if(i(),e.path.endsWith("/search")){var a=this.$route.query.updated;1==a&&this.queryTempAlarmRecord()}},data:function(){return{imageSrc:i("6095"),queryTime:0,dataList:[]}},methods:Object(r["a"])({back:function(){this.$router.push("/home")},onSelectTime:function(t){if("number"==typeof t)this.queryTime=t,this.clearData(),this.queryTempAlarmRecord();else{this.queryTime=t.queryTime;var e=t.startDate,i=t.endDate;if(e.indexOf("/")>-1&&(e=e.replace("/","-"),e=e.replace("/","-"),i=i.replace("/","-"),i=i.replace("/","-")),t.isQuery)if(e<=i){this.clearData();var a={begintime:e,endtime:i,timezone:y["a"].getOffset()};this.queryTempAlarmRecord(a)}else this.$toast(this.$t("tips.startDateAndEndDateTips"))}},clearData:function(){this.dataList=[],this.cacheList=[]},queryTempAlarmRecord:function(t){var e=this,i=null;i=t||this.getStartAndEndDate(this.queryTime),this.$store.commit("setQueryDetailDateRange",i.begintime+" - "+i.endtime),i.deviceids=this.selectedList,i.intervalseconds=60*this.$refs.pageFrame.interval,i.needaddress=1,i.deviceids.length>0?(this.requestData=i,Object(n["q"])(i).then((function(t){var i=t.status,a=t.records,s=t.addressmap;0===i?(e.addressmap=s,e.cacheList=e.getDataList(a),e.filterData()):e.clearData(),e.$toast.clear()})).catch((function(t){console.log(t),e.clearData(),e.$toast(e.$t("tips.networkError"))}))):this.$toast(this.$t("record.selecteDevicetip"),{duration:1e4})},getStartAndEndDate:function(t){var e=864e5,i=y["a"].getOffset(),a=null;if(1==t){var s=y["a"].longToDateStr(Date.now()-e,i);a={begintime:s+" 00:00:00",endtime:s+" 23:59:59"}}else{0!=t&&(t-=1);var r=y["a"].longToDateStr(Date.now(),i);a={begintime:y["a"].longToDateStr(Date.now()-e*t,i)+" 00:00:00",endtime:r+" 23:59:59"}}return a.timezone=i,a},filterData:function(){if(this.isShowAllData)this.dataList=this.cacheList;else{var t=[];this.cacheList.forEach((function(e){e.records.length>0&&t.push(e)})),this.dataList=t}},onDownload:function(t){var e=this;if(this.dataList.length>0){var i="zh"==this.$i18n.locale,a="download"==t?i?"下载中":"Downloading":i?"打印中":"Printing";this.$toast.loading({message:a,forbidClick:!0});var s=this.globalRecords,r=[[this.$t("record.index"),this.$t("record.devicename"),this.$t("record.deviceid"),this.$t("record.time"),this.$t("record.temp1"),this.$t("record.temp2"),this.$t("record.temp3"),this.$t("record.temp4"),this.$t("record.humi1"),this.$t("record.status"),this.$t("record.address")]],c=1;if(this.dataList.forEach((function(t){var i=t.devicename,a=t.deviceid,n=s[a],d="celsius"==e.$store.state.userSetting.unit_temperature?"°C":"°F";n&&n.length&&n.forEach((function(t,e){var s=[],n=y["a"].longToDateTimeStr(t.updatetime,y["a"].getOffset()),l=536870911==t.temp1?"-":Object(o["d"])(t.temp1/100)+d,u=536870911==t.temp2?"-":Object(o["d"])(t.temp2/100)+d,m=536870911==t.temp3?"-":Object(o["d"])(t.temp3/100)+d,h=536870911==t.temp4?"-":Object(o["d"])(t.temp4/100)+d,p=t.humi1<0||t.humi1>100?"-":t.humi1/10+"%";s.push(c++),s.push(i),s.push(a),s.push(n),s.push(l),s.push(u),s.push(m),s.push(h),s.push(p),s.push(t.strstatus?t.strstatus:"-"),s.push(t.address?t.address:"-"),r.push(s)}))})),1==r.length){var n=[];n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),n.push(""),r.push(n)}var d={title:this.$t("record.tempStatistics"),data:r,dateRange:this.queryDetailDateRange};"download"==t?new ExcelCls(d).exportExcel(t):new ExcelCls(d).printExcel(t)}},getDataList:function(t){var e=this,i=[],a={};return t.forEach((function(t){var s=t.deviceid,r=e.deviceNames[s],c=r.devicename,n=r.creater;t.records.forEach((function(t){t.alarmstatus=e.getTempStatusStr(t.alarmstatus),t.address=Object(o["i"])(e.addressmap,t.callat,t.callon),t.alarmDuration=Object(o["r"])(t.duration,e)})),i.push({devicename:c,deviceid:s,creater:n,begintime:t.begintime,endtime:t.endtime,count:t.records.length,imgSrc:Object(o["h"])(e.lastPositon[s]),realtimeTemp:e.getRealtimeTemp(t.records)}),a[s]=t.records})),this.globalRecords=a,i},getRealtimeTemp:function(t){var e=!1,i="";if(t.length>0){t.sort((function(t,e){return t.updatetime-e.updatetime}));var a=t[t.length-1],s=y["a"].longToDateTimeStr(a.updatetime,y["a"].getOffset()).split(" ")[0];e=s==y["a"].format(new Date,"yyyy-MM-dd");var r="celsius"==this.$store.state.userSetting.unit_temperature?"°C":"°F",c=536870911==a.temp1?null:Object(o["d"])(a.temp1/100)+r;536870911==a.temp2||Object(o["d"])(a.temp2/100),536870911==a.temp3||Object(o["d"])(a.temp3/100),536870911==a.temp4||Object(o["d"])(a.temp4/100),536870911==a.humi1||a.humi1;c&&(i+=c)}return{isToDay:e,realtimeTemp:i}},getTempStatusStr:function(t){var e="";switch(t){case-91:e=this.$t("record.lowTempWarning");break;case-1:e=this.$t("record.lowTempAlarm");break;case 91:e=this.$t("record.highTempWarning");break;case 1:e=this.$t("record.highTempAlarm");break}return e},getAddress:function(t){var e=[];return t.forEach((function(t){e.push({lon:t.slon,lat:t.slat})})),Object(n["b"])(e)},handleClick:function(t){var e=this,i=this.deviceNames[t].devicename,a=this.globalRecords[t];if(0==a.length)this.$toast(this.$t("tips.noDataToast"));else{var s="zh"==this.$i18n.locale,r=s?"加载中":"Loading";this.$toast.loading({message:r,forbidClick:!0}),a.sort((function(t,e){return t.updatetime-e.updatetime})),this.setSelectedRecords({devicename:i,deviceid:t,records:a}),setTimeout((function(){e.$router.push("/tempStatistics/tempStatisticsDetail?queryTime=".concat(e.queryTime)),e.$toast.clear()}),1e3)}}},Object(c["d"])(["setSelectedRecords"])),watch:{isShowAllData:function(){this.filterData()}},computed:Object(r["a"])({},Object(c["e"])(["groups","selectedList","deviceNames","lastPositon","isShowAllData","queryDetailDateRange"])),beforeDestroy:function(){this.$toast.clear()},mounted:function(){this.$store.commit("setQueryDetailDateRange",null),this.queryTempAlarmRecord()}},b=S,D=(i("d2e2"),Object(f["a"])(b,a,s,!1,null,null,null));e["default"]=D.exports},8848:function(t,e,i){"use strict";i("6f05")},"8a79":function(t,e,i){"use strict";var a=i("23e7"),s=i("06cf").f,r=i("50c4"),c=i("5a34"),n=i("1d80"),o=i("ab13"),d=i("c430"),l="".endsWith,u=Math.min,m=o("endsWith"),h=!d&&!m&&!!function(){var t=s(String.prototype,"endsWith");return t&&!t.writable}();a({target:"String",proto:!0,forced:!h&&!m},{endsWith:function(t){var e=String(n(this));c(t);var i=arguments.length>1?arguments[1]:void 0,a=r(e.length),s=void 0===i?a:u(r(i),a),o=String(t);return l?l.call(e,o,s):e.slice(s-o.length,s)===o}})},d2e2:function(t,e,i){"use strict";i("137c")}}]);